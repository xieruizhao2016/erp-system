# 代码生成操作指南

由于代码生成器API返回500错误，建议通过前端界面手动操作。

---

## 步骤1: 访问代码生成器界面

1. 打开浏览器，访问：`http://localhost:48080`
2. 登录系统（用户名：admin，密码：admin123）
3. 进入：**基础设施** → **代码生成**

---

## 步骤2: 导入表定义

### 2.1 导入财务模块表（6张）

1. 点击 **"导入表"** 按钮
2. 在弹窗中，选择数据源：`主数据源`（ID: 1）
3. 在表列表中，勾选以下表：
   - ✅ `erp_finance_balance_sheet` - 资产负债表
   - ✅ `erp_finance_receivable` - 应收账款
   - ✅ `erp_finance_payable` - 应付账款
   - ✅ `erp_finance_prepayment` - 预付款
   - ✅ `erp_finance_prereceipt` - 预收款
   - ✅ `erp_finance_profit_statement` - 利润表
4. 点击 **"确定"** 按钮

### 2.2 导入内部出入库表（2张主表）

1. 再次点击 **"导入表"** 按钮
2. 勾选以下表：
   - ✅ `erp_stock_internal_in` - 内部入库单
   - ✅ `erp_stock_internal_out` - 内部出库单
3. 点击 **"确定"** 按钮

**注意**: 明细表（`erp_stock_internal_in_item`、`erp_stock_internal_out_item`）作为子表处理，不需要单独导入。

---

## 步骤3: 配置代码生成选项

对每张表，点击 **"编辑"** 按钮，配置以下选项：

### 3.1 财务模块表配置

#### erp_finance_balance_sheet（资产负债表）

- **基本信息**:
  - 模块名：`erp`
  - 业务名：`finance-balance-sheet`
  - 类名：`ErpFinanceBalanceSheet`
  - 类描述：`资产负债表`
  - 作者：`开发团队`

- **字段配置**:
  - `period_date`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`date`
  - `asset_total`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `liability_total`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `equity_total`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `status`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，字典类型：`erp_audit_status`

#### erp_finance_receivable（应收账款）

- **基本信息**:
  - 模块名：`erp`
  - 业务名：`finance-receivable`
  - 类名：`ErpFinanceReceivable`
  - 类描述：`应收账款`
  - 作者：`开发团队`

- **字段配置**:
  - `no`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `customer_id`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，关联查询：`erp_customer`
  - `order_id`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，关联查询：`erp_sale_order`
  - `amount`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `received_amount`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `balance`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `due_date`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`date`
  - `status`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，字典类型：`erp_audit_status`

#### erp_finance_payable（应付账款）

- **基本信息**:
  - 模块名：`erp`
  - 业务名：`finance-payable`
  - 类名：`ErpFinancePayable`
  - 类描述：`应付账款`
  - 作者：`开发团队`

- **字段配置**:
  - `no`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `supplier_id`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，关联查询：`erp_supplier`
  - `order_id`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，关联查询：`erp_purchase_order`
  - `amount`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `paid_amount`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `balance`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `due_date`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`date`
  - `status`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，字典类型：`erp_audit_status`

#### erp_finance_prepayment（预付款）

- **基本信息**:
  - 模块名：`erp`
  - 业务名：`finance-prepayment`
  - 类名：`ErpFinancePrepayment`
  - 类描述：`预付款`
  - 作者：`开发团队`

- **字段配置**:
  - `no`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `supplier_id`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，关联查询：`erp_supplier`
  - `order_id`: 列表显示 ✅，表单显示 ❌，查询 ❌，HTML类型：`select`，关联查询：`erp_purchase_order`（可选）
  - `amount`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `used_amount`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `balance`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `prepay_date`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`date`
  - `status`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，字典类型：`erp_audit_status`

#### erp_finance_prereceipt（预收款）

- **基本信息**:
  - 模块名：`erp`
  - 业务名：`finance-prereceipt`
  - 类名：`ErpFinancePrereceipt`
  - 类描述：`预收款`
  - 作者：`开发团队`

- **字段配置**:
  - `no`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `customer_id`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，关联查询：`erp_customer`
  - `order_id`: 列表显示 ✅，表单显示 ❌，查询 ❌，HTML类型：`select`，关联查询：`erp_sale_order`（可选）
  - `amount`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `used_amount`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `balance`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `prereceipt_date`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`date`
  - `status`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，字典类型：`erp_audit_status`

#### erp_finance_profit_statement（利润表）

- **基本信息**:
  - 模块名：`erp`
  - 业务名：`finance-profit-statement`
  - 类名：`ErpFinanceProfitStatement`
  - 类描述：`利润表`
  - 作者：`开发团队`

- **字段配置**:
  - `period_date`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`date`
  - `revenue`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `cost`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `gross_profit`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `operating_expense`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `net_profit`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `status`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，字典类型：`erp_audit_status`

### 3.2 内部出入库表配置

#### erp_stock_internal_in（内部入库单）

- **基本信息**:
  - 模块名：`erp`
  - 业务名：`stock-internal-in`
  - 类名：`ErpStockInternalIn`
  - 类描述：`内部入库单`
  - 作者：`开发团队`

- **字段配置**:
  - `no`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `employee_id`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，关联查询：`system_users`
  - `dept_id`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，关联查询：`system_dept`
  - `internal_type`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，字典类型：`erp_internal_type`（需要创建字典）
  - `in_time`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`datetime`
  - `total_count`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `total_price`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `status`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，字典类型：`erp_audit_status`

#### erp_stock_internal_out（内部出库单）

- **基本信息**:
  - 模块名：`erp`
  - 业务名：`stock-internal-out`
  - 类名：`ErpStockInternalOut`
  - 类描述：`内部出库单`
  - 作者：`开发团队`

- **字段配置**:
  - `no`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `employee_id`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，关联查询：`system_users`
  - `dept_id`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，关联查询：`system_dept`
  - `internal_type`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，字典类型：`erp_internal_type`（需要创建字典）
  - `out_time`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`datetime`
  - `total_count`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `total_price`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`input`
  - `status`: 列表显示 ✅，表单显示 ✅，查询 ✅，HTML类型：`select`，字典类型：`erp_audit_status`

---

## 步骤4: 创建字典配置

在配置内部出入库表之前，需要先创建内部类型字典：

1. 进入：**系统管理** → **字典管理**
2. 点击 **"新增"** 按钮
3. 配置字典类型：
   - 字典名称：`内部流转类型`
   - 字典类型：`erp_internal_type`
   - 状态：`启用`
4. 添加字典数据：
   - `1` - `部门调拨`
   - `2` - `员工领用`
   - `3` - `其他`

---

## 步骤5: 预览和下载代码

1. 配置完成后，点击 **"预览"** 按钮，检查生成的代码
2. 确认无误后，点击 **"生成代码"** 按钮
3. 下载生成的ZIP文件

---

## 步骤6: 部署生成的代码

1. 解压下载的ZIP文件
2. 按照代码生成器的目录结构，将代码复制到项目对应位置：
   - 后端代码 → `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/`
   - 前端代码 → `original-yudao-ui/src/`
   - Mapper XML → `yudao-module-erp/src/main/resources/mapper/`
3. **重要**: 合并ErrorCode（不要直接覆盖 `ErrorCodeConstants.java`）
4. 修复编译错误（如果有）

---

## 注意事项

1. **明细表处理**: 内部出入库的明细表作为子表处理，在生成主表代码时会自动包含
2. **字段配置**: 关联字段（customer_id, supplier_id等）需要配置为选择器类型
3. **字典配置**: 内部类型字典需要先创建，才能正确配置字段
4. **ErrorCode合并**: 必须手动合并，不能直接覆盖

---

## 快速参考表

| 表名 | 模块名 | 业务名 | 类名 |
|------|--------|--------|------|
| erp_finance_balance_sheet | erp | finance-balance-sheet | ErpFinanceBalanceSheet |
| erp_finance_receivable | erp | finance-receivable | ErpFinanceReceivable |
| erp_finance_payable | erp | finance-payable | ErpFinancePayable |
| erp_finance_prepayment | erp | finance-prepayment | ErpFinancePrepayment |
| erp_finance_prereceipt | erp | finance-prereceipt | ErpFinancePrereceipt |
| erp_finance_profit_statement | erp | finance-profit-statement | ErpFinanceProfitStatement |
| erp_stock_internal_in | erp | stock-internal-in | ErpStockInternalIn |
| erp_stock_internal_out | erp | stock-internal-out | ErpStockInternalOut |

---

完成以上步骤后，Phase 2 的代码生成工作就完成了！

