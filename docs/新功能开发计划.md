# ERPç³»ç»Ÿæ–°åŠŸèƒ½å¼€å‘è®¡åˆ’

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-12-09  
**å¼€å‘èŒƒå›´**: è´¢åŠ¡æ¨¡å—æ‰©å±•ã€åº“å­˜å†…éƒ¨æµè½¬ã€é”€å”®è®¢å•æ¯›åˆ©ç‡ç»Ÿè®¡

---

## ğŸ“‹ ç›®å½•

1. [å¼€å‘æ¦‚è¿°](#å¼€å‘æ¦‚è¿°)
2. [è´¢åŠ¡æ¨¡å—æ‰©å±•](#ä¸€è´¢åŠ¡æ¨¡å—æ‰©å±•)
3. [åº“å­˜ç®¡ç†æ‰©å±•](#äºŒåº“å­˜ç®¡ç†æ‰©å±•)
4. [é”€å”®è®¢å•æ¯›åˆ©ç‡ç»Ÿè®¡](#ä¸‰é”€å”®è®¢å•æ¯›åˆ©ç‡ç»Ÿè®¡)
5. [å¼€å‘æ­¥éª¤](#å››å¼€å‘æ­¥éª¤)
6. [å…³é”®æ–‡ä»¶è·¯å¾„](#äº”å…³é”®æ–‡ä»¶è·¯å¾„)
7. [æ³¨æ„äº‹é¡¹](#å…­æ³¨æ„äº‹é¡¹)

---

## å¼€å‘æ¦‚è¿°

### åŠŸèƒ½éœ€æ±‚

1. **è´¢åŠ¡æ¨¡å—æ‰©å±•**
   - èµ„äº§è´Ÿå€ºè¡¨ï¼šè‡ªåŠ¨ä»ä¸šåŠ¡æ•°æ®è®¡ç®—ç”Ÿæˆ
   - åº”æ”¶è´¦æ¬¾ï¼šä»é”€å”®è®¢å•è‡ªåŠ¨ç”Ÿæˆï¼Œå…³è”æ”¶æ¬¾å•æ ¸é”€
   - åº”ä»˜è´¦æ¬¾ï¼šä»é‡‡è´­è®¢å•è‡ªåŠ¨ç”Ÿæˆï¼Œå…³è”ä»˜æ¬¾å•æ ¸é”€
   - é¢„ä»˜æ¬¾ï¼šæ”¯æŒæ‰‹åŠ¨å½•å…¥å’Œè‡ªåŠ¨å…³è”é‡‡è´­è®¢å•
   - é¢„æ”¶æ¬¾ï¼šæ”¯æŒæ‰‹åŠ¨å½•å…¥å’Œè‡ªåŠ¨å…³è”é”€å”®è®¢å•
   - åˆ©æ¶¦è¡¨ï¼šè‡ªåŠ¨ä»ä¸šåŠ¡æ•°æ®è®¡ç®—ç”Ÿæˆ

2. **åº“å­˜ç®¡ç†æ‰©å±•**
   - å†…éƒ¨å…¥åº“ï¼šå…¬å¸å†…éƒ¨åº“å­˜æµè½¬å…¥åº“ï¼Œå…³è”å‘˜å·¥å’Œéƒ¨é—¨
   - å†…éƒ¨å‡ºåº“ï¼šå…¬å¸å†…éƒ¨åº“å­˜æµè½¬å‡ºåº“ï¼Œå…³è”å‘˜å·¥å’Œéƒ¨é—¨
   - æ”¯æŒå®¡æ‰¹æµç¨‹ï¼ˆä¸ç°æœ‰å‡ºå…¥åº“ä¿æŒä¸€è‡´ï¼‰

3. **é”€å”®è®¢å•æ¯›åˆ©ç‡ç»Ÿè®¡**
   - åœ¨é”€å”®è®¢å•åˆ—è¡¨å±•ç¤ºæ¯›åˆ©ç‡
   - è‡ªåŠ¨è®¡ç®—ï¼šæ¯›åˆ©ç‡ = (é”€å”®ä»·æ ¼ - åŸææ–™æˆæœ¬ - å‘˜å·¥æˆæœ¬) / é”€å”®ä»·æ ¼ Ã— 100%
   - æ”¯æŒæŒ‰æ¯›åˆ©ç‡æ’åºå’Œç­›é€‰

### æŠ€æœ¯æ–¹æ¡ˆ

- ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ä»£ç ç”Ÿæˆå™¨ç”ŸæˆåŸºç¡€CRUDä»£ç 
- æ‰‹åŠ¨å¼€å‘ä¸šåŠ¡é€»è¾‘å’Œå…³è”æŸ¥è¯¢
- å‰ç«¯ä½¿ç”¨ç°æœ‰ç»„ä»¶å’Œæ ·å¼ä¿æŒä¸€è‡´

---

## ä¸€ã€è´¢åŠ¡æ¨¡å—æ‰©å±•

### 1.1 æ•°æ®åº“è¡¨è®¾è®¡

#### 1.1.1 èµ„äº§è´Ÿå€ºè¡¨ (erp_finance_balance_sheet)

```sql
CREATE TABLE `erp_finance_balance_sheet` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  `period_date` date NOT NULL COMMENT 'æœŸé—´æ—¥æœŸï¼ˆå¹´æœˆï¼‰',
  `asset_total` decimal(20,2) NULL COMMENT 'èµ„äº§æ€»è®¡ï¼Œå•ä½ï¼šå…ƒ',
  `liability_total` decimal(20,2) NULL COMMENT 'è´Ÿå€ºæ€»è®¡ï¼Œå•ä½ï¼šå…ƒ',
  `equity_total` decimal(20,2) NULL COMMENT 'æ‰€æœ‰è€…æƒç›Šæ€»è®¡ï¼Œå•ä½ï¼šå…ƒ',
  `status` int NULL COMMENT 'çŠ¶æ€ï¼ˆ10-æœªå®¡æ ¸ï¼Œ20-å·²å®¡æ ¸ï¼‰',
  `remark` varchar(500) NULL DEFAULT '' COMMENT 'å¤‡æ³¨',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `creator` varchar(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `updater` varchar(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_period_date` (`period_date`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP èµ„äº§è´Ÿå€ºè¡¨';
```

**å­—æ®µè¯´æ˜**:
- `period_date`: æŠ¥è¡¨æœŸé—´ï¼Œæ ¼å¼ï¼šYYYY-MM-01ï¼ˆæ¯æœˆ1æ—¥ï¼‰
- `asset_total`: è‡ªåŠ¨è®¡ç®—ï¼šæµåŠ¨èµ„äº§ + å›ºå®šèµ„äº§ + å…¶ä»–èµ„äº§
- `liability_total`: è‡ªåŠ¨è®¡ç®—ï¼šæµåŠ¨è´Ÿå€º + é•¿æœŸè´Ÿå€º
- `equity_total`: è‡ªåŠ¨è®¡ç®—ï¼šèµ„äº§æ€»è®¡ - è´Ÿå€ºæ€»è®¡

#### 1.1.2 åº”æ”¶è´¦æ¬¾è¡¨ (erp_finance_receivable)

```sql
CREATE TABLE `erp_finance_receivable` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  `no` varchar(50) NULL DEFAULT '' COMMENT 'å•æ®å·',
  `customer_id` bigint NULL COMMENT 'å®¢æˆ·ç¼–å·ï¼ˆå…³è” erp_customer.idï¼‰',
  `order_id` bigint NULL COMMENT 'é”€å”®è®¢å•ç¼–å·ï¼ˆå…³è” erp_sale_order.idï¼‰',
  `amount` decimal(20,2) NULL COMMENT 'åº”æ”¶é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `received_amount` decimal(20,2) NULL DEFAULT 0.00 COMMENT 'å·²æ”¶é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `balance` decimal(20,2) NULL COMMENT 'ä½™é¢ï¼Œå•ä½ï¼šå…ƒï¼ˆbalance = amount - received_amountï¼‰',
  `due_date` date NULL COMMENT 'åˆ°æœŸæ—¥',
  `status` int NULL COMMENT 'çŠ¶æ€ï¼ˆ10-æœªå®¡æ ¸ï¼Œ20-å·²å®¡æ ¸ï¼‰',
  `remark` varchar(500) NULL DEFAULT '' COMMENT 'å¤‡æ³¨',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `creator` varchar(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `updater` varchar(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_customer_id` (`customer_id`) USING BTREE,
  KEY `idx_order_id` (`order_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP åº”æ”¶è´¦æ¬¾';
```

**ä¸šåŠ¡é€»è¾‘**:
- ä»é”€å”®è®¢å•è‡ªåŠ¨ç”Ÿæˆï¼ˆè®¢å•å®¡æ ¸é€šè¿‡åï¼‰
- å…³è”æ”¶æ¬¾å•æ ¸é”€ï¼ˆæ”¶æ¬¾å•å®¡æ ¸é€šè¿‡åï¼Œæ›´æ–°received_amountå’Œbalanceï¼‰
- ä½™é¢ = åº”æ”¶é‡‘é¢ - å·²æ”¶é‡‘é¢

#### 1.1.3 åº”ä»˜è´¦æ¬¾è¡¨ (erp_finance_payable)

```sql
CREATE TABLE `erp_finance_payable` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  `no` varchar(50) NULL DEFAULT '' COMMENT 'å•æ®å·',
  `supplier_id` bigint NULL COMMENT 'ä¾›åº”å•†ç¼–å·ï¼ˆå…³è” erp_supplier.idï¼‰',
  `order_id` bigint NULL COMMENT 'é‡‡è´­è®¢å•ç¼–å·ï¼ˆå…³è” erp_purchase_order.idï¼‰',
  `amount` decimal(20,2) NULL COMMENT 'åº”ä»˜é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `paid_amount` decimal(20,2) NULL DEFAULT 0.00 COMMENT 'å·²ä»˜é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `balance` decimal(20,2) NULL COMMENT 'ä½™é¢ï¼Œå•ä½ï¼šå…ƒï¼ˆbalance = amount - paid_amountï¼‰',
  `due_date` date NULL COMMENT 'åˆ°æœŸæ—¥',
  `status` int NULL COMMENT 'çŠ¶æ€ï¼ˆ10-æœªå®¡æ ¸ï¼Œ20-å·²å®¡æ ¸ï¼‰',
  `remark` varchar(500) NULL DEFAULT '' COMMENT 'å¤‡æ³¨',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `creator` varchar(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `updater` varchar(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_supplier_id` (`supplier_id`) USING BTREE,
  KEY `idx_order_id` (`order_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP åº”ä»˜è´¦æ¬¾';
```

**ä¸šåŠ¡é€»è¾‘**:
- ä»é‡‡è´­è®¢å•è‡ªåŠ¨ç”Ÿæˆï¼ˆè®¢å•å®¡æ ¸é€šè¿‡åï¼‰
- å…³è”ä»˜æ¬¾å•æ ¸é”€ï¼ˆä»˜æ¬¾å•å®¡æ ¸é€šè¿‡åï¼Œæ›´æ–°paid_amountå’Œbalanceï¼‰

#### 1.1.4 é¢„ä»˜æ¬¾è¡¨ (erp_finance_prepayment)

```sql
CREATE TABLE `erp_finance_prepayment` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  `no` varchar(50) NULL DEFAULT '' COMMENT 'å•æ®å·',
  `supplier_id` bigint NULL COMMENT 'ä¾›åº”å•†ç¼–å·ï¼ˆå…³è” erp_supplier.idï¼‰',
  `order_id` bigint NULL COMMENT 'é‡‡è´­è®¢å•ç¼–å·ï¼ˆå…³è” erp_purchase_order.idï¼Œå¯é€‰ï¼‰',
  `amount` decimal(20,2) NULL COMMENT 'é¢„ä»˜æ¬¾é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `used_amount` decimal(20,2) NULL DEFAULT 0.00 COMMENT 'å·²ä½¿ç”¨é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `balance` decimal(20,2) NULL COMMENT 'ä½™é¢ï¼Œå•ä½ï¼šå…ƒï¼ˆbalance = amount - used_amountï¼‰',
  `prepay_date` date NULL COMMENT 'é¢„ä»˜æ—¥æœŸ',
  `status` int NULL COMMENT 'çŠ¶æ€ï¼ˆ10-æœªå®¡æ ¸ï¼Œ20-å·²å®¡æ ¸ï¼‰',
  `remark` varchar(500) NULL DEFAULT '' COMMENT 'å¤‡æ³¨',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `creator` varchar(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `updater` varchar(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_supplier_id` (`supplier_id`) USING BTREE,
  KEY `idx_order_id` (`order_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP é¢„ä»˜æ¬¾';
```

**ä¸šåŠ¡é€»è¾‘**:
- æ”¯æŒæ‰‹åŠ¨å½•å…¥
- å¯å…³è”é‡‡è´­è®¢å•ï¼ˆå¯é€‰ï¼‰
- é‡‡è´­å…¥åº“æ—¶è‡ªåŠ¨æ ¸é”€ï¼ˆæ›´æ–°used_amountå’Œbalanceï¼‰

#### 1.1.5 é¢„æ”¶æ¬¾è¡¨ (erp_finance_prereceipt)

```sql
CREATE TABLE `erp_finance_prereceipt` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  `no` varchar(50) NULL DEFAULT '' COMMENT 'å•æ®å·',
  `customer_id` bigint NULL COMMENT 'å®¢æˆ·ç¼–å·ï¼ˆå…³è” erp_customer.idï¼‰',
  `order_id` bigint NULL COMMENT 'é”€å”®è®¢å•ç¼–å·ï¼ˆå…³è” erp_sale_order.idï¼Œå¯é€‰ï¼‰',
  `amount` decimal(20,2) NULL COMMENT 'é¢„æ”¶æ¬¾é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `used_amount` decimal(20,2) NULL DEFAULT 0.00 COMMENT 'å·²ä½¿ç”¨é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `balance` decimal(20,2) NULL COMMENT 'ä½™é¢ï¼Œå•ä½ï¼šå…ƒï¼ˆbalance = amount - used_amountï¼‰',
  `prereceipt_date` date NULL COMMENT 'é¢„æ”¶æ—¥æœŸ',
  `status` int NULL COMMENT 'çŠ¶æ€ï¼ˆ10-æœªå®¡æ ¸ï¼Œ20-å·²å®¡æ ¸ï¼‰',
  `remark` varchar(500) NULL DEFAULT '' COMMENT 'å¤‡æ³¨',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `creator` varchar(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `updater` varchar(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_customer_id` (`customer_id`) USING BTREE,
  KEY `idx_order_id` (`order_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP é¢„æ”¶æ¬¾';
```

**ä¸šåŠ¡é€»è¾‘**:
- æ”¯æŒæ‰‹åŠ¨å½•å…¥
- å¯å…³è”é”€å”®è®¢å•ï¼ˆå¯é€‰ï¼‰
- é”€å”®å‡ºåº“æ—¶è‡ªåŠ¨æ ¸é”€ï¼ˆæ›´æ–°used_amountå’Œbalanceï¼‰

#### 1.1.6 åˆ©æ¶¦è¡¨ (erp_finance_profit_statement)

```sql
CREATE TABLE `erp_finance_profit_statement` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  `period_date` date NOT NULL COMMENT 'æœŸé—´æ—¥æœŸï¼ˆå¹´æœˆï¼‰',
  `revenue` decimal(20,2) NULL COMMENT 'è¥ä¸šæ”¶å…¥ï¼Œå•ä½ï¼šå…ƒï¼ˆä»é”€å”®è®¢å•æ±‡æ€»ï¼‰',
  `cost` decimal(20,2) NULL COMMENT 'è¥ä¸šæˆæœ¬ï¼Œå•ä½ï¼šå…ƒï¼ˆä»é‡‡è´­è®¢å•/ç”Ÿäº§è®¢å•æ±‡æ€»ï¼‰',
  `gross_profit` decimal(20,2) NULL COMMENT 'æ¯›åˆ©æ¶¦ï¼Œå•ä½ï¼šå…ƒï¼ˆgross_profit = revenue - costï¼‰',
  `operating_expense` decimal(20,2) NULL DEFAULT 0.00 COMMENT 'è¥ä¸šè´¹ç”¨ï¼Œå•ä½ï¼šå…ƒ',
  `net_profit` decimal(20,2) NULL COMMENT 'å‡€åˆ©æ¶¦ï¼Œå•ä½ï¼šå…ƒï¼ˆnet_profit = gross_profit - operating_expenseï¼‰',
  `status` int NULL COMMENT 'çŠ¶æ€ï¼ˆ10-æœªå®¡æ ¸ï¼Œ20-å·²å®¡æ ¸ï¼‰',
  `remark` varchar(500) NULL DEFAULT '' COMMENT 'å¤‡æ³¨',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `creator` varchar(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `updater` varchar(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_period_date` (`period_date`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP åˆ©æ¶¦è¡¨';
```

**ä¸šåŠ¡é€»è¾‘**:
- è‡ªåŠ¨ä»ä¸šåŠ¡æ•°æ®è®¡ç®—ï¼š
  - `revenue`: æ±‡æ€»å·²å®¡æ ¸çš„é”€å”®è®¢å•é‡‘é¢
  - `cost`: æ±‡æ€»å·²å®¡æ ¸çš„é‡‡è´­è®¢å•é‡‘é¢ + ç”Ÿäº§è®¢å•æˆæœ¬
  - `gross_profit`: è¥ä¸šæ”¶å…¥ - è¥ä¸šæˆæœ¬
  - `net_profit`: æ¯›åˆ©æ¶¦ - è¥ä¸šè´¹ç”¨

### 1.2 ä»£ç ç”Ÿæˆé…ç½®

ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ç”Ÿæˆä»¥ä¸‹6å¼ è¡¨çš„ä»£ç ï¼š

| è¡¨å | æ¨¡å—å | ä¸šåŠ¡å | ç±»å | ç±»æè¿° |
|------|--------|--------|------|--------|
| erp_finance_balance_sheet | erp | finance-balance-sheet | ErpFinanceBalanceSheet | èµ„äº§è´Ÿå€ºè¡¨ |
| erp_finance_receivable | erp | finance-receivable | ErpFinanceReceivable | åº”æ”¶è´¦æ¬¾ |
| erp_finance_payable | erp | finance-payable | ErpFinancePayable | åº”ä»˜è´¦æ¬¾ |
| erp_finance_prepayment | erp | finance-prepayment | ErpFinancePrepayment | é¢„ä»˜æ¬¾ |
| erp_finance_prereceipt | erp | finance-prereceipt | ErpFinancePrereceipt | é¢„æ”¶æ¬¾ |
| erp_finance_profit_statement | erp | finance-profit-statement | ErpFinanceProfitStatement | åˆ©æ¶¦è¡¨ |

**å­—æ®µé…ç½®è¦ç‚¹**:
- `customer_id`, `supplier_id`, `order_id`: åˆ—è¡¨æ˜¾ç¤ºï¼Œè¡¨å•æ˜¾ç¤ºï¼ŒæŸ¥è¯¢ï¼Œå…³è”æŸ¥è¯¢
- `amount`, `balance`, `received_amount`ç­‰é‡‘é¢å­—æ®µ: åˆ—è¡¨æ˜¾ç¤ºï¼Œè¡¨å•æ˜¾ç¤ºï¼ŒæŸ¥è¯¢
- `status`: åˆ—è¡¨æ˜¾ç¤ºï¼Œè¡¨å•æ˜¾ç¤ºï¼ŒæŸ¥è¯¢ï¼Œä½¿ç”¨æšä¸¾é€‰æ‹©å™¨
- `period_date`, `due_date`ç­‰æ—¥æœŸå­—æ®µ: åˆ—è¡¨æ˜¾ç¤ºï¼Œè¡¨å•æ˜¾ç¤ºï¼ŒæŸ¥è¯¢ï¼Œä½¿ç”¨æ—¥æœŸé€‰æ‹©å™¨

### 1.3 ä¸šåŠ¡é€»è¾‘å¼€å‘

#### 1.3.1 åº”æ”¶è´¦æ¬¾è‡ªåŠ¨ç”Ÿæˆ

**ä½ç½®**: `ErpSaleOrderServiceImpl.java`

åœ¨é”€å”®è®¢å•å®¡æ ¸é€šè¿‡åï¼Œè‡ªåŠ¨åˆ›å»ºåº”æ”¶è´¦æ¬¾ï¼š

```java
// åœ¨å®¡æ ¸é€šè¿‡æ–¹æ³•ä¸­æ·»åŠ 
if (ErpAuditStatus.APPROVE.getStatus().equals(status)) {
    // åˆ›å»ºåº”æ”¶è´¦æ¬¾
    ErpFinanceReceivableDO receivable = new ErpFinanceReceivableDO();
    receivable.setNo(generateReceivableNo());
    receivable.setCustomerId(saleOrder.getCustomerId());
    receivable.setOrderId(saleOrder.getId());
    receivable.setAmount(saleOrder.getTotalPrice());
    receivable.setReceivedAmount(BigDecimal.ZERO);
    receivable.setBalance(saleOrder.getTotalPrice());
    receivable.setDueDate(calculateDueDate(saleOrder.getOrderTime()));
    receivable.setStatus(ErpAuditStatus.PROCESS.getStatus());
    financeReceivableService.createReceivable(receivable);
}
```

#### 1.3.2 åº”æ”¶è´¦æ¬¾æ ¸é”€

**ä½ç½®**: `ErpFinanceReceiptServiceImpl.java`

åœ¨æ”¶æ¬¾å•å®¡æ ¸é€šè¿‡åï¼Œè‡ªåŠ¨æ ¸é”€åº”æ”¶è´¦æ¬¾ï¼š

```java
// åœ¨å®¡æ ¸é€šè¿‡æ–¹æ³•ä¸­æ·»åŠ 
if (ErpAuditStatus.APPROVE.getStatus().equals(status)) {
    // æ ¸é”€åº”æ”¶è´¦æ¬¾
    financeReceivableService.writeOff(receipt.getCustomerId(), receipt.getReceiptPrice());
}
```

#### 1.3.3 åº”ä»˜è´¦æ¬¾è‡ªåŠ¨ç”Ÿæˆ

**ä½ç½®**: `ErpPurchaseOrderServiceImpl.java`

åœ¨é‡‡è´­è®¢å•å®¡æ ¸é€šè¿‡åï¼Œè‡ªåŠ¨åˆ›å»ºåº”ä»˜è´¦æ¬¾ï¼š

```java
// åœ¨å®¡æ ¸é€šè¿‡æ–¹æ³•ä¸­æ·»åŠ 
if (ErpAuditStatus.APPROVE.getStatus().equals(status)) {
    // åˆ›å»ºåº”ä»˜è´¦æ¬¾
    ErpFinancePayableDO payable = new ErpFinancePayableDO();
    payable.setNo(generatePayableNo());
    payable.setSupplierId(purchaseOrder.getSupplierId());
    payable.setOrderId(purchaseOrder.getId());
    payable.setAmount(purchaseOrder.getTotalPrice());
    payable.setPaidAmount(BigDecimal.ZERO);
    payable.setBalance(purchaseOrder.getTotalPrice());
    payable.setDueDate(calculateDueDate(purchaseOrder.getOrderTime()));
    payable.setStatus(ErpAuditStatus.PROCESS.getStatus());
    financePayableService.createPayable(payable);
}
```

#### 1.3.4 åº”ä»˜è´¦æ¬¾æ ¸é”€

**ä½ç½®**: `ErpFinancePaymentServiceImpl.java`

åœ¨ä»˜æ¬¾å•å®¡æ ¸é€šè¿‡åï¼Œè‡ªåŠ¨æ ¸é”€åº”ä»˜è´¦æ¬¾ï¼š

```java
// åœ¨å®¡æ ¸é€šè¿‡æ–¹æ³•ä¸­æ·»åŠ 
if (ErpAuditStatus.APPROVE.getStatus().equals(status)) {
    // æ ¸é”€åº”ä»˜è´¦æ¬¾
    financePayableService.writeOff(payment.getSupplierId(), payment.getPaymentPrice());
}
```

#### 1.3.5 èµ„äº§è´Ÿå€ºè¡¨è‡ªåŠ¨è®¡ç®—

**ä½ç½®**: `ErpFinanceBalanceSheetServiceImpl.java`

æä¾›æ–¹æ³•è‡ªåŠ¨è®¡ç®—èµ„äº§è´Ÿå€ºè¡¨æ•°æ®ï¼š

```java
public void calculateBalanceSheet(LocalDate periodDate) {
    // è®¡ç®—èµ„äº§æ€»è®¡
    BigDecimal assetTotal = calculateAssets(periodDate);
    
    // è®¡ç®—è´Ÿå€ºæ€»è®¡
    BigDecimal liabilityTotal = calculateLiabilities(periodDate);
    
    // è®¡ç®—æ‰€æœ‰è€…æƒç›Š
    BigDecimal equityTotal = assetTotal.subtract(liabilityTotal);
    
    // ä¿å­˜æˆ–æ›´æ–°èµ„äº§è´Ÿå€ºè¡¨
    ErpFinanceBalanceSheetDO balanceSheet = getOrCreate(periodDate);
    balanceSheet.setAssetTotal(assetTotal);
    balanceSheet.setLiabilityTotal(liabilityTotal);
    balanceSheet.setEquityTotal(equityTotal);
    saveOrUpdate(balanceSheet);
}
```

#### 1.3.6 åˆ©æ¶¦è¡¨è‡ªåŠ¨è®¡ç®—

**ä½ç½®**: `ErpFinanceProfitStatementServiceImpl.java`

æä¾›æ–¹æ³•è‡ªåŠ¨è®¡ç®—åˆ©æ¶¦è¡¨æ•°æ®ï¼š

```java
public void calculateProfitStatement(LocalDate periodDate) {
    // è®¡ç®—è¥ä¸šæ”¶å…¥ï¼ˆæ±‡æ€»å·²å®¡æ ¸çš„é”€å”®è®¢å•ï¼‰
    BigDecimal revenue = saleOrderService.sumApprovedAmount(periodDate);
    
    // è®¡ç®—è¥ä¸šæˆæœ¬ï¼ˆæ±‡æ€»å·²å®¡æ ¸çš„é‡‡è´­è®¢å• + ç”Ÿäº§è®¢å•æˆæœ¬ï¼‰
    BigDecimal cost = purchaseOrderService.sumApprovedAmount(periodDate)
        .add(productionOrderService.sumCost(periodDate));
    
    // è®¡ç®—æ¯›åˆ©æ¶¦
    BigDecimal grossProfit = revenue.subtract(cost);
    
    // è®¡ç®—å‡€åˆ©æ¶¦ï¼ˆæ¯›åˆ©æ¶¦ - è¥ä¸šè´¹ç”¨ï¼‰
    BigDecimal operatingExpense = getOperatingExpense(periodDate);
    BigDecimal netProfit = grossProfit.subtract(operatingExpense);
    
    // ä¿å­˜æˆ–æ›´æ–°åˆ©æ¶¦è¡¨
    ErpFinanceProfitStatementDO profitStatement = getOrCreate(periodDate);
    profitStatement.setRevenue(revenue);
    profitStatement.setCost(cost);
    profitStatement.setGrossProfit(grossProfit);
    profitStatement.setOperatingExpense(operatingExpense);
    profitStatement.setNetProfit(netProfit);
    saveOrUpdate(profitStatement);
}
```

---

## äºŒã€åº“å­˜ç®¡ç†æ‰©å±•

### 2.1 æ•°æ®åº“è¡¨è®¾è®¡

#### 2.1.1 å†…éƒ¨å…¥åº“è¡¨ (erp_stock_internal_in)

```sql
CREATE TABLE `erp_stock_internal_in` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  `no` varchar(50) NULL DEFAULT '' COMMENT 'å…¥åº“å•å·',
  `employee_id` bigint NULL COMMENT 'å‘˜å·¥ç¼–å·ï¼ˆå…³è” system_users.idï¼‰',
  `dept_id` bigint NULL COMMENT 'éƒ¨é—¨ç¼–å·ï¼ˆå…³è” system_dept.idï¼‰',
  `internal_type` int NULL COMMENT 'å†…éƒ¨ç±»å‹ï¼ˆ1-éƒ¨é—¨è°ƒæ‹¨ï¼Œ2-å‘˜å·¥é¢†ç”¨ï¼Œ3-å…¶ä»–ï¼‰',
  `in_time` datetime NULL COMMENT 'å…¥åº“æ—¶é—´',
  `total_count` decimal(20,2) NULL COMMENT 'åˆè®¡æ•°é‡',
  `total_price` decimal(20,2) NULL COMMENT 'åˆè®¡é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `status` int NULL COMMENT 'çŠ¶æ€ï¼ˆ10-æœªå®¡æ ¸ï¼Œ20-å·²å®¡æ ¸ï¼‰',
  `remark` varchar(500) NULL DEFAULT '' COMMENT 'å¤‡æ³¨',
  `file_url` varchar(500) NULL DEFAULT '' COMMENT 'é™„ä»¶ URL',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `creator` varchar(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `updater` varchar(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_employee_id` (`employee_id`) USING BTREE,
  KEY `idx_dept_id` (`dept_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP å†…éƒ¨å…¥åº“å•';
```

**å­—æ®µè¯´æ˜**:
- `employee_id`: å…³è”ç³»ç»Ÿç”¨æˆ·è¡¨ï¼Œå¿…å¡«
- `dept_id`: å…³è”ç³»ç»Ÿéƒ¨é—¨è¡¨ï¼Œå¯é€‰ï¼ˆå¦‚æœé€‰æ‹©éƒ¨é—¨ï¼Œåˆ™å‘˜å·¥è‡ªåŠ¨å…³è”åˆ°è¯¥éƒ¨é—¨ï¼‰
- `internal_type`: å†…éƒ¨æµè½¬ç±»å‹æšä¸¾

#### 2.1.2 å†…éƒ¨å…¥åº“æ˜ç»†è¡¨ (erp_stock_internal_in_item)

```sql
CREATE TABLE `erp_stock_internal_in_item` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `in_id` bigint NULL COMMENT 'å†…éƒ¨å…¥åº“ç¼–å·ï¼ˆå…³è” erp_stock_internal_in.idï¼‰',
  `warehouse_id` bigint NULL COMMENT 'ä»“åº“ç¼–å·ï¼ˆå…³è” erp_warehouse.idï¼‰',
  `product_id` bigint NULL COMMENT 'äº§å“ç¼–å·ï¼ˆå…³è” erp_product.idï¼‰',
  `product_unit_id` bigint NULL COMMENT 'äº§å“å•ä½ç¼–å·ï¼ˆå†—ä½™ erp_product.unit_idï¼‰',
  `product_price` decimal(20,2) NULL COMMENT 'äº§å“å•ä»·ï¼Œå•ä½ï¼šå…ƒ',
  `count` decimal(20,2) NULL COMMENT 'æ•°é‡',
  `total_price` decimal(20,2) NULL COMMENT 'åˆè®¡é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `remark` varchar(500) NULL DEFAULT '' COMMENT 'å¤‡æ³¨',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `creator` varchar(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `updater` varchar(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_in_id` (`in_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP å†…éƒ¨å…¥åº“å•é¡¹';
```

#### 2.1.3 å†…éƒ¨å‡ºåº“è¡¨ (erp_stock_internal_out)

```sql
CREATE TABLE `erp_stock_internal_out` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  `no` varchar(50) NULL DEFAULT '' COMMENT 'å‡ºåº“å•å·',
  `employee_id` bigint NULL COMMENT 'å‘˜å·¥ç¼–å·ï¼ˆå…³è” system_users.idï¼‰',
  `dept_id` bigint NULL COMMENT 'éƒ¨é—¨ç¼–å·ï¼ˆå…³è” system_dept.idï¼‰',
  `internal_type` int NULL COMMENT 'å†…éƒ¨ç±»å‹ï¼ˆ1-éƒ¨é—¨è°ƒæ‹¨ï¼Œ2-å‘˜å·¥é¢†ç”¨ï¼Œ3-å…¶ä»–ï¼‰',
  `out_time` datetime NULL COMMENT 'å‡ºåº“æ—¶é—´',
  `total_count` decimal(20,2) NULL COMMENT 'åˆè®¡æ•°é‡',
  `total_price` decimal(20,2) NULL COMMENT 'åˆè®¡é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `status` int NULL COMMENT 'çŠ¶æ€ï¼ˆ10-æœªå®¡æ ¸ï¼Œ20-å·²å®¡æ ¸ï¼‰',
  `remark` varchar(500) NULL DEFAULT '' COMMENT 'å¤‡æ³¨',
  `file_url` varchar(500) NULL DEFAULT '' COMMENT 'é™„ä»¶ URL',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `creator` varchar(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `updater` varchar(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_employee_id` (`employee_id`) USING BTREE,
  KEY `idx_dept_id` (`dept_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP å†…éƒ¨å‡ºåº“å•';
```

#### 2.1.4 å†…éƒ¨å‡ºåº“æ˜ç»†è¡¨ (erp_stock_internal_out_item)

```sql
CREATE TABLE `erp_stock_internal_out_item` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `out_id` bigint NULL COMMENT 'å†…éƒ¨å‡ºåº“ç¼–å·ï¼ˆå…³è” erp_stock_internal_out.idï¼‰',
  `warehouse_id` bigint NULL COMMENT 'ä»“åº“ç¼–å·ï¼ˆå…³è” erp_warehouse.idï¼‰',
  `product_id` bigint NULL COMMENT 'äº§å“ç¼–å·ï¼ˆå…³è” erp_product.idï¼‰',
  `product_unit_id` bigint NULL COMMENT 'äº§å“å•ä½ç¼–å·ï¼ˆå†—ä½™ erp_product.unit_idï¼‰',
  `product_price` decimal(20,2) NULL COMMENT 'äº§å“å•ä»·ï¼Œå•ä½ï¼šå…ƒ',
  `count` decimal(20,2) NULL COMMENT 'æ•°é‡',
  `total_price` decimal(20,2) NULL COMMENT 'åˆè®¡é‡‘é¢ï¼Œå•ä½ï¼šå…ƒ',
  `remark` varchar(500) NULL DEFAULT '' COMMENT 'å¤‡æ³¨',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ID',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `creator` varchar(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `updater` varchar(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_out_id` (`out_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP å†…éƒ¨å‡ºåº“å•é¡¹';
```

### 2.2 å†…éƒ¨ç±»å‹æšä¸¾

**ä½ç½®**: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/enums/ErpInternalType.java`

```java
package cn.iocoder.yudao.module.erp.enums;

import cn.iocoder.yudao.framework.common.core.ArrayValuable;
import lombok.Getter;
import lombok.RequiredArgsConstructor;

import java.util.Arrays;

@RequiredArgsConstructor
@Getter
public enum ErpInternalType implements ArrayValuable<Integer> {

    DEPT_TRANSFER(1, "éƒ¨é—¨è°ƒæ‹¨"),
    EMPLOYEE_USE(2, "å‘˜å·¥é¢†ç”¨"),
    OTHER(3, "å…¶ä»–");

    public static final Integer[] ARRAYS = Arrays.stream(values())
        .map(ErpInternalType::getType).toArray(Integer[]::new);

    private final Integer type;
    private final String name;

    @Override
    public Integer[] array() {
        return ARRAYS;
    }
}
```

### 2.3 åº“å­˜è®°å½•ä¸šåŠ¡ç±»å‹æ‰©å±•

**ä½ç½®**: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/enums/stock/ErpStockRecordBizTypeEnum.java`

æ·»åŠ æ–°çš„ä¸šåŠ¡ç±»å‹ï¼š

```java
INTERNAL_IN(11, "å†…éƒ¨å…¥åº“"),
INTERNAL_OUT(12, "å†…éƒ¨å‡ºåº“");
```

### 2.4 ä»£ç ç”Ÿæˆé…ç½®

ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ç”Ÿæˆä»¥ä¸‹2å¼ ä¸»è¡¨çš„ä»£ç ï¼ˆæ˜ç»†è¡¨ä½œä¸ºå­è¡¨å¤„ç†ï¼‰ï¼š

| è¡¨å | æ¨¡å—å | ä¸šåŠ¡å | ç±»å | ç±»æè¿° |
|------|--------|--------|------|--------|
| erp_stock_internal_in | erp | stock-internal-in | ErpStockInternalIn | å†…éƒ¨å…¥åº“å• |
| erp_stock_internal_out | erp | stock-internal-out | ErpStockInternalOut | å†…éƒ¨å‡ºåº“å• |

**å­—æ®µé…ç½®è¦ç‚¹**:
- `employee_id`, `dept_id`: åˆ—è¡¨æ˜¾ç¤ºï¼Œè¡¨å•æ˜¾ç¤ºï¼ŒæŸ¥è¯¢ï¼Œä½¿ç”¨é€‰æ‹©å™¨ç»„ä»¶
- `internal_type`: åˆ—è¡¨æ˜¾ç¤ºï¼Œè¡¨å•æ˜¾ç¤ºï¼ŒæŸ¥è¯¢ï¼Œä½¿ç”¨æšä¸¾é€‰æ‹©å™¨
- `status`: åˆ—è¡¨æ˜¾ç¤ºï¼Œè¡¨å•æ˜¾ç¤ºï¼ŒæŸ¥è¯¢ï¼Œä½¿ç”¨æšä¸¾é€‰æ‹©å™¨

### 2.5 ä¸šåŠ¡é€»è¾‘å¼€å‘

#### 2.5.1 å‚è€ƒç°æœ‰å‡ºå…¥åº“å®ç°

å†…éƒ¨å‡ºå…¥åº“çš„ä¸šåŠ¡é€»è¾‘å‚è€ƒ `ErpStockInServiceImpl` å’Œ `ErpStockOutServiceImpl`ï¼š

1. **åˆ›å»ºå•æ®**: ç”Ÿæˆå•å·ï¼Œè®¾ç½®åˆå§‹çŠ¶æ€ä¸º"æœªå®¡æ ¸"
2. **å®¡æ ¸é€šè¿‡**: æ›´æ–°åº“å­˜ï¼Œåˆ›å»ºåº“å­˜è®°å½•
3. **å®¡æ ¸ä¸é€šè¿‡**: ä¸æ›´æ–°åº“å­˜

#### 2.5.2 åº“å­˜æ›´æ–°é€»è¾‘

**ä½ç½®**: `ErpStockInternalInServiceImpl.java` å’Œ `ErpStockInternalOutServiceImpl.java`

```java
// å®¡æ ¸é€šè¿‡åæ›´æ–°åº“å­˜
if (ErpAuditStatus.APPROVE.getStatus().equals(status)) {
    // æ›´æ–°åº“å­˜
    for (ErpStockInternalInItemDO item : items) {
        stockService.addStock(
            item.getProductId(),
            item.getWarehouseId(),
            item.getCount(),
            ErpStockRecordBizTypeEnum.INTERNAL_IN.getType(),
            internalIn.getId(),
            item.getId(),
            internalIn.getNo()
        );
    }
}
```

#### 2.5.3 å‘˜å·¥å’Œéƒ¨é—¨é€‰æ‹©å™¨

å‰ç«¯éœ€è¦æ·»åŠ å‘˜å·¥å’Œéƒ¨é—¨é€‰æ‹©å™¨ç»„ä»¶ï¼Œå‚è€ƒç°æœ‰çš„å®¢æˆ·å’Œä¾›åº”å•†é€‰æ‹©å™¨å®ç°ã€‚

---

## ä¸‰ã€é”€å”®è®¢å•æ¯›åˆ©ç‡ç»Ÿè®¡

### 3.1 æ•°æ®åº“å­—æ®µæ‰©å±•

#### 3.1.1 é”€å”®è®¢å•è¡¨å­—æ®µæ‰©å±•

åœ¨ `erp_sale_order` è¡¨ä¸­æ·»åŠ å­—æ®µï¼š

```sql
ALTER TABLE `erp_sale_order` 
ADD COLUMN `gross_profit_rate` decimal(20,2) NULL COMMENT 'æ¯›åˆ©ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰' AFTER `total_price`,
ADD COLUMN `material_cost` decimal(20,2) NULL COMMENT 'åŸææ–™æˆæœ¬ï¼Œå•ä½ï¼šå…ƒ' AFTER `gross_profit_rate`,
ADD COLUMN `labor_cost` decimal(20,2) NULL COMMENT 'å‘˜å·¥æˆæœ¬ï¼Œå•ä½ï¼šå…ƒ' AFTER `material_cost`,
ADD COLUMN `total_cost` decimal(20,2) NULL COMMENT 'æ€»æˆæœ¬ï¼Œå•ä½ï¼šå…ƒï¼ˆtotal_cost = material_cost + labor_costï¼‰' AFTER `labor_cost`;
```

#### 3.1.2 é”€å”®è®¢å•é¡¹è¡¨å­—æ®µæ‰©å±•

åœ¨ `erp_sale_order_items` è¡¨ä¸­æ·»åŠ å­—æ®µï¼š

```sql
ALTER TABLE `erp_sale_order_items` 
ADD COLUMN `gross_profit_rate` decimal(20,2) NULL COMMENT 'è¡Œæ¯›åˆ©ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰' AFTER `tax_price`,
ADD COLUMN `material_cost` decimal(20,2) NULL COMMENT 'è¡ŒåŸææ–™æˆæœ¬ï¼Œå•ä½ï¼šå…ƒ' AFTER `gross_profit_rate`,
ADD COLUMN `labor_cost` decimal(20,2) NULL COMMENT 'è¡Œå‘˜å·¥æˆæœ¬ï¼Œå•ä½ï¼šå…ƒ' AFTER `material_cost`;
```

### 3.2 ä»£ç ä¿®æ”¹ï¼ˆä¸ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ï¼‰

ç”±äºæ˜¯å­—æ®µæ‰©å±•ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š

#### 3.2.1 æ›´æ–°DOç±»

**ä½ç½®**: `ErpSaleOrderDO.java` å’Œ `ErpSaleOrderItemDO.java`

æ·»åŠ æ–°å­—æ®µï¼š

```java
/**
 * æ¯›åˆ©ç‡ï¼Œç™¾åˆ†æ¯”
 */
private BigDecimal grossProfitRate;

/**
 * åŸææ–™æˆæœ¬ï¼Œå•ä½ï¼šå…ƒ
 */
private BigDecimal materialCost;

/**
 * å‘˜å·¥æˆæœ¬ï¼Œå•ä½ï¼šå…ƒ
 */
private BigDecimal laborCost;

/**
 * æ€»æˆæœ¬ï¼Œå•ä½ï¼šå…ƒ
 */
private BigDecimal totalCost;
```

#### 3.2.2 æ›´æ–°Mapper XML

**ä½ç½®**: `ErpSaleOrderMapper.xml`

æ·»åŠ å­—æ®µæ˜ å°„ï¼š

```xml
<result column="gross_profit_rate" property="grossProfitRate"/>
<result column="material_cost" property="materialCost"/>
<result column="labor_cost" property="laborCost"/>
<result column="total_cost" property="totalCost"/>
```

#### 3.2.3 æ›´æ–°VOç±»

**ä½ç½®**: 
- `ErpSaleOrderRespVO.java`
- `ErpSaleOrderPageReqVO.java` (æ·»åŠ æŸ¥è¯¢å­—æ®µ)
- `ErpSaleOrderSaveReqVO.java` (å¯é€‰ï¼Œå¦‚æœéœ€è¦æ‰‹åŠ¨è°ƒæ•´)

### 3.3 ä¸šåŠ¡é€»è¾‘å¼€å‘

#### 3.3.1 æˆæœ¬è®¡ç®—æœåŠ¡

**ä½ç½®**: `ErpSaleOrderServiceImpl.java`

æ·»åŠ æˆæœ¬è®¡ç®—æ–¹æ³•ï¼š

```java
/**
 * è®¡ç®—é”€å”®è®¢å•æˆæœ¬
 */
private void calculateCost(ErpSaleOrderDO saleOrder, List<ErpSaleOrderItemDO> items) {
    BigDecimal totalMaterialCost = BigDecimal.ZERO;
    BigDecimal totalLaborCost = BigDecimal.ZERO;
    
    for (ErpSaleOrderItemDO item : items) {
        // è®¡ç®—åŸææ–™æˆæœ¬ï¼ˆä»BOMè·å–ï¼‰
        BigDecimal materialCost = calculateMaterialCost(item.getProductId(), item.getCount());
        item.setMaterialCost(materialCost);
        
        // è®¡ç®—å‘˜å·¥æˆæœ¬ï¼ˆä»ç”Ÿäº§è®¢å•å…³è”çš„å·¥å•è·å–ï¼‰
        BigDecimal laborCost = calculateLaborCost(item.getProductId(), item.getCount());
        item.setLaborCost(laborCost);
        
        // è®¡ç®—è¡Œæ¯›åˆ©ç‡
        BigDecimal itemTotalCost = materialCost.add(laborCost);
        BigDecimal itemGrossProfitRate = calculateGrossProfitRate(
            item.getTotalPrice(), itemTotalCost);
        item.setGrossProfitRate(itemGrossProfitRate);
        
        totalMaterialCost = totalMaterialCost.add(materialCost);
        totalLaborCost = totalLaborCost.add(laborCost);
    }
    
    // è®¡ç®—è®¢å•æ€»æˆæœ¬
    saleOrder.setMaterialCost(totalMaterialCost);
    saleOrder.setLaborCost(totalLaborCost);
    saleOrder.setTotalCost(totalMaterialCost.add(totalLaborCost));
    
    // è®¡ç®—è®¢å•æ¯›åˆ©ç‡
    saleOrder.setGrossProfitRate(calculateGrossProfitRate(
        saleOrder.getTotalPrice(), saleOrder.getTotalCost()));
}

/**
 * è®¡ç®—åŸææ–™æˆæœ¬
 */
private BigDecimal calculateMaterialCost(Long productId, BigDecimal quantity) {
    // 1. è·å–äº§å“BOM
    ErpProductBomDO bom = productBomService.getActiveBom(productId);
    if (bom == null) {
        return BigDecimal.ZERO;
    }
    
    // 2. éå†BOMæ˜ç»†ï¼Œè®¡ç®—åŸææ–™æˆæœ¬
    BigDecimal totalCost = BigDecimal.ZERO;
    List<ErpProductBomItemDO> bomItems = productBomItemService.getBomItems(bom.getId());
    for (ErpProductBomItemDO bomItem : bomItems) {
        // è·å–åŸææ–™çš„æœ€æ–°é‡‡è´­ä»·æ ¼
        BigDecimal purchasePrice = purchaseOrderService.getLatestPrice(bomItem.getChildProductId());
        if (purchasePrice == null) {
            purchasePrice = BigDecimal.ZERO;
        }
        
        // è®¡ç®—è¯¥åŸææ–™çš„æˆæœ¬ = é‡‡è´­ä»·æ ¼ * BOMæ•°é‡ * è®¢å•æ•°é‡
        BigDecimal itemCost = purchasePrice
            .multiply(bomItem.getQuantity())
            .multiply(quantity);
        totalCost = totalCost.add(itemCost);
    }
    
    return totalCost;
}

/**
 * è®¡ç®—å‘˜å·¥æˆæœ¬
 */
private BigDecimal calculateLaborCost(Long productId, BigDecimal quantity) {
    // 1. è·å–äº§å“çš„å·¥è‰ºè·¯çº¿
    ErpProcessRouteDO route = processRouteService.getActiveRoute(productId);
    if (route == null) {
        return BigDecimal.ZERO;
    }
    
    // 2. éå†å·¥è‰ºè·¯çº¿æ˜ç»†ï¼Œè®¡ç®—å‘˜å·¥æˆæœ¬
    BigDecimal totalCost = BigDecimal.ZERO;
    List<ErpProcessRouteItemDO> routeItems = processRouteItemService.getRouteItems(route.getId());
    for (ErpProcessRouteItemDO routeItem : routeItems) {
        // è·å–å·¥åºçš„æ ‡å‡†å·¥æ—¶
        BigDecimal standardTime = routeItem.getStandardTime();
        
        // è·å–å‘˜å·¥æ—¶è–ªï¼ˆä»ç³»ç»Ÿé…ç½®æˆ–å‘˜å·¥è¡¨è·å–ï¼‰
        BigDecimal hourlyRate = getEmployeeHourlyRate(routeItem.getProcessId());
        if (hourlyRate == null) {
            hourlyRate = BigDecimal.ZERO;
        }
        
        // è®¡ç®—è¯¥å·¥åºçš„æˆæœ¬ = æ—¶è–ª * æ ‡å‡†å·¥æ—¶ * è®¢å•æ•°é‡
        BigDecimal itemCost = hourlyRate
            .multiply(standardTime)
            .multiply(quantity);
        totalCost = totalCost.add(itemCost);
    }
    
    return totalCost;
}

/**
 * è®¡ç®—æ¯›åˆ©ç‡
 */
private BigDecimal calculateGrossProfitRate(BigDecimal salePrice, BigDecimal totalCost) {
    if (salePrice == null || salePrice.compareTo(BigDecimal.ZERO) == 0) {
        return BigDecimal.ZERO;
    }
    if (totalCost == null) {
        totalCost = BigDecimal.ZERO;
    }
    
    // æ¯›åˆ©ç‡ = (é”€å”®ä»·æ ¼ - æ€»æˆæœ¬) / é”€å”®ä»·æ ¼ Ã— 100%
    BigDecimal profit = salePrice.subtract(totalCost);
    return profit.divide(salePrice, 4, RoundingMode.HALF_UP)
        .multiply(new BigDecimal("100"));
}
```

#### 3.3.2 åœ¨ä¿å­˜/æ›´æ–°æ—¶è‡ªåŠ¨è®¡ç®—

åœ¨ `createSaleOrder` å’Œ `updateSaleOrder` æ–¹æ³•ä¸­è°ƒç”¨æˆæœ¬è®¡ç®—ï¼š

```java
@Override
@Transactional(rollbackFor = Exception.class)
public Long createSaleOrder(ErpSaleOrderSaveReqVO createReqVO) {
    // ... ç°æœ‰ä»£ç  ...
    
    // è®¡ç®—æˆæœ¬
    calculateCost(saleOrder, items);
    
    // ... ä¿å­˜ä»£ç  ...
}
```

### 3.4 å‰ç«¯ä¼˜åŒ–

#### 3.4.1 åˆ—è¡¨é¡µé¢æ·»åŠ æ¯›åˆ©ç‡åˆ—

**ä½ç½®**: `original-yudao-ui/src/views/erp/sale/order/index.vue`

åœ¨è¡¨æ ¼åˆ—å®šä¹‰ä¸­æ·»åŠ ï¼š

```vue
<el-table-column label="æ¯›åˆ©ç‡" prop="grossProfitRate" width="100" align="right">
  <template #default="{ row }">
    <span v-if="row.grossProfitRate != null">
      {{ formatNumber(row.grossProfitRate, 2) }}%
    </span>
    <span v-else>-</span>
  </template>
</el-table-column>
```

#### 3.4.2 æ·»åŠ æ¯›åˆ©ç‡ç­›é€‰å’Œæ’åº

åœ¨æŸ¥è¯¢è¡¨å•ä¸­æ·»åŠ ï¼š

```vue
<el-form-item label="æ¯›åˆ©ç‡">
  <el-input-number
    v-model="queryParams.grossProfitRateMin"
    :precision="2"
    placeholder="æœ€å°æ¯›åˆ©ç‡"
    style="width: 120px"
  />
  <span style="margin: 0 8px">-</span>
  <el-input-number
    v-model="queryParams.grossProfitRateMax"
    :precision="2"
    placeholder="æœ€å¤§æ¯›åˆ©ç‡"
    style="width: 120px"
  />
</el-form-item>
```

---

## å››ã€å¼€å‘æ­¥éª¤

### Phase 1: æ•°æ®åº“è¡¨åˆ›å»ºï¼ˆ2å¤©ï¼‰

#### æ­¥éª¤1.1: åˆ›å»ºè´¢åŠ¡æ¨¡å—è¡¨ï¼ˆ1å¤©ï¼‰

1. åˆ›å»ºSQLè„šæœ¬æ–‡ä»¶ï¼š`sql/mysql/erp-finance-tables.sql`
2. åŒ…å«6å¼ è¡¨çš„åˆ›å»ºè¯­å¥
3. æ‰§è¡ŒSQLè„šæœ¬å¹¶éªŒè¯

#### æ­¥éª¤1.2: åˆ›å»ºå†…éƒ¨å‡ºå…¥åº“è¡¨ï¼ˆ0.5å¤©ï¼‰

1. åˆ›å»ºSQLè„šæœ¬æ–‡ä»¶ï¼š`sql/mysql/erp-stock-internal-tables.sql`
2. åŒ…å«4å¼ è¡¨çš„åˆ›å»ºè¯­å¥
3. æ‰§è¡ŒSQLè„šæœ¬å¹¶éªŒè¯

#### æ­¥éª¤1.3: æ‰©å±•é”€å”®è®¢å•è¡¨å­—æ®µï¼ˆ0.5å¤©ï¼‰

1. åˆ›å»ºSQLè„šæœ¬æ–‡ä»¶ï¼š`sql/mysql/erp-sale-order-gross-profit-fields.sql`
2. åŒ…å«ALTER TABLEè¯­å¥
3. æ‰§è¡ŒSQLè„šæœ¬å¹¶éªŒè¯

### Phase 2: ä»£ç ç”Ÿæˆï¼ˆ3å¤©ï¼‰

#### æ­¥éª¤2.1: è·å–JWT Token

```bash
# ä½¿ç”¨è„šæœ¬è·å–Token
./scripts/get-jwt-token.sh admin admin123 http://localhost:48080/admin-api 1
```

#### æ­¥éª¤2.2: åˆ›å»ºä»£ç ç”Ÿæˆå™¨è¡¨å®šä¹‰

ä½¿ç”¨APIæˆ–å‰ç«¯ç•Œé¢åˆ›å»º10å¼ è¡¨çš„ä»£ç ç”Ÿæˆé…ç½®ï¼š

1. è´¢åŠ¡æ¨¡å—6å¼ è¡¨
2. å†…éƒ¨å‡ºå…¥åº“2å¼ ä¸»è¡¨ï¼ˆæ˜ç»†è¡¨ä½œä¸ºå­è¡¨å¤„ç†ï¼‰

#### æ­¥éª¤2.3: é…ç½®ä»£ç ç”Ÿæˆé€‰é¡¹

ä¸ºæ¯å¼ è¡¨é…ç½®ï¼š
- æ¨¡å—åï¼š`erp`
- ä¸šåŠ¡åï¼šæŒ‰è¡¨åè§„èŒƒ
- ç±»åï¼šæŒ‰è¡¨åè§„èŒƒ
- å­—æ®µé…ç½®ï¼šåˆ—è¡¨æ˜¾ç¤ºã€è¡¨å•æ˜¾ç¤ºã€æŸ¥è¯¢ç­‰

#### æ­¥éª¤2.4: ä¸‹è½½ç”Ÿæˆçš„ä»£ç 

1. é¢„è§ˆä»£ç ç¡®è®¤æ— è¯¯
2. ä¸‹è½½ZIPåŒ…
3. è§£å‹å¹¶æ£€æŸ¥ä»£ç ç»“æ„

#### æ­¥éª¤2.5: æ”¾ç½®ä»£ç åˆ°æ­£ç¡®ä½ç½®

æŒ‰ç…§ä»£ç ç”Ÿæˆå™¨ä½¿ç”¨æŒ‡å—ï¼Œå°†ä»£ç æ”¾ç½®åˆ°æ­£ç¡®ä½ç½®ï¼š

**åç«¯ä»£ç **:
- Controller: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/`
- Service: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/service/`
- DO: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/dataobject/`
- Mapper: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/mysql/`
- Mapper XML: `yudao-module-erp/src/main/resources/mapper/`

**å‰ç«¯ä»£ç **:
- API: `original-yudao-ui/src/api/erp/`
- Views: `original-yudao-ui/src/views/erp/`

#### æ­¥éª¤2.6: åˆå¹¶ErrorCode

æ‰‹åŠ¨å°†ç”Ÿæˆçš„ErrorCodeåˆå¹¶åˆ° `ErrorCodeConstants.java`ï¼Œä¸è¦ç›´æ¥è¦†ç›–ã€‚

### Phase 3: ä¸šåŠ¡é€»è¾‘å¼€å‘ï¼ˆ5å¤©ï¼‰

#### æ­¥éª¤3.1: è´¢åŠ¡æ¨¡å—ä¸šåŠ¡é€»è¾‘ï¼ˆ2å¤©ï¼‰

1. **åº”æ”¶è´¦æ¬¾è‡ªåŠ¨ç”Ÿæˆ**ï¼ˆ0.5å¤©ï¼‰
   - åœ¨é”€å”®è®¢å•å®¡æ ¸é€šè¿‡åè‡ªåŠ¨åˆ›å»º
   - å®ç°æ ¸é”€é€»è¾‘

2. **åº”ä»˜è´¦æ¬¾è‡ªåŠ¨ç”Ÿæˆ**ï¼ˆ0.5å¤©ï¼‰
   - åœ¨é‡‡è´­è®¢å•å®¡æ ¸é€šè¿‡åè‡ªåŠ¨åˆ›å»º
   - å®ç°æ ¸é”€é€»è¾‘

3. **é¢„ä»˜æ¬¾/é¢„æ”¶æ¬¾é€»è¾‘**ï¼ˆ0.5å¤©ï¼‰
   - æ”¯æŒæ‰‹åŠ¨å½•å…¥
   - å®ç°è‡ªåŠ¨æ ¸é”€é€»è¾‘

4. **èµ„äº§è´Ÿå€ºè¡¨/åˆ©æ¶¦è¡¨è‡ªåŠ¨è®¡ç®—**ï¼ˆ0.5å¤©ï¼‰
   - å®ç°æ•°æ®æ±‡æ€»é€»è¾‘
   - å®ç°è‡ªåŠ¨è®¡ç®—åŠŸèƒ½

#### æ­¥éª¤3.2: å†…éƒ¨å‡ºå…¥åº“ä¸šåŠ¡é€»è¾‘ï¼ˆ1.5å¤©ï¼‰

1. **å‚è€ƒç°æœ‰å®ç°**ï¼ˆ0.5å¤©ï¼‰
   - å‚è€ƒ `ErpStockInServiceImpl` å’Œ `ErpStockOutServiceImpl`
   - å®ç°åˆ›å»ºã€å®¡æ ¸ã€åº“å­˜æ›´æ–°é€»è¾‘

2. **å‘˜å·¥å’Œéƒ¨é—¨å…³è”**ï¼ˆ0.5å¤©ï¼‰
   - å®ç°å‘˜å·¥å’Œéƒ¨é—¨é€‰æ‹©å™¨
   - å®ç°å…³è”æŸ¥è¯¢

3. **åº“å­˜è®°å½•æ‰©å±•**ï¼ˆ0.5å¤©ï¼‰
   - æ‰©å±• `ErpStockRecordBizTypeEnum`
   - å®ç°åº“å­˜è®°å½•åˆ›å»ºé€»è¾‘

#### æ­¥éª¤3.3: é”€å”®è®¢å•æ¯›åˆ©ç‡è®¡ç®—ï¼ˆ1.5å¤©ï¼‰

1. **æˆæœ¬è®¡ç®—æœåŠ¡**ï¼ˆ1å¤©ï¼‰
   - å®ç°åŸææ–™æˆæœ¬è®¡ç®—ï¼ˆä»BOMè·å–ï¼‰
   - å®ç°å‘˜å·¥æˆæœ¬è®¡ç®—ï¼ˆä»å·¥è‰ºè·¯çº¿è·å–ï¼‰
   - å®ç°æ¯›åˆ©ç‡è®¡ç®—

2. **é›†æˆåˆ°è®¢å•ä¿å­˜æµç¨‹**ï¼ˆ0.5å¤©ï¼‰
   - åœ¨åˆ›å»º/æ›´æ–°è®¢å•æ—¶è‡ªåŠ¨è®¡ç®—
   - å¤„ç†å¼‚å¸¸æƒ…å†µ

### Phase 4: å‰ç«¯ä¼˜åŒ–ï¼ˆ3å¤©ï¼‰

#### æ­¥éª¤4.1: è´¢åŠ¡æ¨¡å—å‰ç«¯ï¼ˆ1å¤©ï¼‰

1. ä¼˜åŒ–æŠ¥è¡¨å±•ç¤º
2. æ·»åŠ æ•°æ®å…³è”æ˜¾ç¤ºï¼ˆå®¢æˆ·ã€ä¾›åº”å•†ã€è®¢å•ç­‰ï¼‰
3. æ·»åŠ è‡ªåŠ¨è®¡ç®—æŒ‰é’®

#### æ­¥éª¤4.2: å†…éƒ¨å‡ºå…¥åº“å‰ç«¯ï¼ˆ1å¤©ï¼‰

1. æ·»åŠ å‘˜å·¥å’Œéƒ¨é—¨é€‰æ‹©å™¨ç»„ä»¶
2. ä¼˜åŒ–è¡¨å•å¸ƒå±€
3. æ·»åŠ å†…éƒ¨ç±»å‹é€‰æ‹©å™¨

#### æ­¥éª¤4.3: é”€å”®è®¢å•å‰ç«¯ï¼ˆ1å¤©ï¼‰

1. åœ¨åˆ—è¡¨æ·»åŠ æ¯›åˆ©ç‡åˆ—
2. æ·»åŠ æ¯›åˆ©ç‡ç­›é€‰å’Œæ’åº
3. åœ¨è¯¦æƒ…é¡µæ˜¾ç¤ºæˆæœ¬æ˜ç»†

### Phase 5: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ2å¤©ï¼‰

#### æ­¥éª¤5.1: åŠŸèƒ½æµ‹è¯•ï¼ˆ1å¤©ï¼‰

1. è´¢åŠ¡æ¨¡å—åŠŸèƒ½æµ‹è¯•
2. å†…éƒ¨å‡ºå…¥åº“åŠŸèƒ½æµ‹è¯•
3. é”€å”®è®¢å•æ¯›åˆ©ç‡è®¡ç®—æµ‹è¯•

#### æ­¥éª¤5.2: æ€§èƒ½ä¼˜åŒ–å’ŒBugä¿®å¤ï¼ˆ1å¤©ï¼‰

1. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
2. ä¿®å¤å‘ç°çš„Bug
3. ä¼˜åŒ–å‰ç«¯äº¤äº’

---

## äº”ã€å…³é”®æ–‡ä»¶è·¯å¾„

### æ•°æ®åº“è„šæœ¬

- `sql/mysql/erp-finance-tables.sql` - è´¢åŠ¡æ¨¡å—6å¼ è¡¨
- `sql/mysql/erp-stock-internal-tables.sql` - å†…éƒ¨å‡ºå…¥åº“4å¼ è¡¨
- `sql/mysql/erp-sale-order-gross-profit-fields.sql` - é”€å”®è®¢å•å­—æ®µæ‰©å±•

### åç«¯ä»£ç 

#### è´¢åŠ¡æ¨¡å—
- `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/dataobject/finance/`
  - `ErpFinanceBalanceSheetDO.java`
  - `ErpFinanceReceivableDO.java`
  - `ErpFinancePayableDO.java`
  - `ErpFinancePrepaymentDO.java`
  - `ErpFinancePrereceiptDO.java`
  - `ErpFinanceProfitStatementDO.java`

- `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/service/finance/`
  - `ErpFinanceBalanceSheetService.java`
  - `ErpFinanceReceivableService.java`
  - `ErpFinancePayableService.java`
  - `ErpFinancePrepaymentService.java`
  - `ErpFinancePrereceiptService.java`
  - `ErpFinanceProfitStatementService.java`

#### åº“å­˜æ¨¡å—
- `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/dataobject/stock/`
  - `ErpStockInternalInDO.java`
  - `ErpStockInternalInItemDO.java`
  - `ErpStockInternalOutDO.java`
  - `ErpStockInternalOutItemDO.java`

- `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/service/stock/`
  - `ErpStockInternalInService.java`
  - `ErpStockInternalOutService.java`

#### é”€å”®æ¨¡å—
- `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/dataobject/sale/ErpSaleOrderDO.java` - æ·»åŠ å­—æ®µ
- `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/service/sale/ErpSaleOrderService.java` - æ·»åŠ æˆæœ¬è®¡ç®—

#### æšä¸¾
- `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/enums/ErpInternalType.java` - æ–°å»º
- `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/enums/stock/ErpStockRecordBizTypeEnum.java` - æ‰©å±•

### å‰ç«¯ä»£ç 

#### è´¢åŠ¡æ¨¡å—
- `original-yudao-ui/src/api/erp/finance/` - APIæ–‡ä»¶
- `original-yudao-ui/src/views/erp/finance/` - é¡µé¢æ–‡ä»¶

#### åº“å­˜æ¨¡å—
- `original-yudao-ui/src/api/erp/stock/internal-in/` - å†…éƒ¨å…¥åº“API
- `original-yudao-ui/src/api/erp/stock/internal-out/` - å†…éƒ¨å‡ºåº“API
- `original-yudao-ui/src/views/erp/stock/internal-in/` - å†…éƒ¨å…¥åº“é¡µé¢
- `original-yudao-ui/src/views/erp/stock/internal-out/` - å†…éƒ¨å‡ºåº“é¡µé¢

#### é”€å”®æ¨¡å—
- `original-yudao-ui/src/views/erp/sale/order/index.vue` - åˆ—è¡¨é¡µé¢ä¼˜åŒ–

---

## å…­ã€æ³¨æ„äº‹é¡¹

### 6.1 ä»£ç ç”Ÿæˆå™¨ä½¿ç”¨æ³¨æ„äº‹é¡¹

1. **ä¸è¦ç›´æ¥è¦†ç›–ç°æœ‰æ–‡ä»¶**
   - å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œå…ˆå¤‡ä»½
   - ErrorCodeå¿…é¡»æ‰‹åŠ¨åˆå¹¶ï¼Œä¸èƒ½ç›´æ¥è¦†ç›–

2. **æ£€æŸ¥ç”Ÿæˆçš„ä»£ç **
   - æ£€æŸ¥åŒ…åå’Œå¯¼å…¥è·¯å¾„
   - æ£€æŸ¥å­—æ®µæ˜ å°„æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥å…³è”æŸ¥è¯¢æ˜¯å¦æ­£ç¡®

3. **å­—æ®µé…ç½®**
   - å…³è”å­—æ®µï¼ˆcustomer_id, supplier_idç­‰ï¼‰éœ€è¦é…ç½®ä¸ºé€‰æ‹©å™¨ç±»å‹
   - é‡‘é¢å­—æ®µéœ€è¦é…ç½®ä¸ºæ•°å­—è¾“å…¥æ¡†
   - æ—¥æœŸå­—æ®µéœ€è¦é…ç½®ä¸ºæ—¥æœŸé€‰æ‹©å™¨
   - çŠ¶æ€å­—æ®µéœ€è¦é…ç½®ä¸ºæšä¸¾é€‰æ‹©å™¨

### 6.2 ä¸šåŠ¡é€»è¾‘æ³¨æ„äº‹é¡¹

1. **è´¢åŠ¡æ¨¡å—**
   - åº”æ”¶è´¦æ¬¾/åº”ä»˜è´¦æ¬¾è‡ªåŠ¨ç”Ÿæˆéœ€è¦åœ¨è®¢å•å®¡æ ¸é€šè¿‡æ—¶è§¦å‘
   - æ ¸é”€é€»è¾‘éœ€è¦åœ¨æ”¶æ¬¾å•/ä»˜æ¬¾å•å®¡æ ¸é€šè¿‡æ—¶è§¦å‘
   - èµ„äº§è´Ÿå€ºè¡¨/åˆ©æ¶¦è¡¨éœ€è¦æä¾›æ‰‹åŠ¨è®¡ç®—æŒ‰é’®ï¼Œä¹Ÿæ”¯æŒè‡ªåŠ¨è®¡ç®—

2. **å†…éƒ¨å‡ºå…¥åº“**
   - å¿…é¡»å…³è”å‘˜å·¥ï¼Œéƒ¨é—¨å¯é€‰
   - å®¡æ‰¹æµç¨‹ä¸ç°æœ‰å‡ºå…¥åº“ä¿æŒä¸€è‡´
   - åº“å­˜æ›´æ–°é€»è¾‘ä¸ç°æœ‰å‡ºå…¥åº“ä¿æŒä¸€è‡´

3. **æ¯›åˆ©ç‡è®¡ç®—**
   - BOMæ•°æ®å¿…é¡»å®Œæ•´ï¼Œå¦åˆ™æ— æ³•è®¡ç®—åŸææ–™æˆæœ¬
   - å·¥è‰ºè·¯çº¿æ•°æ®å¿…é¡»å®Œæ•´ï¼Œå¦åˆ™æ— æ³•è®¡ç®—å‘˜å·¥æˆæœ¬
   - å¦‚æœBOMæˆ–å·¥è‰ºè·¯çº¿ä¸å­˜åœ¨ï¼Œæˆæœ¬ä¸º0ï¼Œæ¯›åˆ©ç‡ä¸º100%
   - æ”¯æŒæ‰‹åŠ¨è°ƒæ•´æˆæœ¬æ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰

### 6.3 æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®åº“ç´¢å¼•**
   - ä¸ºå…³è”å­—æ®µæ·»åŠ ç´¢å¼•ï¼ˆcustomer_id, supplier_id, order_idç­‰ï¼‰
   - ä¸ºæŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•ï¼ˆperiod_date, statusç­‰ï¼‰

2. **æŸ¥è¯¢ä¼˜åŒ–**
   - ä½¿ç”¨å…³è”æŸ¥è¯¢å‡å°‘æ•°æ®åº“è®¿é—®æ¬¡æ•°
   - ä½¿ç”¨ç¼“å­˜æé«˜æŸ¥è¯¢æ€§èƒ½ï¼ˆå¦‚æœéœ€è¦ï¼‰

3. **è®¡ç®—ä¼˜åŒ–**
   - æ¯›åˆ©ç‡è®¡ç®—å¯ä»¥å¼‚æ­¥æ‰§è¡Œï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼‰
   - èµ„äº§è´Ÿå€ºè¡¨/åˆ©æ¶¦è¡¨è®¡ç®—å¯ä»¥å®šæ—¶ä»»åŠ¡æ‰§è¡Œ

### 6.4 èœå•å’Œæƒé™é…ç½®

æ‰€æœ‰æ–°åŠŸèƒ½éœ€è¦ï¼š

1. **æ·»åŠ èœå•**
   - åœ¨ç³»ç»Ÿç®¡ç† â†’ èœå•ç®¡ç†ä¸­æ·»åŠ èœå•é¡¹
   - é…ç½®èœå•è·¯å¾„å’Œç»„ä»¶è·¯å¾„

2. **é…ç½®æƒé™**
   - ä¸ºè§’è‰²åˆ†é…ç›¸åº”çš„æƒé™
   - æµ‹è¯•ä¸åŒè§’è‰²çš„æƒé™æ§åˆ¶

3. **è·¯ç”±é…ç½®**
   - å‰ç«¯è·¯ç”±éœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ°è·¯ç”±é…ç½®æ–‡ä»¶ä¸­

### 6.5 æµ‹è¯•æ¸…å•

#### è´¢åŠ¡æ¨¡å—æµ‹è¯•
- [ ] åº”æ”¶è´¦æ¬¾è‡ªåŠ¨ç”Ÿæˆï¼ˆé”€å”®è®¢å•å®¡æ ¸é€šè¿‡åï¼‰
- [ ] åº”æ”¶è´¦æ¬¾æ ¸é”€ï¼ˆæ”¶æ¬¾å•å®¡æ ¸é€šè¿‡åï¼‰
- [ ] åº”ä»˜è´¦æ¬¾è‡ªåŠ¨ç”Ÿæˆï¼ˆé‡‡è´­è®¢å•å®¡æ ¸é€šè¿‡åï¼‰
- [ ] åº”ä»˜è´¦æ¬¾æ ¸é”€ï¼ˆä»˜æ¬¾å•å®¡æ ¸é€šè¿‡åï¼‰
- [ ] é¢„ä»˜æ¬¾/é¢„æ”¶æ¬¾æ‰‹åŠ¨å½•å…¥
- [ ] é¢„ä»˜æ¬¾/é¢„æ”¶æ¬¾è‡ªåŠ¨æ ¸é”€
- [ ] èµ„äº§è´Ÿå€ºè¡¨è‡ªåŠ¨è®¡ç®—
- [ ] åˆ©æ¶¦è¡¨è‡ªåŠ¨è®¡ç®—

#### å†…éƒ¨å‡ºå…¥åº“æµ‹è¯•
- [ ] å†…éƒ¨å…¥åº“åˆ›å»ºå’Œå®¡æ ¸
- [ ] å†…éƒ¨å‡ºåº“åˆ›å»ºå’Œå®¡æ ¸
- [ ] å‘˜å·¥å’Œéƒ¨é—¨é€‰æ‹©å™¨
- [ ] åº“å­˜æ›´æ–°æ­£ç¡®æ€§
- [ ] åº“å­˜è®°å½•åˆ›å»ºæ­£ç¡®æ€§

#### é”€å”®è®¢å•æ¯›åˆ©ç‡æµ‹è¯•
- [ ] æ¯›åˆ©ç‡è‡ªåŠ¨è®¡ç®—ï¼ˆæœ‰BOMå’Œå·¥è‰ºè·¯çº¿ï¼‰
- [ ] æ¯›åˆ©ç‡è®¡ç®—ï¼ˆç¼ºå°‘BOMæˆ–å·¥è‰ºè·¯çº¿ï¼‰
- [ ] åˆ—è¡¨å±•ç¤ºæ¯›åˆ©ç‡
- [ ] æ¯›åˆ©ç‡ç­›é€‰å’Œæ’åº
- [ ] æˆæœ¬æ˜ç»†å±•ç¤º

---

## ä¸ƒã€å¼€å‘æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | æ—¶é—´ |
|------|------|------|
| Phase 1 | æ•°æ®åº“è¡¨åˆ›å»º | 2å¤© |
| Phase 2 | ä»£ç ç”Ÿæˆ | 3å¤© |
| Phase 3 | ä¸šåŠ¡é€»è¾‘å¼€å‘ | 5å¤© |
| Phase 4 | å‰ç«¯ä¼˜åŒ– | 3å¤© |
| Phase 5 | æµ‹è¯•å’Œä¼˜åŒ– | 2å¤© |
| **æ€»è®¡** | | **15å¤©** |

---

## å…«ã€åç»­ä¼˜åŒ–å»ºè®®

1. **è´¢åŠ¡æ¨¡å—**
   - æ”¯æŒå¤šå¸ç§
   - æ”¯æŒæ±‡ç‡è½¬æ¢
   - æ”¯æŒè´¢åŠ¡æŠ¥è¡¨å¯¼å‡ºï¼ˆExcelã€PDFï¼‰

2. **å†…éƒ¨å‡ºå…¥åº“**
   - æ”¯æŒæ‰¹é‡æ“ä½œ
   - æ”¯æŒå®¡æ‰¹æµç¨‹é…ç½®
   - æ”¯æŒåº“å­˜é¢„è­¦

3. **æ¯›åˆ©ç‡ç»Ÿè®¡**
   - æ”¯æŒå†å²æˆæœ¬è¿½æº¯
   - æ”¯æŒæˆæœ¬åˆ†ææŠ¥è¡¨
   - æ”¯æŒæ¯›åˆ©ç‡è¶‹åŠ¿åˆ†æ

---

**æ–‡æ¡£ç»“æŸ**

