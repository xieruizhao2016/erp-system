# 工序模块404问题修复说明

## 问题描述
访问工序管理页面时出现404错误："请求出错，请稍候重试404"

## 可能原因

### 1. 前端路由未刷新
前端路由是动态生成的，需要重新加载才能识别新菜单。

### 2. 组件路径匹配问题
路由生成时通过 `modulesRoutesKeys.findIndex((ev) => ev.includes(route.component))` 来查找组件。

## 解决方案

### 方案1：刷新页面并重新登录（推荐）

1. **清除浏览器缓存**
   - 按 `Ctrl+Shift+Delete` (Windows) 或 `Cmd+Shift+Delete` (Mac)
   - 清除缓存和Cookie

2. **重新登录系统**
   - 退出登录
   - 重新登录
   - 系统会重新加载菜单和路由

3. **访问工序管理**
   - 登录后，在左侧菜单中找到 **ERP系统** → **生产管理** → **工序管理**
   - 或直接访问：`http://localhost:81/erp/process`

### 方案2：检查菜单配置

如果方案1不行，检查菜单配置是否正确：

```sql
-- 检查菜单配置
SELECT id, name, path, component, component_name, parent_id 
FROM system_menu 
WHERE id = 6006;
```

应该返回：
- `id`: 6006
- `name`: 工序管理
- `path`: process
- `component`: erp/process/index
- `component_name`: Process
- `parent_id`: 5042

### 方案3：验证文件是否存在

检查前端文件是否存在：

```bash
ls -la original-yudao-ui/src/views/erp/process/
```

应该看到：
- `index.vue` - 列表页面
- `ProcessForm.vue` - 表单页面

### 方案4：检查路由生成

在浏览器控制台（F12）中检查：

1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 查看是否有路由相关的错误信息
4. 检查 Network 标签，查看请求是否发送到正确的路径

### 方案5：手动刷新路由（开发环境）

如果是开发环境，可以：

1. 停止前端服务（Ctrl+C）
2. 重新启动前端服务：
   ```bash
   cd original-yudao-ui
   npm run dev
   ```

## 验证步骤

### 1. 检查菜单是否显示
- 登录系统后，检查左侧菜单中是否有"工序管理"
- 位置：ERP系统 → 生产管理 → 工序管理

### 2. 检查路由是否正确
- 点击菜单后，URL应该是：`/erp/process`
- 不应该出现404错误

### 3. 检查组件是否加载
- 页面应该显示工序管理的列表页面
- 有搜索框、新增按钮等

## 常见问题

### Q1: 菜单不显示
**A**: 检查角色权限配置
- 进入：系统管理 → 角色管理
- 编辑角色，勾选"工序管理"相关权限

### Q2: 点击菜单后404
**A**: 
1. 清除浏览器缓存
2. 重新登录
3. 检查浏览器控制台错误信息

### Q3: 页面显示但数据加载失败
**A**: 检查后端API是否正常
- 访问：http://localhost:48080/swagger-ui
- 查找 `/erp/process/page` 接口
- 测试接口是否正常

## 技术细节

### 路由生成逻辑

路由生成在 `original-yudao-ui/src/utils/routerHelper.ts` 中：

```typescript
const index = route?.component
  ? modulesRoutesKeys.findIndex((ev) => ev.includes(route.component))
  : modulesRoutesKeys.findIndex((ev) => ev.includes(route.path))
data.component = modules[modulesRoutesKeys[index]]
```

组件路径匹配规则：
- `component` 配置：`erp/process/index`
- 实际文件路径：`../views/erp/process/index.vue`
- 匹配逻辑：`ev.includes(route.component)` 会匹配包含 `erp/process/index` 的路径

### 文件结构

```
original-yudao-ui/src/
├── api/erp/process/
│   └── index.ts              # API接口定义
└── views/erp/process/
    ├── index.vue             # 列表页面
    └── ProcessForm.vue       # 表单页面
```

## 如果问题仍然存在

1. **检查后端日志**
   ```bash
   tail -f nohup.out
   ```
   查看是否有相关错误

2. **检查前端日志**
   - 打开浏览器控制台（F12）
   - 查看 Console 和 Network 标签
   - 查找错误信息

3. **验证数据库**
   ```sql
   -- 检查菜单
   SELECT * FROM system_menu WHERE id = 6006;
   
   -- 检查权限
   SELECT * FROM system_menu WHERE parent_id = 6006;
   ```

4. **重新执行菜单SQL**
   ```bash
   mysql -uroot -p123456 ruoyi-vue-pro < sql/mysql/erp-process-menu.sql
   ```

## 联系支持

如果以上方案都无法解决问题，请提供：
1. 浏览器控制台的错误信息
2. 后端日志中的错误信息
3. 菜单配置的SQL查询结果
4. 文件是否存在的结果

