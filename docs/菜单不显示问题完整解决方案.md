# èœå•ä¸æ˜¾ç¤ºé—®é¢˜å®Œæ•´è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜è¯Šæ–­

å¦‚æœæ¸…é™¤æµè§ˆå™¨ç¼“å­˜åä»ç„¶çœ‹ä¸åˆ°æ–°èœå•ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é€ä¸€æ’æŸ¥ï¼š

## âœ… æ­¥éª¤1ï¼šç¡®è®¤èœå•å·²åˆ›å»º

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥èœå•æ˜¯å¦å·²åˆ›å»ºï¼š

```bash
# æ£€æŸ¥è´¢åŠ¡èœå•
mysql -u root -p123456 ruoyi-vue-pro -e "SELECT id, name, path, component, status, visible FROM system_menu WHERE parent_id = 2645 ORDER BY sort;"

# æ£€æŸ¥åº“å­˜èœå•
mysql -u root -p123456 ruoyi-vue-pro -e "SELECT id, name, path, component, status, visible FROM system_menu WHERE parent_id = 2583 ORDER BY sort;"
```

**æœŸæœ›ç»“æœ**ï¼š
- è´¢åŠ¡ç®¡ç†åº”è¯¥æœ‰9ä¸ªèœå•
- åº“å­˜ç®¡ç†åº”è¯¥æœ‰9ä¸ªèœå•
- æ‰€æœ‰èœå•çš„ `status = 0`ï¼ˆå¯ç”¨ï¼‰ä¸” `visible = 1`ï¼ˆå¯è§ï¼‰

## âœ… æ­¥éª¤2ï¼šç¡®è®¤è§’è‰²æƒé™å·²åˆ†é…

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ä½ çš„è§’è‰²æ˜¯å¦æœ‰èœå•æƒé™ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰è§’è‰²çš„èœå•æƒé™æ•°é‡
mysql -u root -p123456 ruoyi-vue-pro -e "SELECT r.id, r.name, COUNT(rm.menu_id) as menu_count FROM system_role r LEFT JOIN system_role_menu rm ON r.id = rm.role_id AND rm.menu_id IN (SELECT id FROM system_menu WHERE parent_id IN (2645, 2583)) WHERE r.status = 0 GROUP BY r.id, r.name ORDER BY r.id;"
```

**æœŸæœ›ç»“æœ**ï¼š
- ä½ ä½¿ç”¨çš„è§’è‰²åº”è¯¥æœ‰è‡³å°‘18ä¸ªèœå•æƒé™ï¼ˆ9ä¸ªè´¢åŠ¡ + 9ä¸ªåº“å­˜ï¼‰

**å¦‚æœæƒé™ä¸è¶³ï¼Œè¿è¡Œä¿®å¤è„šæœ¬**ï¼š
```bash
./scripts/fix-menu-display.sh
```

æˆ–è€…æ‰‹åŠ¨æ‰§è¡ŒSQLï¼š
```bash
mysql -u root -p123456 ruoyi-vue-pro < sql/mysql/fix-all-roles-menu-permissions.sql
```

## âœ… æ­¥éª¤3ï¼šå½»åº•æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### æ–¹æ³•Aï¼šä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆæ¨èï¼‰

1. **æ‰“å¼€å¼€å‘è€…å·¥å…·**
   - Chrome/Edge: æŒ‰ `F12` æˆ– `Cmd+Option+I` (Mac) / `Ctrl+Shift+I` (Windows)
   - Firefox: æŒ‰ `F12` æˆ– `Cmd+Option+I` (Mac) / `Ctrl+Shift+I` (Windows)

2. **æ¸…é™¤ Local Storage**
   - ç‚¹å‡» **Application** æ ‡ç­¾ï¼ˆChromeï¼‰æˆ– **å­˜å‚¨** æ ‡ç­¾ï¼ˆFirefoxï¼‰
   - åœ¨å·¦ä¾§æ‰¾åˆ° **Local Storage**
   - ç‚¹å‡»ä½ çš„ç½‘ç«™åŸŸåï¼ˆå¦‚ `http://localhost:5173`ï¼‰
   - æ‰¾åˆ°å¹¶åˆ é™¤ä»¥ä¸‹é”®ï¼š
     - `ROLE_ROUTERS`
     - `USER`
     - `LAYOUT`
     - `IS_DARK`
   - æˆ–è€…ç›´æ¥å³é”®ç‚¹å‡»åŸŸåï¼Œé€‰æ‹© **Clear**

3. **æ¸…é™¤ Session Storage**
   - åœ¨åŒä¸€ä¸ªæ ‡ç­¾é¡µï¼Œæ‰¾åˆ° **Session Storage**
   - åŒæ ·åˆ é™¤ä¸Šè¿°é”®

4. **æ¸…é™¤ Cookie**
   - åœ¨ **Cookies** ä¸‹æ‰¾åˆ°ä½ çš„åŸŸå
   - åˆ é™¤æ‰€æœ‰ Cookie

5. **ç¡¬åˆ·æ–°é¡µé¢**
   - Mac: `Cmd+Shift+R`
   - Windows: `Ctrl+Shift+R`
   - æˆ–è€…æŒ‰ `F5` å¤šæ¬¡åˆ·æ–°

### æ–¹æ³•Bï¼šä½¿ç”¨æ— ç—•æ¨¡å¼ï¼ˆæœ€ç®€å•ï¼‰

1. æ‰“å¼€æµè§ˆå™¨çš„æ— ç—•/éšç§æ¨¡å¼
   - Chrome: `Cmd+Shift+N` (Mac) / `Ctrl+Shift+N` (Windows)
   - Firefox: `Cmd+Shift+P` (Mac) / `Ctrl+Shift+P` (Windows)
   - Safari: `Cmd+Shift+N` (Mac)

2. è®¿é—®ç³»ç»Ÿå¹¶ç™»å½•
3. æ£€æŸ¥èœå•æ˜¯å¦æ˜¾ç¤º

### æ–¹æ³•Cï¼šä½¿ç”¨æµè§ˆå™¨è®¾ç½®

1. æ‰“å¼€æµè§ˆå™¨è®¾ç½®
2. è¿›å…¥ **éšç§å’Œå®‰å…¨** æˆ– **æ¸…é™¤æµè§ˆæ•°æ®**
3. é€‰æ‹© **æ¸…é™¤ç¼“å­˜** å’Œ **Cookie**
4. æ—¶é—´èŒƒå›´é€‰æ‹© **å…¨éƒ¨æ—¶é—´**
5. ç‚¹å‡» **æ¸…é™¤æ•°æ®**
6. é‡å¯æµè§ˆå™¨

## âœ… æ­¥éª¤4ï¼šé‡å¯åç«¯æœåŠ¡

å¦‚æœæ¸…é™¤ç¼“å­˜åä»ä¸æ˜¾ç¤ºï¼Œå¯èƒ½æ˜¯åç«¯ç¼“å­˜äº†æ—§çš„èœå•æ•°æ®ï¼š

```bash
# åœæ­¢åç«¯æœåŠ¡
pkill -f yudao-server

# ç­‰å¾…2ç§’
sleep 2

# é‡æ–°å¯åŠ¨åç«¯æœåŠ¡
cd /Users/xierui/Documents/Project/Other/erp-system
./scripts/dev/start-backend.sh -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆçº¦10-15ç§’ï¼‰
sleep 15

# æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨
lsof -i :48080
```

## âœ… æ­¥éª¤5ï¼šæ£€æŸ¥APIå“åº”

åœ¨æµè§ˆå™¨ä¸­æ£€æŸ¥åç«¯APIæ˜¯å¦è¿”å›äº†æ–°èœå•ï¼š

1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. è¿›å…¥ **Network** æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. æ‰¾åˆ° `/admin-api/system/auth/get-permission-info` è¯·æ±‚
5. ç‚¹å‡»æŸ¥çœ‹ **Response**
6. åœ¨å“åº”ä¸­æœç´¢ `"name":"åº”æ”¶è´¦æ¬¾"` æˆ– `"name":"å†…éƒ¨å…¥åº“"`
7. å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¯´æ˜åç«¯æ²¡æœ‰è¿”å›æ–°èœå•

**å¦‚æœAPIå“åº”ä¸­æ²¡æœ‰æ–°èœå•**ï¼š
- æ£€æŸ¥åç«¯æ—¥å¿—ï¼š`tail -f nohup.out`
- ç¡®è®¤åç«¯æœåŠ¡å·²é‡å¯
- æ£€æŸ¥æ•°æ®åº“ä¸­çš„èœå•é…ç½®

## âœ… æ­¥éª¤6ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. è¿›å…¥ **Console** æ ‡ç­¾
3. æŸ¥çœ‹æ˜¯å¦æœ‰çº¢è‰²é”™è¯¯ä¿¡æ¯
4. å¸¸è§é”™è¯¯ï¼š
   - `Cannot read property 'xxx' of undefined` - å¯èƒ½æ˜¯èœå•æ•°æ®ç»“æ„é—®é¢˜
   - `404 Not Found` - å¯èƒ½æ˜¯è·¯ç”±é…ç½®é—®é¢˜
   - `401 Unauthorized` - å¯èƒ½æ˜¯ç™»å½•çŠ¶æ€é—®é¢˜

## âœ… æ­¥éª¤7ï¼šéªŒè¯èœå•è·¯å¾„

æ£€æŸ¥å‰ç«¯æ–‡ä»¶è·¯å¾„æ˜¯å¦ä¸æ•°æ®åº“ä¸­çš„ `component` å­—æ®µåŒ¹é…ï¼š

```bash
# æ£€æŸ¥è´¢åŠ¡èœå•çš„ç»„ä»¶è·¯å¾„
mysql -u root -p123456 ruoyi-vue-pro -e "SELECT name, component FROM system_menu WHERE parent_id = 2645 AND component IS NOT NULL AND component != '';"

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la original-yudao-ui/src/views/erp/finance/receivable/index.vue
ls -la original-yudao-ui/src/views/erp/finance/payable/index.vue
ls -la original-yudao-ui/src/views/erp/stock/internal-in/index.vue
ls -la original-yudao-ui/src/views/erp/stock/internal-out/index.vue
```

## ğŸ”§ å¿«é€Ÿä¿®å¤è„šæœ¬

è¿è¡Œè‡ªåŠ¨ä¿®å¤è„šæœ¬ï¼š

```bash
./scripts/fix-menu-display.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. æ£€æŸ¥èœå•é…ç½®
2. æ£€æŸ¥è§’è‰²æƒé™
3. è‡ªåŠ¨ä¿®å¤æƒé™é—®é¢˜
4. æä¾›è¯¦ç»†çš„ä¿®å¤å»ºè®®

## ğŸ“‹ æ£€æŸ¥æ¸…å•

åœ¨æŠ¥å‘Šé—®é¢˜å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] èœå•å·²åœ¨æ•°æ®åº“ä¸­åˆ›å»ºï¼ˆ9ä¸ªè´¢åŠ¡ + 9ä¸ªåº“å­˜ï¼‰
- [ ] èœå•çŠ¶æ€ä¸ºå¯ç”¨ï¼ˆstatus = 0ï¼‰
- [ ] èœå•å¯è§ï¼ˆvisible = 1ï¼‰
- [ ] è§’è‰²æƒé™å·²åˆ†é…ï¼ˆè‡³å°‘18ä¸ªèœå•æƒé™ï¼‰
- [ ] æµè§ˆå™¨ç¼“å­˜å·²æ¸…é™¤
- [ ] åç«¯æœåŠ¡å·²é‡å¯
- [ ] å·²ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— é”™è¯¯
- [ ] APIå“åº”åŒ…å«æ–°èœå•

## ğŸ†˜ å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½ä¸è¡Œ

1. **æ£€æŸ¥ç”¨æˆ·å½“å‰ä½¿ç”¨çš„è§’è‰²**
   ```sql
   SELECT u.id, u.username, u.nickname, r.id as role_id, r.name as role_name
   FROM system_users u
   JOIN system_user_role ur ON u.id = ur.user_id
   JOIN system_role r ON ur.role_id = r.id
   WHERE u.username = 'ä½ çš„ç”¨æˆ·å';
   ```

2. **æ‰‹åŠ¨ä¸ºä½ çš„è§’è‰²åˆ†é…æƒé™**
   - ç™»å½•ç³»ç»Ÿç®¡ç†åå°
   - è¿›å…¥ï¼šç³»ç»Ÿç®¡ç† â†’ è§’è‰²ç®¡ç†
   - ç¼–è¾‘ä½ ä½¿ç”¨çš„è§’è‰²
   - åœ¨èœå•æƒé™ä¸­ï¼Œå‹¾é€‰æ‰€æœ‰è´¢åŠ¡å’Œåº“å­˜ç®¡ç†èœå•
   - ä¿å­˜åé‡æ–°ç™»å½•

3. **æ£€æŸ¥èœå•çš„çˆ¶çº§èœå•**
   ```sql
   -- æ£€æŸ¥è´¢åŠ¡ç®¡ç†çš„çˆ¶èœå•
   SELECT id, name, path, status, visible FROM system_menu WHERE id = 2645;
   
   -- æ£€æŸ¥åº“å­˜ç®¡ç†çš„çˆ¶èœå•
   SELECT id, name, path, status, visible FROM system_menu WHERE id = 2583;
   ```

4. **æŸ¥çœ‹åç«¯æ—¥å¿—**
   ```bash
   tail -f nohup.out | grep -i "menu\|permission\|auth"
   ```

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æ“ä½œåé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯ï¼ˆæˆªå›¾ï¼‰
2. Networkæ ‡ç­¾ä¸­ `/admin-api/system/auth/get-permission-info` çš„å“åº”å†…å®¹
3. ä½ å½“å‰ä½¿ç”¨çš„è§’è‰²IDå’Œåç§°
4. åç«¯æ—¥å¿—ä¸­çš„ç›¸å…³é”™è¯¯ä¿¡æ¯

