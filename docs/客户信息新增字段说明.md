# 客户信息新增字段说明

## 📋 概述

本次更新为销售管理-客户信息模块新增了三个字段：

1. **收货地址** - 用于记录客户的收货地址
2. **付款方式** - 支持现结、月结、年结三种方式
3. **客户要求** - 用于记录客户的特殊要求

## 🔧 修改文件清单

### 1. 数据库相关

#### 1.1 表结构更新
**文件路径**: `/sql/mysql/erp-tables.sql`

在 `erp_customer` 表中新增三个字段：
```sql
`shipping_address` varchar(500) NULL DEFAULT '' COMMENT '收货地址'
`payment_method` varchar(50) NULL DEFAULT '' COMMENT '付款方式'
`customer_requirements` text NULL COMMENT '客户要求'
```

#### 1.2 数据库迁移脚本
**文件路径**: `/sql/mysql/erp_customer_add_fields_migration.sql`

为现有数据库添加新字段的迁移脚本，可直接执行：
```bash
mysql -u root -p erp_database < sql/mysql/erp_customer_add_fields_migration.sql
```

#### 1.3 付款方式字典配置
**文件路径**: `/sql/mysql/erp_customer_payment_method_dict.sql`

新增付款方式字典类型和字典数据：
- 字典类型：`erp_customer_payment_method`
- 字典数据：现结、月结、年结

执行方式：
```bash
mysql -u root -p erp_database < sql/mysql/erp_customer_payment_method_dict.sql
```

### 2. 后端代码修改

#### 2.1 实体类 (DO)
**文件路径**: `/yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/dataobject/sale/ErpCustomerDO.java`

新增字段：
```java
private String shippingAddress;      // 收货地址
private String paymentMethod;        // 付款方式
private String customerRequirements; // 客户要求
```

#### 2.2 请求VO
**文件路径**: `/yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/sale/vo/customer/ErpCustomerSaveReqVO.java`

新增字段及Swagger注解：
```java
@Schema(description = "收货地址", example = "上海市浦东新区张江高科技园区")
private String shippingAddress;

@Schema(description = "付款方式", example = "月结")
private String paymentMethod;

@Schema(description = "客户要求", example = "需要提前通知发货")
private String customerRequirements;
```

#### 2.3 响应VO
**文件路径**: `/yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/sale/vo/customer/ErpCustomerRespVO.java`

新增字段及Excel导出注解：
```java
@Schema(description = "收货地址", example = "上海市浦东新区张江高科技园区")
@ExcelProperty("收货地址")
private String shippingAddress;

@Schema(description = "付款方式", example = "月结")
@ExcelProperty("付款方式")
private String paymentMethod;

@Schema(description = "客户要求", example = "需要提前通知发货")
@ExcelProperty("客户要求")
private String customerRequirements;
```

### 3. 前端代码修改

#### 3.1 API类型定义
**文件路径**: `/original-yudao-ui/src/api/erp/sale/customer/index.ts`

在 `CustomerVO` 接口中新增字段：
```typescript
shippingAddress: string      // 收货地址
paymentMethod: string        // 付款方式
customerRequirements: string // 客户要求
```

#### 3.2 表单页面
**文件路径**: `/original-yudao-ui/src/views/erp/sale/customer/CustomerForm.vue`

新增表单项：

1. **收货地址** - 文本输入框
```vue
<el-form-item label="收货地址" prop="shippingAddress">
  <el-input v-model="formData.shippingAddress" placeholder="请输入收货地址" />
</el-form-item>
```

2. **付款方式** - 下拉选择框
```vue
<el-form-item label="付款方式" prop="paymentMethod">
  <el-select v-model="formData.paymentMethod" placeholder="请选择付款方式" class="!w-1/1">
    <el-option label="现结" value="现结" />
    <el-option label="月结" value="月结" />
    <el-option label="年结" value="年结" />
  </el-select>
</el-form-item>
```

3. **客户要求** - 多行文本框
```vue
<el-form-item label="客户要求" prop="customerRequirements">
  <el-input type="textarea" v-model="formData.customerRequirements" placeholder="请输入客户要求" :rows="3" />
</el-form-item>
```

## 📦 部署步骤

### 1. 数据库更新

```bash
# 执行迁移脚本，添加新字段
mysql -u root -p erp_database < sql/mysql/erp_customer_add_fields_migration.sql

# 导入付款方式字典数据
mysql -u root -p erp_database < sql/mysql/erp_customer_payment_method_dict.sql
```

### 2. 后端部署

```bash
# 重新编译后端代码
cd yudao-module-erp
mvn clean install

# 重启后端服务
./start-backend.sh
```

### 3. 前端部署

```bash
# 进入前端目录
cd original-yudao-ui

# 重新构建前端
npm run build:prod

# 重启前端服务（如果使用nginx，需要更新静态文件）
```

## ✅ 功能验证

### 1. 功能测试

1. 登录系统，进入 **销售管理 > 客户信息**
2. 点击 **新增** 按钮
3. 验证以下功能：
   - 收货地址输入框正常显示和输入
   - 付款方式下拉框包含三个选项：现结、月结、年结
   - 客户要求多行文本框正常显示和输入
4. 填写完整信息后点击 **确定**
5. 在列表页查看新增的客户信息
6. 点击 **编辑** 按钮，验证新字段可以正常回显和修改

### 2. 数据验证

直接查询数据库验证：
```sql
SELECT id, name, shipping_address, payment_method, customer_requirements 
FROM erp_customer 
WHERE deleted = 0 
ORDER BY id DESC 
LIMIT 10;
```

### 3. Excel导出验证

1. 在客户列表页点击 **导出** 按钮
2. 下载Excel文件
3. 验证Excel中包含新增的三个字段列

## 🎨 界面效果

在客户信息新增/编辑表单中，新字段的布局为：

```
| 开户行              | 开户账号          |
| 开户地址            | 收货地址          |
| 付款方式            |                   |
| 客户要求                                |
| 备注                                    |
```

## 📝 注意事项

1. **数据迁移**：执行迁移脚本前，建议先备份数据库
2. **字段验证**：新字段均为非必填项，不影响现有数据
3. **付款方式**：当前使用硬编码选项，后续可改为从字典表动态加载
4. **权限配置**：确保用户有客户信息的新增和编辑权限

## 🔄 后续优化建议

1. **付款方式字典化**：将前端付款方式选项改为从字典表动态加载
   ```vue
   <el-select v-model="formData.paymentMethod" placeholder="请选择付款方式" class="!w-1/1">
     <el-option
       v-for="dict in getIntDictOptions(DICT_TYPE.ERP_CUSTOMER_PAYMENT_METHOD)"
       :key="dict.value"
       :label="dict.label"
       :value="dict.value"
     />
   </el-select>
   ```

2. **收货地址联动**：可以考虑与地址库联动，提供省市区三级联动选择

3. **客户要求模板**：为常见的客户要求提供快捷选择模板

4. **字段验证**：根据业务需求添加字段格式验证

## 📞 技术支持

如有问题，请联系技术支持团队。

---
**更新时间**: 2025年11月21日  
**版本**: v1.0

