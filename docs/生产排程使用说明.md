# 生产排程使用说明

## 📋 概述

生产排程是生产管理系统的核心功能之一，用于根据生产订单、工艺路线、设备资源等信息，合理安排生产计划，优化生产资源的利用，确保生产任务按时完成。

---

## 🎯 功能定位

生产排程主要用于：
- **计划管理**：制定中长期生产计划（主排程）和详细生产计划（详细排程）
- **资源调度**：合理安排设备、工作中心等生产资源
- **时间安排**：根据工艺路线和资源情况，计算和安排各工序的生产时间
- **进度跟踪**：跟踪排程的执行情况，监控完成率

---

## 📝 使用流程

### 第一步：创建生产排程

1. **进入生产排程页面**
   - 路径：`生产管理` → `生产计划` → `生产排程`

2. **点击"新增"按钮**，填写排程基本信息：

   **必填字段：**
   - **排程名称**：如"2025年1月生产排程"
   - **计划开始日期**：排程的开始日期
   - **计划结束日期**：排程的结束日期

   **可选字段：**
   - **排程类型**：
     - `主排程`：用于中长期生产计划，通常按周或月进行规划
     - `详细排程`：用于详细的生产计划，通常按天或小时进行规划
   - **计划天数**：排程覆盖的天数（系统会根据开始和结束日期自动计算）
   - **状态**：排程的当前状态
     - `待开始`：排程已创建但未开始执行
     - `执行中`：排程正在执行
     - `已完成`：排程已完成
     - `已暂停`：排程已暂停
     - `已取消`：排程已取消

   **统计字段（系统自动计算或手动填写）：**
   - **总订单数**：该排程包含的生产订单数量
   - **总数量**：该排程的总生产数量
   - **总工时**：该排程的总工时（分钟）

3. **保存排程**
   - 系统会自动生成排程单号（格式：SCH-YYYYMM-XXX）
   - 排程创建成功后，状态默认为"待开始"

---

### 第二步：创建排程明细

排程明细是排程的具体执行计划，需要为每个生产订单的每道工序创建排程明细。

1. **进入排程明细页面**
   - 路径：`生产管理` → `生产计划` → `排程明细`

2. **点击"新增"按钮**，填写排程明细信息：

   **必填字段：**
   - **排程**：选择已创建的生产排程
   - **生产订单**：选择要排程的生产订单
   - **产品**：系统会自动关联生产订单的产品
   - **排程数量**：本次排程的数量
   - **计划开始时间**：该工序的计划开始时间
   - **计划结束时间**：该工序的计划结束时间
   - **工序序号**：该工序在工艺路线中的序号（从1开始）

   **资源分配：**
   - **工作中心**：选择执行该工序的工作中心
   - **设备**：选择执行该工序的设备（如果工艺路线中配置了设备）
   - **优先级**：设置该工序的优先级
     - `1`：紧急
     - `2`：高
     - `3`：中
     - `4`：低

   **时间设置：**
   - **准备时间**：工序开始前的准备时间（分钟）
   - **运行时间**：工序的实际运行时间（分钟）
   - **等待时间**：工序的等待时间（分钟）

   **状态管理：**
   - **状态**：排程明细的执行状态
     - `待开始`：尚未开始执行
     - `执行中`：正在执行
     - `已完成`：已完成
     - `已暂停`：已暂停
     - `已取消`：已取消

   **进度跟踪：**
   - **实际开始时间**：工序实际开始的时间
   - **实际结束时间**：工序实际结束的时间
   - **完成率**：工序的完成百分比（0-100%）

3. **保存排程明细**
   - 系统会自动关联排程和生产订单
   - 可以根据工艺路线自动创建多道工序的排程明细

---

## 🔄 典型使用场景

### 场景一：创建月度生产排程

**目标**：为2025年1月创建生产排程，包含3个生产订单

**步骤：**

1. **创建排程主表**
   - 排程名称：`2025年1月生产排程`
   - 排程类型：`主排程`
   - 计划开始日期：`2025-01-01`
   - 计划结束日期：`2025-01-31`
   - 计划天数：`30`（系统自动计算）
   - 状态：`待开始`

2. **为每个生产订单创建排程明细**
   
   假设生产订单包含3道工序：
   
   **工序1：组装**
   - 排程数量：100个
   - 计划开始时间：`2025-01-15 08:00:00`
   - 计划结束时间：`2025-01-15 18:00:00`
   - 工作中心：组装中心
   - 设备：组装线
   - 准备时间：300分钟
   - 运行时间：3000分钟（30分钟/个 × 100个）
   - 工序序号：1
   - 优先级：高

   **工序2：最终测试**
   - 排程数量：100个
   - 计划开始时间：`2025-01-16 08:00:00`
   - 计划结束时间：`2025-01-16 18:00:00`
   - 工作中心：测试中心
   - 设备：测试设备
   - 准备时间：500分钟
   - 运行时间：2000分钟（20分钟/个 × 100个）
   - 工序序号：2
   - 优先级：高

   **工序3：包装**
   - 排程数量：100个
   - 计划开始时间：`2025-01-17 08:00:00`
   - 计划结束时间：`2025-01-17 12:00:00`
   - 工作中心：包装中心
   - 设备：无（手工包装）
   - 准备时间：0分钟
   - 运行时间：500分钟（5分钟/个 × 100个）
   - 工序序号：3
   - 优先级：中

3. **更新排程主表统计信息**
   - 总订单数：3
   - 总数量：300个
   - 总工时：6300分钟（105小时）

---

### 场景二：根据工艺路线自动排程

**前提条件：**
- 生产订单已创建
- 产品已配置工艺路线
- 工艺路线明细已配置工序、设备、工时等信息

**步骤：**

1. **创建排程主表**（同上）

2. **系统自动生成排程明细**
   - 根据生产订单关联的工艺路线
   - 自动创建每道工序的排程明细
   - 自动计算计划时间（基于标准工时）
   - 自动分配设备和工作中心（基于工艺路线配置）

3. **手动调整排程明细**
   - 根据实际资源情况调整计划时间
   - 调整设备分配
   - 调整优先级

---

## 📊 排程明细的时间计算

### 计划时间计算

排程明细的计划时间通常根据以下因素计算：

1. **标准工时**：从工艺路线明细中获取
2. **排程数量**：本次排程的生产数量
3. **准备时间**：工序开始前的准备时间
4. **运行时间**：`标准工时 × 排程数量`
5. **计划结束时间**：`计划开始时间 + 准备时间 + 运行时间`

### 示例计算

假设：
- 标准工时：30分钟/个
- 排程数量：100个
- 准备时间：300分钟（5小时）

计算：
- 运行时间 = 30分钟 × 100 = 3000分钟（50小时）
- 计划开始时间：2025-01-15 08:00:00
- 计划结束时间：2025-01-15 08:00:00 + 300分钟 + 3000分钟 = 2025-01-15 18:00:00

---

## 🔍 查询和筛选

### 排程主表查询

可以按以下条件查询排程：
- 排程单号
- 排程名称
- 排程类型（主排程/详细排程）
- 计划天数
- 计划开始日期范围
- 计划结束日期范围
- 状态
- 创建人
- 创建时间范围

### 排程明细查询

可以按以下条件查询排程明细：
- 排程（关联的排程主表）
- 生产订单
- 产品
- 计划开始时间范围
- 计划结束时间范围
- 工作中心
- 设备
- 状态
- 完成率范围

---

## ⚠️ 注意事项

1. **排程前准备**
   - 确保生产订单已创建且状态为"待排产"
   - 确保产品已配置BOM和工艺路线
   - 确保设备和工作中心已配置且可用

2. **时间安排**
   - 计划时间应考虑到设备可用性
   - 避免设备冲突（同一设备在同一时间被多个工序使用）
   - 考虑工序之间的依赖关系（前一道工序完成后才能开始下一道）

3. **资源分配**
   - 合理分配设备资源，避免资源瓶颈
   - 考虑工作中心的产能限制
   - 优先安排紧急订单和高优先级订单

4. **状态管理**
   - 排程创建后，状态为"待开始"
   - 开始执行后，手动将状态改为"执行中"
   - 完成后，手动将状态改为"已完成"

5. **进度跟踪**
   - 定期更新排程明细的实际开始时间和结束时间
   - 更新完成率，反映实际进度
   - 根据实际情况调整后续排程

---

## 🔗 相关功能

生产排程与其他模块的关联：

- **生产订单**：排程明细关联生产订单，排程完成后可以开始生产
- **工艺路线**：根据工艺路线自动生成排程明细
- **设备管理**：排程时分配设备，跟踪设备使用情况
- **工单**：排程完成后，可以基于排程创建工单
- **工单进度**：工单进度可以回写排程明细的实际时间和完成率

---

## 📈 最佳实践

1. **定期排程**：建议按周或月创建主排程，按天创建详细排程
2. **及时更新**：生产过程中及时更新排程明细的实际时间和完成率
3. **灵活调整**：根据实际情况灵活调整排程，避免资源冲突
4. **优先级管理**：合理设置优先级，确保重要订单优先完成
5. **资源优化**：通过排程优化设备利用率，提高生产效率

---

## 💡 常见问题

**Q1：排程明细如何自动生成？**
A：目前系统支持手动创建排程明细。可以根据工艺路线手动创建多道工序的排程明细。

**Q2：如何避免设备冲突？**
A：创建排程明细时，注意检查同一设备在同一时间段是否被其他排程明细占用。

**Q3：排程完成后如何开始生产？**
A：排程完成后，可以基于排程创建工单，然后开始生产执行。

**Q4：如何跟踪排程进度？**
A：通过排程明细的实际开始时间、实际结束时间和完成率字段跟踪进度。

**Q5：排程可以修改吗？**
A：可以。排程主表和排程明细都可以修改，但建议在开始执行前完成调整。

---

## 📚 相关文档

- [生产管理系统完整使用流程](./生产管理系统完整使用流程.md)
- [生产订单使用说明](./生产订单使用说明.md)
- [工艺路线使用说明](./工艺路线使用说明.md)
- [工单使用说明](./工单使用说明.md)

