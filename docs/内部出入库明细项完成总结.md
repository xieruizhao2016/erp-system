# å†…éƒ¨å‡ºå…¥åº“æ˜ç»†é¡¹å®Œæˆæ€»ç»“

**å®Œæˆæ—¶é—´**: 2025-12-09  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»ºæ˜ç»†é¡¹æ–‡ä»¶

#### å†…éƒ¨å…¥åº“æ˜ç»†é¡¹
- âœ… `ErpStockInternalInItemDO` - å†…éƒ¨å…¥åº“æ˜ç»†é¡¹DO
- âœ… `ErpStockInternalInItemMapper` - å†…éƒ¨å…¥åº“æ˜ç»†é¡¹Mapper

#### å†…éƒ¨å‡ºåº“æ˜ç»†é¡¹
- âœ… `ErpStockInternalOutItemDO` - å†…éƒ¨å‡ºåº“æ˜ç»†é¡¹DO
- âœ… `ErpStockInternalOutItemMapper` - å†…éƒ¨å‡ºåº“æ˜ç»†é¡¹Mapper

### 2. å®Œå–„å†…éƒ¨å…¥åº“ä¸šåŠ¡é€»è¾‘

- âœ… **æ˜ç»†é¡¹æ ¡éªŒ**: æ·»åŠ äº†`validateStockInternalInItems`æ–¹æ³•
  - æ ¡éªŒäº§å“å­˜åœ¨
  - æ ¡éªŒä»“åº“å­˜åœ¨
  - è‡ªåŠ¨å¡«å……äº§å“å•ä½IDå’Œåˆè®¡é‡‘é¢

- âœ… **æ˜ç»†é¡¹å¤„ç†**: æ·»åŠ äº†`updateStockInternalInItemList`æ–¹æ³•
  - æ”¯æŒæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤æ˜ç»†é¡¹
  - ä½¿ç”¨diffListå¯¹æ¯”æ–°æ—§æ•°æ®

- âœ… **åº“å­˜è®°å½•åˆ›å»º**: åœ¨å®¡æ ¸çŠ¶æ€æ›´æ–°æ—¶åˆ›å»ºåº“å­˜è®°å½•
  - å®¡æ ¸é€šè¿‡ï¼šåˆ›å»ºå†…éƒ¨å…¥åº“åº“å­˜è®°å½•
  - åå®¡æ ¸ï¼šåˆ›å»ºå†…éƒ¨å…¥åº“å–æ¶ˆåº“å­˜è®°å½•

- âœ… **åˆ›å»ºå’Œæ›´æ–°é€»è¾‘**: 
  - åˆ›å»ºæ—¶è‡ªåŠ¨è®¡ç®—åˆè®¡æ•°é‡å’Œé‡‘é¢
  - æ›´æ–°æ—¶åŒæ­¥æ›´æ–°æ˜ç»†é¡¹

- âœ… **SaveReqVOå¢å¼º**: æ·»åŠ äº†`items`å­—æ®µå’Œ`Item`å†…éƒ¨ç±»

### 3. ä»£ç è´¨é‡

- âœ… ä¿®å¤äº†æ‰€æœ‰åŒ…åé—®é¢˜
- âœ… æ— ç¼–è¯‘é”™è¯¯
- âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œå‚è€ƒäº†ç°æœ‰åº“å­˜å‡ºå…¥åº“å®ç°

---

## ğŸ“‹ å¾…å®Œæˆäº‹é¡¹

### 1. å†…éƒ¨å‡ºåº“ä¸šåŠ¡é€»è¾‘

éœ€è¦å®ç°ä¸å†…éƒ¨å…¥åº“ç±»ä¼¼çš„é€»è¾‘ï¼š
- â³ æ·»åŠ æ˜ç»†é¡¹æ ¡éªŒå’Œå¤„ç†
- â³ æ·»åŠ åº“å­˜è®°å½•åˆ›å»ºï¼ˆå‡ºåº“æ—¶å‡å°‘åº“å­˜ï¼‰
- â³ å®Œå–„åˆ›å»ºå’Œæ›´æ–°é€»è¾‘
- â³ æ·»åŠ å®¡æ ¸çŠ¶æ€æ›´æ–°æ–¹æ³•

### 2. é”™è¯¯ç å®Œå–„

éƒ¨åˆ†é”™è¯¯ç ä½¿ç”¨äº†å ä½ç¬¦ï¼Œéœ€è¦æ·»åŠ ï¼š
- â³ `STOCK_INTERNAL_IN_APPROVE_FAIL`
- â³ `STOCK_INTERNAL_IN_PROCESS_FAIL`
- â³ `STOCK_INTERNAL_IN_UPDATE_FAIL_APPROVE`
- â³ `STOCK_INTERNAL_IN_NO_EXISTS`
- â³ å†…éƒ¨å‡ºåº“ç›¸å…³çš„é”™è¯¯ç 

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åº“å­˜è®°å½•åˆ›å»º

```java
Integer bizType = approve ? ErpStockRecordBizTypeEnum.INTERNAL_IN.getType()
        : ErpStockRecordBizTypeEnum.INTERNAL_IN_CANCEL.getType();
stockInternalInItems.forEach(stockInternalInItem -> {
    BigDecimal count = approve ? stockInternalInItem.getCount() 
            : stockInternalInItem.getCount().negate();
    stockRecordService.createStockRecord(new ErpStockRecordCreateReqBO(
            stockInternalInItem.getProductId(), 
            stockInternalInItem.getWarehouseId(), 
            count,
            bizType, 
            stockInternalInItem.getInId(), 
            stockInternalInItem.getId(), 
            stockInternalIn.getNo()));
});
```

### æ˜ç»†é¡¹æ ¡éªŒ

```java
// 1. æ ¡éªŒäº§å“å­˜åœ¨
List<ErpProductDO> productList = productService.validProductList(...);
// 2. æ ¡éªŒä»“åº“å­˜åœ¨
warehouseService.validWarehouseList(...);
// 3. è‡ªåŠ¨å¡«å……äº§å“å•ä½IDå’Œåˆè®¡é‡‘é¢
.setProductUnitId(productMap.get(item.getProductId()).getUnitId())
.setTotalPrice(MoneyUtils.priceMultiply(item.getProductPrice(), item.getCount()))
```

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `ErpStockInternalInItemDO` - å†…éƒ¨å…¥åº“æ˜ç»†é¡¹DO
- `ErpStockInternalInItemMapper` - å†…éƒ¨å…¥åº“æ˜ç»†é¡¹Mapper
- `ErpStockInternalOutItemDO` - å†…éƒ¨å‡ºåº“æ˜ç»†é¡¹DO
- `ErpStockInternalOutItemMapper` - å†…éƒ¨å‡ºåº“æ˜ç»†é¡¹Mapper
- `ErpStockInternalInServiceImpl` - å†…éƒ¨å…¥åº“æœåŠ¡å®ç°ï¼ˆå·²å®Œå–„ï¼‰
- `ErpStockInternalInSaveReqVO` - å†…éƒ¨å…¥åº“ä¿å­˜è¯·æ±‚VOï¼ˆå·²æ·»åŠ itemså­—æ®µï¼‰

---

**ä¸‹ä¸€æ­¥**: å®ç°å†…éƒ¨å‡ºåº“çš„å®Œæ•´ä¸šåŠ¡é€»è¾‘ï¼Œå‚è€ƒå†…éƒ¨å…¥åº“çš„å®ç°ã€‚

