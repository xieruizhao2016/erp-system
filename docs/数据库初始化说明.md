# ERP系统数据库初始化说明

## 问题描述

拉取远端代码后，数据库表缺失很多字段，这是因为**SQL脚本需要手动执行才能在数据库中创建表结构**。

## 快速解决方案

### 方法一：使用自动初始化脚本（推荐）

```bash
# 1. 拉取代码
git clone <仓库地址>
cd erp-system

# 2. 启动数据库服务（如果还未启动）
cd script/docker
docker-compose up -d mysql redis
cd ../..

# 3. 执行数据库初始化脚本
./init-database.sh

# 4. 启动后端服务
./start-backend.sh

# 5. 启动前端服务
cd original-yudao-ui
pnpm dev
```

### 方法二：手动执行SQL脚本

如果自动脚本有问题，可以手动执行：

```bash
# 1. 登录MySQL
mysql -uroot -p123456

# 2. 创建数据库
CREATE DATABASE ruoyi-vue-pro CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE ruoyi-vue-pro;

# 3. 按顺序执行SQL文件
source sql/mysql/ruoyi-vue-pro.sql;      -- 基础表结构（用户、角色等）
source sql/mysql/erp-tables.sql;         -- ERP业务表（销售、采购、库存等）
source sql/mysql/quartz.sql;             -- 定时任务表
source sql/mysql/sample-data.sql;        -- 示例数据（可选）
```

**执行顺序很重要！** 必须先执行 `ruoyi-vue-pro.sql`，再执行 `erp-tables.sql`

### 方法三：通过数据库管理工具

使用 Navicat、DataGrip、MySQL Workbench 等工具：

1. 连接到MySQL数据库（localhost:3306，用户名：root，密码：123456）
2. 创建数据库 `ruoyi-vue-pro`
3. 依次打开并执行以下SQL文件：
   - `sql/mysql/ruoyi-vue-pro.sql`
   - `sql/mysql/erp-tables.sql`
   - `sql/mysql/quartz.sql`
   - `sql/mysql/sample-data.sql`（可选）

## 验证数据库是否正确初始化

```sql
-- 查看ERP相关表
SHOW TABLES LIKE 'erp_%';

-- 应该看到以下表（部分列表）：
-- erp_customer       - 客户表
-- erp_supplier       - 供应商表
-- erp_product        - 产品表
-- erp_sale_order     - 销售订单表
-- erp_purchase_order - 采购订单表
-- erp_stock          - 库存表
-- ... 等等

-- 查看表结构
DESC erp_product;
```

## 常见问题

### Q1: 错误 "Table 'ruoyi-vue-pro' doesn't exist"

**A**: 需要先创建数据库，然后执行SQL脚本。

```sql
CREATE DATABASE ruoyi-vue-pro CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### Q2: 错误 "Access denied for user 'root'@'localhost'"

**A**: MySQL密码不正确。默认密码是 `123456`，如果修改过请更新脚本。

### Q3: 执行ERP表脚本时出错

**A**: 确保先执行了 `ruoyi-vue-pro.sql`，ERP表依赖于基础表的外键约束。

### Q4: 找不到 `init-database.sh` 文件

**A**: 确保在项目根目录，并且文件有执行权限：

```bash
chmod +x init-database.sh
```

## 文件说明

- `sql/mysql/ruoyi-vue-pro.sql` - 基础表结构（约100+张表）
- `sql/mysql/erp-tables.sql` - ERP业务表（约30+张表）
- `sql/mysql/quartz.sql` - 定时任务表
- `sql/mysql/sample-data.sql` - 示例数据
- `init-database.sh` - 自动初始化脚本

## 架构说明

本项目**没有使用Flyway等数据库版本管理工具**，需要手动执行SQL脚本来创建表结构。这是RuoYi框架的常见做法。

## 更多信息

- 启动说明：参见 `启动说明.md`
- 项目文档：参见 `README.md`
- 后端启动：`./start-backend.sh`
- 前端启动：`cd original-yudao-ui && pnpm dev`
