# ä»£ç ç”Ÿæˆå™¨ä½¿ç”¨æŒ‡å— - ä»£ç æ”¾ç½®è¯´æ˜

## ğŸ“¦ ä¸‹è½½ä»£ç ZIPåŒ…åçš„æ“ä½œæ­¥éª¤

### 1. è§£å‹ZIPåŒ…

ä¸‹è½½çš„ZIPåŒ…é€šå¸¸åŒ…å«ä»¥ä¸‹ç»“æ„çš„æ–‡ä»¶ï¼š
```
codegen.zip
â”œâ”€â”€ yudao-module-erp/
â”‚   â””â”€â”€ yudao-module-erp-server/
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ main/
â”‚           â”‚   â”œâ”€â”€ java/
â”‚           â”‚   â”‚   â””â”€â”€ cn/iocoder/yudao/module/erp/
â”‚           â”‚   â”‚       â”œâ”€â”€ controller/
â”‚           â”‚   â”‚       â”œâ”€â”€ service/
â”‚           â”‚   â”‚       â””â”€â”€ dal/
â”‚           â”‚   â””â”€â”€ resources/
â”‚           â”‚       â””â”€â”€ mapper/
â”‚           â””â”€â”€ test/
â”‚               â””â”€â”€ java/
â””â”€â”€ original-yudao-ui/  (æˆ– yudao-ui-admin-vue3/)
    â””â”€â”€ src/
        â”œâ”€â”€ api/
        â””â”€â”€ views/
```

---

## ğŸ“ åç«¯ä»£ç æ”¾ç½®ä½ç½®

### å‡è®¾é…ç½®ä¿¡æ¯ï¼š
- **æ¨¡å—å**ï¼š`erp`
- **ä¸šåŠ¡å**ï¼š`production-order`
- **ç±»å**ï¼š`ProductionOrder`

### åç«¯Javaä»£ç è·¯å¾„æ˜ å°„

#### 1. Controller æ§åˆ¶å™¨
**ç”Ÿæˆè·¯å¾„**ï¼š
```
yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/production-order/ProductionOrderController.java
```

**å®é™…æ”¾ç½®ä½ç½®**ï¼š
```
yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/production-order/
â”œâ”€â”€ ProductionOrderController.java
â””â”€â”€ vo/
    â”œâ”€â”€ ProductionOrderPageReqVO.java
    â”œâ”€â”€ ProductionOrderRespVO.java
    â””â”€â”€ ProductionOrderSaveReqVO.java
```

#### 2. Service æœåŠ¡å±‚
**ç”Ÿæˆè·¯å¾„**ï¼š
```
yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/service/production-order/ProductionOrderService.java
yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/service/production-order/ProductionOrderServiceImpl.java
```

**å®é™…æ”¾ç½®ä½ç½®**ï¼š
```
yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/service/production-order/
â”œâ”€â”€ ProductionOrderService.java
â””â”€â”€ ProductionOrderServiceImpl.java
```

#### 3. DO æ•°æ®å¯¹è±¡
**ç”Ÿæˆè·¯å¾„**ï¼š
```
yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/dal/dataobject/production-order/ProductionOrderDO.java
```

**å®é™…æ”¾ç½®ä½ç½®**ï¼š
```
yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/dataobject/production-order/
â””â”€â”€ ProductionOrderDO.java
```

#### 4. Mapper æ•°æ®è®¿é—®å±‚
**ç”Ÿæˆè·¯å¾„**ï¼š
```
yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/dal/mysql/production-order/ProductionOrderMapper.java
```

**å®é™…æ”¾ç½®ä½ç½®**ï¼š
```
yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/mysql/production-order/
â””â”€â”€ ProductionOrderMapper.java
```

#### 5. Mapper XML æ–‡ä»¶
**ç”Ÿæˆè·¯å¾„**ï¼š
```
yudao-module-erp/yudao-module-erp-server/src/main/resources/mapper/production-order/ProductionOrderMapper.xml
```

**å®é™…æ”¾ç½®ä½ç½®**ï¼š
```
yudao-module-erp/src/main/resources/mapper/production-order/
â””â”€â”€ ProductionOrderMapper.xml
```

#### 6. å•å…ƒæµ‹è¯•ï¼ˆå¦‚æœç”Ÿæˆï¼‰
**ç”Ÿæˆè·¯å¾„**ï¼š
```
yudao-module-erp/yudao-module-erp-server/src/test/java/cn/iocoder/yudao/module/erp/service/production-order/ProductionOrderServiceImplTest.java
```

**å®é™…æ”¾ç½®ä½ç½®**ï¼š
```
yudao-module-erp/src/test/java/cn/iocoder/yudao/module/erp/service/production-order/
â””â”€â”€ ProductionOrderServiceImplTest.java
```

#### 7. ErrorCode é”™è¯¯ç ï¼ˆéœ€è¦æ‰‹åŠ¨åˆå¹¶ï¼‰
**ç”Ÿæˆè·¯å¾„**ï¼š
```
yudao-module-erp/yudao-module-erp-api/src/main/java/cn/iocoder/yudao/module/erp/enums/ErrorCodeConstants_æ‰‹åŠ¨æ“ä½œ.java
```

**æ³¨æ„**ï¼šè¿™ä¸ªæ–‡ä»¶éœ€è¦æ‰‹åŠ¨å°†é”™è¯¯ç åˆå¹¶åˆ°ç°æœ‰çš„ `ErrorCodeConstants.java` æ–‡ä»¶ä¸­ï¼Œä¸è¦ç›´æ¥è¦†ç›–ï¼

**å®é™…æ”¾ç½®ä½ç½®**ï¼š
```
yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/enums/
â””â”€â”€ ErrorCodeConstants.java  (æ‰‹åŠ¨åˆå¹¶)
```

---

## ğŸ¨ å‰ç«¯ä»£ç æ”¾ç½®ä½ç½®

### å‰ç«¯ä»£ç è·¯å¾„æ˜ å°„ï¼ˆVue3 + Element Plusï¼‰

#### 1. API æ¥å£æ–‡ä»¶
**ç”Ÿæˆè·¯å¾„**ï¼š
```
yudao-ui-admin-vue3/src/api/erp/production-order/index.ts
```

**å®é™…æ”¾ç½®ä½ç½®**ï¼š
```
original-yudao-ui/src/api/erp/production-order/
â””â”€â”€ index.ts
```

#### 2. åˆ—è¡¨é¡µé¢
**ç”Ÿæˆè·¯å¾„**ï¼š
```
yudao-ui-admin-vue3/src/views/erp/production-order/index.vue
```

**å®é™…æ”¾ç½®ä½ç½®**ï¼š
```
original-yudao-ui/src/views/erp/production-order/
â””â”€â”€ index.vue
```

#### 3. è¡¨å•é¡µé¢
**ç”Ÿæˆè·¯å¾„**ï¼š
```
yudao-ui-admin-vue3/src/views/erp/production-order/ProductionOrderForm.vue
```

**å®é™…æ”¾ç½®ä½ç½®**ï¼š
```
original-yudao-ui/src/views/erp/production-order/
â””â”€â”€ ProductionOrderForm.vue
```

---

## ğŸ”§ è¯¦ç»†æ“ä½œæ­¥éª¤

### æ­¥éª¤1ï¼šè§£å‹ZIPåŒ…
```bash
# è§£å‹åˆ°ä¸´æ—¶ç›®å½•
unzip codegen.zip -d /tmp/codegen
```

### æ­¥éª¤2ï¼šå¤åˆ¶åç«¯ä»£ç 

#### æ–¹æ³•Aï¼šæ‰‹åŠ¨å¤åˆ¶ï¼ˆæ¨èï¼‰
1. æ‰“å¼€è§£å‹åçš„æ–‡ä»¶å¤¹
2. æ‰¾åˆ° `yudao-module-erp/yudao-module-erp-server/src/main/java/` ç›®å½•
3. å°† `cn/iocoder/yudao/module/erp/` ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°é¡¹ç›®å¯¹åº”ä½ç½®
4. æ³¨æ„ï¼š**ä¸è¦å¤åˆ¶æ•´ä¸ªç›®å½•ç»“æ„ï¼Œåªå¤åˆ¶å†…å®¹**

#### æ–¹æ³•Bï¼šä½¿ç”¨å‘½ä»¤è¡Œï¼ˆå¿«é€Ÿï¼‰
```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /Users/xierui/Documents/Project/erp-system

# å¤åˆ¶Controller
cp -r /tmp/codegen/yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/production-order \
  yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/

# å¤åˆ¶Service
cp -r /tmp/codegen/yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/service/production-order \
  yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/service/

# å¤åˆ¶DO
cp -r /tmp/codegen/yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/dal/dataobject/production-order \
  yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/dataobject/

# å¤åˆ¶Mapper
cp -r /tmp/codegen/yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/dal/mysql/production-order \
  yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/mysql/

# å¤åˆ¶Mapper XML
cp -r /tmp/codegen/yudao-module-erp/yudao-module-erp-server/src/main/resources/mapper/production-order \
  yudao-module-erp/src/main/resources/mapper/
```

### æ­¥éª¤3ï¼šå¤åˆ¶å‰ç«¯ä»£ç 

```bash
# å¤åˆ¶APIæ–‡ä»¶
cp /tmp/codegen/yudao-ui-admin-vue3/src/api/erp/production-order/index.ts \
  original-yudao-ui/src/api/erp/production-order/

# å¤åˆ¶Vueé¡µé¢
cp -r /tmp/codegen/yudao-ui-admin-vue3/src/views/erp/production-order \
  original-yudao-ui/src/views/erp/
```

### æ­¥éª¤4ï¼šå¤„ç†ErrorCodeï¼ˆé‡è¦ï¼ï¼‰

**ä¸è¦ç›´æ¥è¦†ç›–** `ErrorCodeConstants.java`ï¼Œéœ€è¦æ‰‹åŠ¨åˆå¹¶ï¼š

1. æ‰“å¼€ç”Ÿæˆçš„æ–‡ä»¶ï¼š`ErrorCodeConstants_æ‰‹åŠ¨æ“ä½œ.java`
2. å¤åˆ¶å…¶ä¸­çš„é”™è¯¯ç å¸¸é‡
3. æ‰“å¼€é¡¹ç›®ä¸­çš„ `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/enums/ErrorCodeConstants.java`
4. å°†æ–°çš„é”™è¯¯ç æ·»åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼ˆæ³¨æ„ä¸è¦é‡å¤ï¼‰

ç¤ºä¾‹ï¼š
```java
// åœ¨ ErrorCodeConstants.java ä¸­æ·»åŠ 
// ========== ç”Ÿäº§è®¢å•æ¨¡å— 1-XXX-XXX-XXX ==========
PRODUCTION_ORDER_NOT_EXISTS(1_XXX_XXX_XXX, "ç”Ÿäº§è®¢å•ä¸å­˜åœ¨"),
PRODUCTION_ORDER_STATUS_ERROR(1_XXX_XXX_XXX, "ç”Ÿäº§è®¢å•çŠ¶æ€é”™è¯¯"),
// ... å…¶ä»–é”™è¯¯ç 
```

### æ­¥éª¤5ï¼šæ£€æŸ¥å¹¶ä¿®å¤å¯¼å…¥è·¯å¾„

ç”Ÿæˆä»£ç åï¼Œéœ€è¦æ£€æŸ¥ï¼š

1. **åŒ…åæ˜¯å¦æ­£ç¡®**ï¼šç¡®ä¿æ‰€æœ‰ `package` å£°æ˜æ­£ç¡®
2. **å¯¼å…¥è·¯å¾„**ï¼šæ£€æŸ¥ `import` è¯­å¥æ˜¯å¦æ­£ç¡®
3. **ç±»å**ï¼šç¡®ä¿ç±»åä¸æ–‡ä»¶åä¸€è‡´

### æ­¥éª¤6ï¼šç¼–è¯‘æµ‹è¯•

```bash
# åç«¯ç¼–è¯‘
cd yudao-module-erp
mvn clean compile

# å‰ç«¯ç¼–è¯‘ï¼ˆå¦‚æœéœ€è¦ï¼‰
cd original-yudao-ui
npm run build
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. è·¯å¾„å·®å¼‚
- ç”Ÿæˆå™¨ç”Ÿæˆçš„è·¯å¾„åŒ…å« `yudao-module-erp-server` å­æ¨¡å—
- å®é™…é¡¹ç›®ç»“æ„å¯èƒ½ä¸åŒï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´

### 2. ä¸è¦è¦†ç›–ç°æœ‰æ–‡ä»¶
- å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œå…ˆå¤‡ä»½
- ErrorCode å¿…é¡»æ‰‹åŠ¨åˆå¹¶ï¼Œä¸èƒ½ç›´æ¥è¦†ç›–

### 3. æ£€æŸ¥ä¾èµ–
- ç¡®ä¿æ‰€æœ‰å¿…è¦çš„ä¾èµ–éƒ½å·²æ·»åŠ åˆ° `pom.xml`
- æ£€æŸ¥å‰ç«¯ä¾èµ–æ˜¯å¦å®Œæ•´

### 4. æƒé™é…ç½®
- ç”Ÿæˆä»£ç åï¼Œéœ€è¦åœ¨èœå•ç®¡ç†ä¸­é…ç½®æƒé™
- åœ¨ `system_menu` è¡¨ä¸­æ·»åŠ èœå•é¡¹

### 5. è·¯ç”±é…ç½®
- å‰ç«¯è·¯ç”±éœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ°è·¯ç”±é…ç½®æ–‡ä»¶ä¸­
- æ£€æŸ¥ `router/index.ts` æˆ–ç›¸å…³è·¯ç”±æ–‡ä»¶

---

## ğŸ“‹ å¿«é€Ÿæ£€æŸ¥æ¸…å•

- [ ] åç«¯Controllerå·²å¤åˆ¶åˆ°æ­£ç¡®ä½ç½®
- [ ] åç«¯Serviceå·²å¤åˆ¶åˆ°æ­£ç¡®ä½ç½®
- [ ] åç«¯DOå·²å¤åˆ¶åˆ°æ­£ç¡®ä½ç½®
- [ ] åç«¯Mapperå·²å¤åˆ¶åˆ°æ­£ç¡®ä½ç½®
- [ ] åç«¯Mapper XMLå·²å¤åˆ¶åˆ°æ­£ç¡®ä½ç½®
- [ ] ErrorCodeå·²æ‰‹åŠ¨åˆå¹¶ï¼ˆæœªç›´æ¥è¦†ç›–ï¼‰
- [ ] å‰ç«¯APIæ–‡ä»¶å·²å¤åˆ¶
- [ ] å‰ç«¯Vueé¡µé¢å·²å¤åˆ¶
- [ ] ä»£ç ç¼–è¯‘é€šè¿‡
- [ ] å¯¼å…¥è·¯å¾„æ£€æŸ¥æ— è¯¯
- [ ] èœå•æƒé™å·²é…ç½®
- [ ] è·¯ç”±å·²é…ç½®

---

## ğŸš€ åç»­æ“ä½œ

1. **æ·»åŠ èœå•**ï¼šåœ¨ç³»ç»Ÿç®¡ç† â†’ èœå•ç®¡ç†ä¸­æ·»åŠ ç”Ÿäº§è®¢å•èœå•
2. **é…ç½®æƒé™**ï¼šä¸ºè§’è‰²åˆ†é…ç›¸åº”çš„æƒé™
3. **æµ‹è¯•åŠŸèƒ½**ï¼šæµ‹è¯•CRUDåŠŸèƒ½æ˜¯å¦æ­£å¸¸
4. **ä¸šåŠ¡è°ƒæ•´**ï¼šæ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ä»£ç é€»è¾‘

---

## ğŸ”‘ è·å–JWT Token

åœ¨è°ƒç”¨ä»£ç ç”Ÿæˆå™¨APIä¹‹å‰ï¼Œéœ€è¦å…ˆè·å–JWT Tokenè¿›è¡Œèº«ä»½è®¤è¯ã€‚

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬è·å–Tokenï¼ˆæ¨èï¼‰

é¡¹ç›®æä¾›äº†ä¾¿æ·çš„è„šæœ¬ï¼š

```bash
# åŸºæœ¬ç”¨æ³•
./scripts/get-jwt-token.sh [USERNAME] [PASSWORD] [BASE_URL] [TENANT_ID]

# ä½¿ç”¨é»˜è®¤å‚æ•°ï¼ˆadmin/admin123ï¼‰
./scripts/get-jwt-token.sh

# æŒ‡å®šå‚æ•°
./scripts/get-jwt-token.sh admin admin123 http://localhost:48080/admin-api 1
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- è°ƒç”¨ç™»å½•APIè·å–Token
- ä¿å­˜Tokenåˆ° `.jwt-token` æ–‡ä»¶
- éªŒè¯Tokenæœ‰æ•ˆæ€§
- æ˜¾ç¤ºä½¿ç”¨ç¤ºä¾‹

### æ–¹æ³•äºŒï¼šä½¿ç”¨curlå‘½ä»¤

```bash
# 1. ç™»å½•è·å–Token
RESPONSE=$(curl -s -X POST "http://localhost:48080/admin-api/system/auth/login" \
  -H "Content-Type: application/json" \
  -H "tenant-id: 1" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }')

# 2. æå–Tokenï¼ˆéœ€è¦å®‰è£…jqï¼‰
TOKEN=$(echo $RESPONSE | jq -r '.data.accessToken')

# 3. ä¿å­˜Tokenåˆ°æ–‡ä»¶
echo $TOKEN > .jwt-token

# 4. ä½¿ç”¨Token
TOKEN=$(cat .jwt-token)
curl -X GET "http://localhost:48080/admin-api/infra/codegen/table/list?dataSourceConfigId=1" \
  -H "Authorization: Bearer ${TOKEN}"
```

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨å‰ç«¯ç™»å½•

1. æ‰“å¼€å‰ç«¯é¡µé¢ï¼š`http://localhost:80`
2. ä½¿ç”¨è´¦å·å¯†ç ç™»å½•ï¼ˆé»˜è®¤ï¼šadmin/admin123ï¼‰
3. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
4. åœ¨Networkæ ‡ç­¾ä¸­æ‰¾åˆ°ç™»å½•è¯·æ±‚
5. æŸ¥çœ‹å“åº”ä¸­çš„ `accessToken` å­—æ®µ
6. æˆ–è€…åœ¨Application/Storageæ ‡ç­¾ä¸­æŸ¥çœ‹LocalStorageä¸­çš„token

### æ–¹æ³•å››ï¼šä½¿ç”¨Postman/Insomnia

1. åˆ›å»ºPOSTè¯·æ±‚ï¼š`http://localhost:48080/admin-api/system/auth/login`
2. æ·»åŠ Headerï¼š
   - `Content-Type: application/json`
   - `tenant-id: 1`
3. æ·»åŠ Bodyï¼ˆJSONï¼‰ï¼š
   ```json
   {
     "username": "admin",
     "password": "admin123"
   }
   ```
4. å‘é€è¯·æ±‚ï¼Œä»å“åº”ä¸­è·å– `data.accessToken`
5. åœ¨åç»­è¯·æ±‚çš„Headerä¸­æ·»åŠ ï¼š`Authorization: Bearer {accessToken}`

### ç™»å½•APIè¯´æ˜

**æ¥å£**: `POST /system/auth/login`

**è¯·æ±‚å¤´**:
- `Content-Type: application/json`
- `tenant-id: {ç§Ÿæˆ·ID}` (é€šå¸¸ä¸º1)

**è¯·æ±‚ä½“**:
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "data": {
    "userId": 1,
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresTime": "2025-01-16T10:30:00"
  }
}
```

**å­—æ®µè¯´æ˜**:
- `accessToken`: è®¿é—®ä»¤ç‰Œï¼Œç”¨äºAPIè®¤è¯ï¼ˆæœ‰æ•ˆæœŸé€šå¸¸ä¸º2å°æ—¶ï¼‰
- `refreshToken`: åˆ·æ–°ä»¤ç‰Œï¼Œç”¨äºåˆ·æ–°accessToken
- `expiresTime`: Tokenè¿‡æœŸæ—¶é—´

### Tokenä½¿ç”¨

è·å–Tokenåï¼Œåœ¨æ‰€æœ‰APIè¯·æ±‚çš„Headerä¸­æ·»åŠ ï¼š

```
Authorization: Bearer {accessToken}
```

ç¤ºä¾‹ï¼š
```bash
TOKEN=$(cat .jwt-token)
curl -X GET "http://localhost:48080/admin-api/infra/codegen/table/list?dataSourceConfigId=1" \
  -H "Authorization: Bearer ${TOKEN}" \
  -H "tenant-id: 1"
```

### Tokenåˆ·æ–°

å¦‚æœTokenè¿‡æœŸï¼Œå¯ä»¥ä½¿ç”¨refreshTokenåˆ·æ–°ï¼š

```bash
# åˆ·æ–°Token
RESPONSE=$(curl -s -X POST "http://localhost:48080/admin-api/system/auth/refresh-token?refreshToken=${REFRESH_TOKEN}" \
  -H "Content-Type: application/json" \
  -H "tenant-id: 1")

# æå–æ–°çš„Token
NEW_TOKEN=$(echo $RESPONSE | jq -r '.data.accessToken')
echo $NEW_TOKEN > .jwt-token
```

---

## ğŸ”Œ é€šè¿‡APIè°ƒç”¨ä»£ç ç”Ÿæˆå™¨

é™¤äº†é€šè¿‡å‰ç«¯ç•Œé¢ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ï¼Œè¿˜å¯ä»¥ç›´æ¥è°ƒç”¨åç«¯APIæ¥ç”Ÿæˆä»£ç ã€‚è¿™å¯¹äºæ‰¹é‡ç”Ÿæˆä»£ç æˆ–é›†æˆåˆ°CI/CDæµç¨‹ä¸­éå¸¸æœ‰ç”¨ã€‚

**æ³¨æ„**: è°ƒç”¨APIå‰è¯·ç¡®ä¿å·²è·å–JWT Tokenï¼ˆå‚è€ƒä¸Šæ–¹"è·å–JWT Token"ç« èŠ‚ï¼‰

### APIæ¥å£åˆ—è¡¨

ä»£ç ç”Ÿæˆå™¨çš„APIæ¥å£ä½äºï¼š`/infra/codegen`

#### 1. è·å–æ•°æ®åº“è¡¨åˆ—è¡¨
**æ¥å£**: `GET /infra/codegen/db/table/list`  
**è¯´æ˜**: è·å–æ•°æ®åº“ä¸­æ‰€æœ‰å¯ç”¨çš„è¡¨ï¼ˆä¼šè¿‡æ»¤æ‰å·²ç»å¯¼å…¥Codegençš„è¡¨ï¼‰

**è¯·æ±‚å‚æ•°**:
- `dataSourceConfigId` (å¿…å¡«): æ•°æ®æºé…ç½®ç¼–å·ï¼Œé€šå¸¸ä¸º1
- `name` (å¯é€‰): è¡¨åï¼Œæ¨¡ç³ŠåŒ¹é…
- `comment` (å¯é€‰): è¡¨æ³¨é‡Šï¼Œæ¨¡ç³ŠåŒ¹é…

**ç¤ºä¾‹**:
```bash
curl -X GET "http://localhost:48080/admin-api/infra/codegen/db/table/list?dataSourceConfigId=1&name=erp_production" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "data": [
    {
      "name": "erp_production_order",
      "comment": "ç”Ÿäº§è®¢å•"
    },
    {
      "name": "erp_product_bom",
      "comment": "BOMä¸»è¡¨"
    }
  ]
}
```

#### 2. åˆ›å»ºä»£ç ç”Ÿæˆå™¨è¡¨å®šä¹‰
**æ¥å£**: `POST /infra/codegen/create-list`  
**è¯´æ˜**: åŸºäºæ•°æ®åº“è¡¨ç»“æ„ï¼Œåˆ›å»ºä»£ç ç”Ÿæˆå™¨çš„è¡¨å’Œå­—æ®µå®šä¹‰

**è¯·æ±‚ä½“**:
```json
{
  "dataSourceConfigId": 1,
  "tableNames": ["erp_production_order", "erp_product_bom"]
}
```

**ç¤ºä¾‹**:
```bash
curl -X POST "http://localhost:48080/admin-api/infra/codegen/create-list" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "dataSourceConfigId": 1,
    "tableNames": ["erp_production_order"]
  }'
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "data": [123]  // è¿”å›åˆ›å»ºçš„è¡¨IDåˆ—è¡¨
}
```

#### 3. è·å–è¡¨å®šä¹‰è¯¦æƒ…
**æ¥å£**: `GET /infra/codegen/detail`  
**è¯´æ˜**: è·å–è¡¨å’Œå­—æ®µçš„è¯¦ç»†ä¿¡æ¯ï¼Œç”¨äºé…ç½®ä»£ç ç”Ÿæˆé€‰é¡¹

**è¯·æ±‚å‚æ•°**:
- `tableId` (å¿…å¡«): è¡¨ç¼–å·

**ç¤ºä¾‹**:
```bash
curl -X GET "http://localhost:48080/admin-api/infra/codegen/detail?tableId=123" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### 4. æ›´æ–°è¡¨å®šä¹‰
**æ¥å£**: `PUT /infra/codegen/update`  
**è¯´æ˜**: æ›´æ–°ä»£ç ç”Ÿæˆå™¨çš„è¡¨å’Œå­—æ®µå®šä¹‰ï¼ˆé…ç½®æ¨¡å—åã€ä¸šåŠ¡åã€ç±»åç­‰ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "table": {
    "id": 123,
    "moduleName": "erp",
    "businessName": "production-order",
    "className": "ProductionOrder",
    "classComment": "ç”Ÿäº§è®¢å•",
    "author": "å¼€å‘å›¢é˜Ÿ",
    "templateType": 1,
    "parentMenuId": 2000
  },
  "columns": [
    {
      "id": 1,
      "tableId": 123,
      "columnName": "id",
      "javaField": "id",
      "javaType": "Long",
      "createOperation": true,
      "updateOperation": false,
      "listOperation": true,
      "listOperationResult": true,
      "htmlType": "input"
    }
    // ... æ›´å¤šå­—æ®µé…ç½®
  ]
}
```

**ç¤ºä¾‹**:
```bash
curl -X PUT "http://localhost:48080/admin-api/infra/codegen/update" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d @update-codegen.json
```

#### 5. é¢„è§ˆç”Ÿæˆä»£ç 
**æ¥å£**: `GET /infra/codegen/preview`  
**è¯´æ˜**: é¢„è§ˆç”Ÿæˆçš„ä»£ç ï¼Œä¸ä¸‹è½½æ–‡ä»¶

**è¯·æ±‚å‚æ•°**:
- `tableId` (å¿…å¡«): è¡¨ç¼–å·

**ç¤ºä¾‹**:
```bash
curl -X GET "http://localhost:48080/admin-api/infra/codegen/preview?tableId=123" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "data": [
    {
      "filePath": "yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/production-order/ProductionOrderController.java",
      "code": "package cn.iocoder.yudao.module.erp.controller.admin.production-order;..."
    },
    {
      "filePath": "yudao-module-erp/yudao-module-erp-server/src/main/java/cn/iocoder/yudao/module/erp/service/production-order/ProductionOrderService.java",
      "code": "package cn.iocoder.yudao.module.erp.service.production-order;..."
    }
    // ... æ›´å¤šæ–‡ä»¶
  ]
}
```

#### 6. ä¸‹è½½ç”Ÿæˆä»£ç 
**æ¥å£**: `GET /infra/codegen/download`  
**è¯´æ˜**: ç”Ÿæˆä»£ç å¹¶ä¸‹è½½ä¸ºZIPæ–‡ä»¶

**è¯·æ±‚å‚æ•°**:
- `tableId` (å¿…å¡«): è¡¨ç¼–å·

**ç¤ºä¾‹**:
```bash
curl -X GET "http://localhost:48080/admin-api/infra/codegen/download?tableId=123" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -o codegen.zip
```

### å®Œæ•´APIè°ƒç”¨æµç¨‹ç¤ºä¾‹

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨curlå‘½ä»¤

```bash
# 1. è·å–Tokenï¼ˆç™»å½•åè·å–ï¼‰
TOKEN="your_jwt_token_here"
BASE_URL="http://localhost:48080/admin-api"

# 2. è·å–æ•°æ®åº“è¡¨åˆ—è¡¨
curl -X GET "${BASE_URL}/infra/codegen/db/table/list?dataSourceConfigId=1&name=erp_production" \
  -H "Authorization: Bearer ${TOKEN}"

# 3. åˆ›å»ºä»£ç ç”Ÿæˆå™¨è¡¨å®šä¹‰
curl -X POST "${BASE_URL}/infra/codegen/create-list" \
  -H "Authorization: Bearer ${TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "dataSourceConfigId": 1,
    "tableNames": ["erp_production_order"]
  }'

# 4. è·å–è¡¨å®šä¹‰è¯¦æƒ…ï¼ˆå‡è®¾è¿”å›çš„tableIdæ˜¯123ï¼‰
TABLE_ID=123
curl -X GET "${BASE_URL}/infra/codegen/detail?tableId=${TABLE_ID}" \
  -H "Authorization: Bearer ${TOKEN}" > table-detail.json

# 5. æ›´æ–°è¡¨å®šä¹‰ï¼ˆä¿®æ”¹table-detail.jsonä¸­çš„é…ç½®åï¼‰
curl -X PUT "${BASE_URL}/infra/codegen/update" \
  -H "Authorization: Bearer ${TOKEN}" \
  -H "Content-Type: application/json" \
  -d @table-detail-updated.json

# 6. é¢„è§ˆä»£ç 
curl -X GET "${BASE_URL}/infra/codegen/preview?tableId=${TABLE_ID}" \
  -H "Authorization: Bearer ${TOKEN}" > preview.json

# 7. ä¸‹è½½ä»£ç 
curl -X GET "${BASE_URL}/infra/codegen/download?tableId=${TABLE_ID}" \
  -H "Authorization: Bearer ${TOKEN}" \
  -o codegen.zip
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨JavaScript/TypeScriptï¼ˆå‰ç«¯ï¼‰

```typescript
import { 
  getSchemaTableList, 
  createCodegenList, 
  getCodegenTable, 
  updateCodegenTable,
  previewCodegen,
  downloadCodegen 
} from '@/api/infra/codegen'

// 1. è·å–æ•°æ®åº“è¡¨åˆ—è¡¨
const tables = await getSchemaTableList({
  dataSourceConfigId: 1,
  name: 'erp_production'
})

// 2. åˆ›å»ºä»£ç ç”Ÿæˆå™¨è¡¨å®šä¹‰
const tableIds = await createCodegenList({
  dataSourceConfigId: 1,
  tableNames: ['erp_production_order']
})

// 3. è·å–è¡¨å®šä¹‰è¯¦æƒ…
const tableId = tableIds[0]
const detail = await getCodegenTable(tableId)

// 4. æ›´æ–°è¡¨å®šä¹‰
await updateCodegenTable({
  table: {
    ...detail.table,
    moduleName: 'erp',
    businessName: 'production-order',
    className: 'ProductionOrder',
    classComment: 'ç”Ÿäº§è®¢å•',
    author: 'å¼€å‘å›¢é˜Ÿ'
  },
  columns: detail.columns.map(col => ({
    ...col,
    // æ ¹æ®éœ€è¦è°ƒæ•´å­—æ®µé…ç½®
  }))
})

// 5. é¢„è§ˆä»£ç 
const preview = await previewCodegen(tableId)
console.log(preview)

// 6. ä¸‹è½½ä»£ç 
await downloadCodegen(tableId)
```

#### æ–¹å¼ä¸‰ï¼šä½¿ç”¨Pythonè„šæœ¬

```python
import requests
import json

BASE_URL = "http://localhost:48080/admin-api"
TOKEN = "your_jwt_token_here"
HEADERS = {
    "Authorization": f"Bearer {TOKEN}",
    "Content-Type": "application/json"
}

# 1. è·å–æ•°æ®åº“è¡¨åˆ—è¡¨
response = requests.get(
    f"{BASE_URL}/infra/codegen/db/table/list",
    params={"dataSourceConfigId": 1, "name": "erp_production"},
    headers=HEADERS
)
tables = response.json()["data"]
print(f"æ‰¾åˆ° {len(tables)} å¼ è¡¨")

# 2. åˆ›å»ºä»£ç ç”Ÿæˆå™¨è¡¨å®šä¹‰
table_names = ["erp_production_order"]
response = requests.post(
    f"{BASE_URL}/infra/codegen/create-list",
    json={"dataSourceConfigId": 1, "tableNames": table_names},
    headers=HEADERS
)
table_ids = response.json()["data"]
print(f"åˆ›å»ºäº† {len(table_ids)} ä¸ªè¡¨å®šä¹‰ï¼ŒID: {table_ids}")

# 3. è·å–å¹¶æ›´æ–°è¡¨å®šä¹‰
table_id = table_ids[0]
response = requests.get(
    f"{BASE_URL}/infra/codegen/detail",
    params={"tableId": table_id},
    headers=HEADERS
)
detail = response.json()["data"]

# æ›´æ–°é…ç½®
detail["table"]["moduleName"] = "erp"
detail["table"]["businessName"] = "production-order"
detail["table"]["className"] = "ProductionOrder"
detail["table"]["classComment"] = "ç”Ÿäº§è®¢å•"
detail["table"]["author"] = "å¼€å‘å›¢é˜Ÿ"

response = requests.put(
    f"{BASE_URL}/infra/codegen/update",
    json=detail,
    headers=HEADERS
)
print("è¡¨å®šä¹‰æ›´æ–°æˆåŠŸ")

# 4. ä¸‹è½½ä»£ç 
response = requests.get(
    f"{BASE_URL}/infra/codegen/download",
    params={"tableId": table_id},
    headers=HEADERS,
    stream=True
)
with open("codegen.zip", "wb") as f:
    for chunk in response.iter_content(chunk_size=8192):
        f.write(chunk)
print("ä»£ç ä¸‹è½½å®Œæˆ: codegen.zip")
```

### æ‰¹é‡ç”Ÿæˆä»£ç è„šæœ¬

åˆ›å»ºä¸€ä¸ªæ‰¹é‡ç”Ÿæˆæ‰€æœ‰ç”Ÿäº§ç®¡ç†è¡¨ä»£ç çš„è„šæœ¬ï¼š

```bash
#!/bin/bash
# æ‰¹é‡ç”Ÿæˆç”Ÿäº§ç®¡ç†è¡¨ä»£ç 

TOKEN="your_jwt_token_here"
BASE_URL="http://localhost:48080/admin-api"
DATA_SOURCE_ID=1

# ç”Ÿäº§ç®¡ç†ç›¸å…³è¡¨åˆ—è¡¨
TABLES=(
  "erp_production_order"
  "erp_product_bom"
  "erp_product_bom_item"
  "erp_process_route"
  "erp_process_route_item"
  "erp_production_schedule"
  "erp_production_schedule_item"
  "erp_mrp_params"
  "erp_mrp_result"
  "erp_work_order"
  "erp_work_order_progress"
  "erp_quality_standard"
  "erp_quality_item"
  "erp_quality_inspection"
  "erp_quality_inspection_item"
  "erp_equipment"
  "erp_equipment_status"
  "erp_cost_standard"
  "erp_cost_actual"
  "erp_cost_variance"
  "erp_work_hours"
  "erp_production_kpi"
  "erp_production_report"
  "erp_production_dashboard_config"
)

echo "å¼€å§‹æ‰¹é‡åˆ›å»ºä»£ç ç”Ÿæˆå™¨è¡¨å®šä¹‰..."

# åˆ›å»ºè¡¨å®šä¹‰
TABLE_NAMES_JSON=$(printf '%s\n' "${TABLES[@]}" | jq -R . | jq -s .)
RESPONSE=$(curl -s -X POST "${BASE_URL}/infra/codegen/create-list" \
  -H "Authorization: Bearer ${TOKEN}" \
  -H "Content-Type: application/json" \
  -d "{\"dataSourceConfigId\": ${DATA_SOURCE_ID}, \"tableNames\": ${TABLE_NAMES_JSON}}")

TABLE_IDS=$(echo $RESPONSE | jq -r '.data[]')
echo "åˆ›å»ºçš„è¡¨ID: ${TABLE_IDS}"

# ä¸‹è½½æ¯ä¸ªè¡¨çš„ä»£ç 
for TABLE_ID in $TABLE_IDS; do
  echo "ä¸‹è½½è¡¨ID ${TABLE_ID} çš„ä»£ç ..."
  curl -X GET "${BASE_URL}/infra/codegen/download?tableId=${TABLE_ID}" \
    -H "Authorization: Bearer ${TOKEN}" \
    -o "codegen-table-${TABLE_ID}.zip"
done

echo "æ‰¹é‡ç”Ÿæˆå®Œæˆï¼"
```

### æ³¨æ„äº‹é¡¹

1. **è®¤è¯Token**: æ‰€æœ‰APIè°ƒç”¨éƒ½éœ€è¦åœ¨Headerä¸­æºå¸¦JWT Token
   ```
   Authorization: Bearer YOUR_JWT_TOKEN
   ```

2. **æ•°æ®æºé…ç½®ID**: é€šå¸¸ä¸º1ï¼Œå¦‚æœä½¿ç”¨å¤šæ•°æ®æºï¼Œéœ€è¦ç¡®è®¤æ­£ç¡®çš„ID

3. **è¡¨å®šä¹‰é…ç½®**: åœ¨ä¸‹è½½ä»£ç å‰ï¼Œå»ºè®®å…ˆæ›´æ–°è¡¨å®šä¹‰ï¼Œé…ç½®æ­£ç¡®çš„ï¼š
   - `moduleName`: æ¨¡å—åï¼ˆå¦‚ï¼šerpï¼‰
   - `businessName`: ä¸šåŠ¡åï¼ˆå¦‚ï¼šproduction-orderï¼‰
   - `className`: ç±»åï¼ˆå¦‚ï¼šProductionOrderï¼‰
   - `classComment`: ç±»æ³¨é‡Š
   - `author`: ä½œè€…
   - `parentMenuId`: çˆ¶èœå•ID

4. **å­—æ®µé…ç½®**: åœ¨æ›´æ–°è¡¨å®šä¹‰æ—¶ï¼Œå¯ä»¥é…ç½®æ¯ä¸ªå­—æ®µçš„ï¼š
   - `createOperation`: æ˜¯å¦åœ¨åˆ›å»ºæ—¶ä½¿ç”¨
   - `updateOperation`: æ˜¯å¦åœ¨æ›´æ–°æ—¶ä½¿ç”¨
   - `listOperation`: æ˜¯å¦åœ¨åˆ—è¡¨æŸ¥è¯¢æ—¶ä½¿ç”¨
   - `listOperationResult`: æ˜¯å¦åœ¨åˆ—è¡¨ç»“æœä¸­è¿”å›
   - `htmlType`: å‰ç«¯è¡¨å•ç±»å‹ï¼ˆinputã€selectã€dateç­‰ï¼‰

5. **æƒé™è¦æ±‚**: ç¡®ä¿ç”¨æˆ·å…·æœ‰ä»¥ä¸‹æƒé™ï¼š
   - `infra:codegen:query` - æŸ¥è¯¢æƒé™
   - `infra:codegen:create` - åˆ›å»ºæƒé™
   - `infra:codegen:update` - æ›´æ–°æƒé™
   - `infra:codegen:preview` - é¢„è§ˆæƒé™
   - `infra:codegen:download` - ä¸‹è½½æƒé™

## ğŸ“ é‡åˆ°é—®é¢˜ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
2. åŒ…åå’Œå¯¼å…¥è·¯å¾„æ˜¯å¦åŒ¹é…
3. ç¼–è¯‘é”™è¯¯ä¿¡æ¯
4. æ•°æ®åº“è¡¨æ˜¯å¦å·²åˆ›å»º
5. API Tokenæ˜¯å¦æœ‰æ•ˆ
6. æ•°æ®æºé…ç½®IDæ˜¯å¦æ­£ç¡®
7. ç”¨æˆ·æƒé™æ˜¯å¦è¶³å¤Ÿ

