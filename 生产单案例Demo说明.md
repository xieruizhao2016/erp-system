# 生产单案例Demo说明文档

## 📋 概述

本文档详细说明了生产管理系统完整案例Demo的数据结构和业务流程。本Demo以"生产100个智能手环"为例，展示了从基础数据准备到生产订单创建的完整流程。

---

## 🎯 案例场景

**案例名称**：智能手环生产订单  
**生产数量**：100个  
**产品类型**：成品（智能手环）  
**生产周期**：2025-01-15 至 2025-01-20

---

## 📦 一、产品结构

### 1.1 产品层级

本案例包含3层产品结构：

```
智能手环（成品）
├── 手环主板（半成品）
│   ├── PCB板（原材料）
│   ├── 主控芯片（原材料）
│   ├── 显示屏（原材料）
│   ├── 电池（原材料）
│   ├── 传感器（原材料）
│   └── 焊锡（原材料）
└── 手环表带（半成品）
    ├── 硅胶材料（原材料）
    └── 表扣（原材料）
```

### 1.2 产品清单

#### 成品
- **智能手环** (ID: 2001)
  - 类型：成品
  - 规格：标准版
  - 销售价格：299.00元

#### 半成品
- **手环主板** (ID: 2002)
  - 类型：半成品
  - 规格：V1.0
  - 销售价格：150.00元

- **手环表带** (ID: 2003)
  - 类型：半成品
  - 规格：标准
  - 销售价格：20.00元

#### 原材料
- **PCB板** (ID: 2010) - 采购价格：12.00元
- **主控芯片** (ID: 2004) - 采购价格：25.00元
- **显示屏** (ID: 2005) - 采购价格：35.00元
- **电池** (ID: 2006) - 采购价格：15.00元
- **传感器** (ID: 2007) - 采购价格：20.00元
- **焊锡** (ID: 2011) - 采购价格：0.05元/克
- **硅胶材料** (ID: 2008) - 采购价格：5.00元/米
- **表扣** (ID: 2009) - 采购价格：3.00元

---

## 🔧 二、BOM配置

### 2.1 智能手环BOM（成品）

**BOM编号**：BOM-2001-001  
**BOM名称**：智能手环BOM  
**版本**：1.0

| 序号 | 子产品 | 用量 | 损耗率 | 有效用量 | 是否关键物料 |
|------|--------|------|--------|----------|--------------|
| 1 | 手环主板 | 1.0000 | 1% | 1.0100 | 是 |
| 2 | 手环表带 | 1.0000 | 0% | 1.0000 | 否 |

### 2.2 手环主板BOM（半成品）

**BOM编号**：BOM-2002-001  
**BOM名称**：手环主板BOM  
**版本**：1.0

| 序号 | 子产品 | 用量 | 损耗率 | 有效用量 | 是否关键物料 |
|------|--------|------|--------|----------|--------------|
| 1 | PCB板 | 1.0000 | 2% | 1.0200 | 是 |
| 2 | 主控芯片 | 1.0000 | 1% | 1.0100 | 是 |
| 3 | 显示屏 | 1.0000 | 1% | 1.0100 | 是 |
| 4 | 电池 | 1.0000 | 0% | 1.0000 | 是 |
| 5 | 传感器 | 1.0000 | 1% | 1.0100 | 是 |
| 6 | 焊锡 | 5.0000克 | 10% | 5.5000克 | 否 |

### 2.3 手环表带BOM（半成品）

**BOM编号**：BOM-2003-001  
**BOM名称**：手环表带BOM  
**版本**：1.0

| 序号 | 子产品 | 用量 | 损耗率 | 有效用量 | 是否关键物料 |
|------|--------|------|--------|----------|--------------|
| 1 | 硅胶材料 | 0.1500米 | 5% | 0.1575米 | 否 |
| 2 | 表扣 | 1.0000 | 0% | 1.0000 | 否 |

---

## 🏭 三、工艺路线配置

### 3.1 智能手环工艺路线（成品）

**工艺路线编号**：ROUTE-2001-001  
**工艺路线名称**：智能手环工艺路线  
**标准周期时间**：60分钟  
**标准人工成本**：30.00元  
**标准制造费用**：20.00元

| 序号 | 工序名称 | 标准工时(分钟) | 准备时间(分钟) | 人员数量 | 是否瓶颈 | 需要质检 |
|------|----------|----------------|----------------|----------|----------|----------|
| 1 | 组装 | 30 | 5 | 2 | 否 | 否 |
| 2 | 最终测试 | 20 | 5 | 1 | 否 | 是 |
| 3 | 包装 | 5 | 0 | 1 | 否 | 否 |

### 3.2 手环主板工艺路线（半成品）

**工艺路线编号**：ROUTE-2002-001  
**工艺路线名称**：手环主板工艺路线  
**标准周期时间**：120分钟  
**标准人工成本**：50.00元  
**标准制造费用**：30.00元

| 序号 | 工序名称 | 标准工时(分钟) | 准备时间(分钟) | 人员数量 | 设备 | 是否瓶颈 | 需要质检 |
|------|----------|----------------|----------------|----------|------|----------|----------|
| 1 | SMT贴片 | 30 | 10 | 2 | SMT贴片机 | 否 | 是 |
| 2 | 回流焊 | 20 | 5 | 1 | 回流焊炉 | 否 | 否 |
| 3 | 功能测试 | 15 | 5 | 1 | 测试设备 | 否 | 是 |

### 3.3 手环表带工艺路线（半成品）

**工艺路线编号**：ROUTE-2003-001  
**工艺路线名称**：手环表带工艺路线  
**标准周期时间**：30分钟  
**标准人工成本**：10.00元  
**标准制造费用**：5.00元

| 序号 | 工序名称 | 标准工时(分钟) | 准备时间(分钟) | 人员数量 | 设备 | 是否瓶颈 | 需要质检 |
|------|----------|----------------|----------------|----------|------|----------|----------|
| 1 | 注塑成型 | 20 | 5 | 1 | 注塑机 | 否 | 否 |
| 2 | 安装表扣 | 5 | 0 | 1 | - | 否 | 否 |

---

## 📋 四、生产订单

### 4.1 订单基本信息

- **生产订单号**：PO-20250101-001
- **产品**：智能手环
- **产品规格**：标准版
- **生产数量**：100个
- **已完成数量**：0个
- **计划开始时间**：2025-01-15 08:00:00
- **计划完成时间**：2025-01-20 18:00:00
- **状态**：待开始（1）
- **优先级**：高（2）
- **来源类型**：手动创建（1）
- **生产说明**：生产100个智能手环，用于春节促销活动
- **备注**：注意质量把控，确保按时交付

### 4.2 物料需求计算（生产100个智能手环）

#### 直接物料需求（从成品BOM）
- 手环主板：100 × 1.01 = 101个
- 手环表带：100 × 1.00 = 100个

#### 间接物料需求（从半成品BOM）

**手环主板（101个）所需原材料：**
- PCB板：101 × 1.02 = 103.02个 ≈ 104个
- 主控芯片：101 × 1.01 = 102.01个 ≈ 103个
- 显示屏：101 × 1.01 = 102.01个 ≈ 103个
- 电池：101 × 1.00 = 101个
- 传感器：101 × 1.01 = 102.01个 ≈ 103个
- 焊锡：101 × 5.5 = 555.5克 ≈ 556克

**手环表带（100个）所需原材料：**
- 硅胶材料：100 × 0.1575 = 15.75米 ≈ 16米
- 表扣：100 × 1.00 = 100个

#### 总物料需求汇总

| 物料名称 | 单位 | 需求数量 | 备注 |
|----------|------|----------|------|
| PCB板 | 个 | 104 | 关键物料 |
| 主控芯片 | 个 | 103 | 关键物料 |
| 显示屏 | 个 | 103 | 关键物料 |
| 电池 | 个 | 101 | 关键物料 |
| 传感器 | 个 | 103 | 关键物料 |
| 焊锡 | 克 | 556 | 辅助材料 |
| 硅胶材料 | 米 | 16 | 辅助材料 |
| 表扣 | 个 | 100 | 辅助材料 |

---

## 🔄 五、生产流程

### 5.1 状态流转

```
待开始 (1) 
  ↓ [物料检查通过]
待排产 (2) 
  ↓ [开始生产]
进行中 (2) 
  ↓ [生产完成]
已完成 (4)
```

### 5.2 生产执行步骤

#### 阶段1：半成品生产

**1.1 手环主板生产**
1. SMT贴片（30分钟 + 10分钟准备）
   - 贴装主控芯片和传感器
   - 需要质检
2. 回流焊（20分钟 + 5分钟准备）
   - 焊接电子元件
3. 功能测试（15分钟 + 5分钟准备）
   - 测试主板功能
   - 需要质检
4. 半成品入库（手环主板）

**1.2 手环表带生产**
1. 注塑成型（20分钟 + 5分钟准备）
   - 注塑表带
2. 安装表扣（5分钟）
   - 手工安装
3. 半成品入库（手环表带）

#### 阶段2：成品生产

**2.1 组装（30分钟 + 5分钟准备）**
- 组装主板和表带
- 2人作业

**2.2 最终测试（20分钟 + 5分钟准备）**
- 成品功能测试
- 需要质检
- 1人作业

**2.3 包装（5分钟）**
- 产品包装
- 1人作业

**2.4 成品入库**
- 100个智能手环入库
- 状态变更为"已完成"

---

## 📊 六、成本分析

### 6.1 材料成本（单个智能手环）

#### 手环主板材料成本
- PCB板：1.02 × 12.00 = 12.24元
- 主控芯片：1.01 × 25.00 = 25.25元
- 显示屏：1.01 × 35.00 = 35.35元
- 电池：1.00 × 15.00 = 15.00元
- 传感器：1.01 × 20.00 = 20.20元
- 焊锡：5.5 × 0.05 = 0.28元
- **小计**：108.32元

#### 手环表带材料成本
- 硅胶材料：0.1575 × 5.00 = 0.79元
- 表扣：1.00 × 3.00 = 3.00元
- **小计**：3.79元

#### 总材料成本
- **单个成品材料成本**：108.32 + 3.79 = 112.11元

### 6.2 人工成本（单个智能手环）

#### 手环主板人工成本
- SMT贴片：25.00元
- 回流焊：15.00元
- 功能测试：10.00元
- **小计**：50.00元

#### 手环表带人工成本
- 注塑成型：8.00元
- 安装表扣：2.00元
- **小计**：10.00元

#### 成品组装人工成本
- 组装：20.00元
- 最终测试：10.00元
- 包装：0.00元
- **小计**：30.00元

#### 总人工成本
- **单个成品人工成本**：50.00 + 10.00 + 30.00 = 90.00元

### 6.3 制造费用（单个智能手环）

#### 手环主板制造费用
- SMT贴片：15.00元
- 回流焊：10.00元
- 功能测试：5.00元
- **小计**：30.00元

#### 手环表带制造费用
- 注塑成型：4.00元
- 安装表扣：1.00元
- **小计**：5.00元

#### 成品组装制造费用
- 组装：12.00元
- 最终测试：8.00元
- 包装：0.00元
- **小计**：20.00元

#### 总制造费用
- **单个成品制造费用**：30.00 + 5.00 + 20.00 = 55.00元

### 6.4 总成本汇总

| 成本类型 | 单个成本 | 100个总成本 |
|----------|----------|-------------|
| 材料成本 | 112.11元 | 11,211.00元 |
| 人工成本 | 90.00元 | 9,000.00元 |
| 制造费用 | 55.00元 | 5,500.00元 |
| **总成本** | **257.11元** | **25,711.00元** |

### 6.5 利润分析

- **销售价格**：299.00元/个
- **总成本**：257.11元/个
- **毛利润**：41.89元/个
- **毛利率**：14.01%

---

## 🗄️ 七、数据库表说明

### 7.1 涉及的主要表

1. **erp_product** - 产品表
2. **erp_product_bom** - BOM主表
3. **erp_product_bom_item** - BOM明细表
4. **erp_process_route** - 工艺路线主表
5. **erp_process_route_item** - 工艺路线明细表
6. **erp_production_order** - 生产订单表
7. **erp_equipment** - 设备表（如存在）
8. **erp_warehouse** - 仓库表

### 7.2 数据ID分配

- **产品分类ID**：1001-1003
- **产品单位ID**：101-105
- **产品ID**：2001-2011
- **仓库ID**：3001-3003
- **设备ID**：4001-4005
- **工作中心ID**：5001-5003
- **BOM主表ID**：6001-6003
- **BOM明细ID**：7001-7010
- **工艺路线ID**：8001-8003
- **工艺路线明细ID**：9001-9008

---

## 📝 八、使用说明

### 8.1 执行SQL脚本

1. **检查数据库连接**
   - 确保数据库连接正常
   - 确认租户ID（默认使用1）

2. **执行Demo脚本**
   ```bash
   mysql -u用户名 -p数据库名 < production-order-demo.sql
   ```

3. **验证数据**
   - 检查产品数据是否创建成功
   - 检查BOM配置是否正确
   - 检查工艺路线是否完整
   - 检查生产订单是否创建

### 8.2 注意事项

1. **租户ID调整**
   - 脚本中默认使用 `@tenant_id = 1`
   - 实际使用时请根据系统实际情况修改

2. **表结构依赖**
   - 部分表（如设备表、工作中心表）可能需要根据系统实际情况调整
   - 如果表不存在，需要先创建相应的表结构

3. **数据完整性**
   - 执行脚本前，确保相关基础表已存在
   - 确保产品分类、单位等基础数据已配置

4. **状态流转**
   - Demo中的生产订单状态为"待开始"
   - 可根据实际业务流程手动更新状态
   - 状态流转需要符合业务规则

### 8.3 后续操作建议

1. **物料准备**
   - 检查原材料库存是否充足
   - 如不足，创建采购订单

2. **生产执行**
   - 根据工艺路线执行生产
   - 记录实际工时和机时
   - 完成质检流程

3. **数据统计**
   - 查看生产报表
   - 分析生产KPI
   - 对比标准成本和实际成本

---

## 🔍 九、查询示例

### 9.1 查询生产订单

```sql
SELECT * FROM `erp_production_order` 
WHERE `no` = 'PO-20250101-001' AND `deleted` = b'0';
```

### 9.2 查询BOM明细

```sql
SELECT 
    bom.bom_no, bom.bom_name, bom.product_id, p.name as product_name,
    item.child_product_id, cp.name as child_product_name, 
    item.quantity, item.loss_rate, item.effective_quantity,
    item.is_key_material, item.position
FROM `erp_product_bom` bom
LEFT JOIN `erp_product` p ON bom.product_id = p.id
LEFT JOIN `erp_product_bom_item` item ON bom.id = item.bom_id
LEFT JOIN `erp_product` cp ON item.child_product_id = cp.id
WHERE bom.product_id = 2001 AND bom.deleted = b'0' AND item.deleted = b'0'
ORDER BY item.position;
```

### 9.3 查询工艺路线明细

```sql
SELECT 
    route.route_no, route.route_name, route.product_id, p.name as product_name,
    item.sequence, item.operation_name, item.standard_time, item.setup_time,
    item.worker_count, item.is_bottleneck, item.quality_check_required
FROM `erp_process_route` route
LEFT JOIN `erp_product` p ON route.product_id = p.id
LEFT JOIN `erp_process_route_item` item ON route.id = item.route_id
WHERE route.product_id = 2001 AND route.deleted = b'0' AND item.deleted = b'0'
ORDER BY item.sequence;
```

### 9.4 计算物料需求

```sql
-- 查询生产100个智能手环所需的原材料
SELECT 
    cp.id as material_id,
    cp.name as material_name,
    SUM(item.effective_quantity * 100) as required_quantity,
    cp.unit_id,
    u.name as unit_name
FROM `erp_production_order` po
LEFT JOIN `erp_product` p ON po.product_id = p.id
LEFT JOIN `erp_product_bom` bom ON p.id = bom.product_id AND bom.status = 2
LEFT JOIN `erp_product_bom_item` item ON bom.id = item.bom_id
LEFT JOIN `erp_product` cp ON item.child_product_id = cp.id
LEFT JOIN `erp_product_unit` u ON cp.unit_id = u.id
WHERE po.no = 'PO-20250101-001' 
  AND po.deleted = b'0' 
  AND bom.deleted = b'0' 
  AND item.deleted = b'0'
  AND cp.production_type = 1  -- 原材料
GROUP BY cp.id, cp.name, cp.unit_id, u.name;
```

---

## 📌 十、总结

本Demo案例完整展示了生产管理系统的核心功能：

✅ **基础数据管理**：产品、分类、单位等  
✅ **BOM配置**：多层级BOM结构  
✅ **工艺路线配置**：完整的生产工艺流程  
✅ **生产订单管理**：订单创建和状态管理  
✅ **成本分析**：材料成本、人工成本、制造费用  
✅ **数据关联**：产品、BOM、工艺路线、生产订单的完整关联

通过本Demo，可以：
- 理解生产管理系统的完整业务流程
- 学习BOM和工艺路线的配置方法
- 掌握生产订单的创建和管理
- 进行成本分析和利润计算

---

*最后更新时间：2025-01*  
*文档版本：v1.0*

