# ERP 生产管理系统开发计划

## 📋 项目概述

### 系统名称：生产管理系统 (Production Management System, PMS)
### 开发理念：基于现有ERP系统，构建完整的生产管理解决方案
### 开发模式：分阶段渐进式开发，逐步扩展功能模块
### 开发周期：总周期约 4-6 个月，分 4 个阶段实施

---

## 🏗️ 现有ERP系统基础

### 已有模块分析

当前ERP系统已具备完善的基础模块：

| 模块名称 | 已实现功能 | 相关数据表 | 与生产管理的集成点 |
|---------|----------|----------|-----------------|
| **产品管理** | 产品信息、产品分类、产品单位 | erp_product, erp_product_category, erp_product_unit | 提供BOM基础数据 |
| **库存管理** | 库存查询、出入库、盘点、调拨 | erp_stock, erp_stock_in/out, erp_warehouse | 支撑生产物料流转 |
| **采购管理** | 采购订单、入库、退货 | erp_purchase_order, erp_supplier | 原材料采购供应 |
| **销售管理** | 销售订单、出库、退货 | erp_sale_order, erp_customer | 生产需求来源 |
| **财务管理** | 收款、付款、账户 | erp_finance_receipt, erp_finance_payment | 生产成本核算 |

### 现有数据表（共28张）
```text
销售模块：erp_sale_order, erp_sale_order_items, erp_sale_out, erp_sale_out_items, erp_sale_return, erp_sale_return_items, erp_customer
产品模块：erp_product, erp_product_category, erp_product_unit
采购模块：erp_purchase_order, erp_purchase_order_items, erp_purchase_in, erp_purchase_in_items, erp_purchase_return, erp_purchase_return_items, erp_supplier
财务模块：erp_finance_payment, erp_finance_payment_item, erp_finance_receipt, erp_finance_receipt_item, erp_account
库存模块：erp_stock, erp_stock_in, erp_stock_in_item, erp_stock_out, erp_stock_out_item, erp_stock_check, erp_stock_check_item, erp_stock_move, erp_stock_move_item, erp_stock_record, erp_warehouse
```

### 现有技术架构优势

1. **Yudao框架**：基于Spring Boot + MyBatis + Vue3技术栈
2. **多租户支持**：完整的租户隔离机制
3. **权限管理**：RBAC权限模型
4. **模块化设计**：独立模块，易于扩展

---

## 🎯 生产管理系统总体规划

### 系统定位
```
ERP系统 = 业务管理平台
├─ 基础模块：产品、库存、采购、销售、财务（现有）
└─ 核心模块：生产管理（新增）
```

### 核心价值
1. **闭环管理**：销售订单 → 生产计划 → 采购 → 生产执行 → 成品入库 → 销售发货 → 财务结算
2. **精益生产**：减少库存、缩短周期、提高效率
3. **成本控制**：精确核算生产各环节成本
4. **质量追溯**：全流程质量管控与追溯

---

## 📚 分阶段开发路线图

### Phase 1: 生产订单管理（当前核心）
**开发周期**：3-4周
**优先级**：⭐⭐⭐⭐⭐

#### 目标
构建生产管理基础平台，实现生产单的全生命周期管理

#### 核心功能
1. **生产单管理**
   - 生产单CRUD（创建、查询、更新）
   - 状态流转管理（9种状态）
   - 生产单明细管理

2. **物料转化管理**
   - 物料消耗记录
   - 半成品/成品产出记录
   - 转化率统计
   - 物料转化历史

3. **仓库类型管理**
   - 原材料仓、半成品仓、成品仓
   - 产品类型分类（源材料、半成品、成品）
   - 仓库类型与产品类型匹配验证

4. **模块集成**
   - 与销售模块集成（销售订单触发生产）
   - 与采购模块集成（采购入库关联生产单）
   - 与库存模块集成（出入库关联生产单）
   - 与财务模块集成（收款完成生产单）

#### 技术实现
- **数据库设计**：3张新表
  - erp_production_order（生产单主表）
  - erp_production_order_item（生产单明细表）
  - erp_material_conversion（物料转化记录表）
- **字段扩展**：
  - erp_product 增加 production_type 字段
  - erp_warehouse 增加 warehouse_type 字段
  - 采购/销售/库存/财务表增加 production_order_id 关联字段

#### 交付物
- 后端API接口（20+接口）
- 前端管理界面（5个页面）
- 数据库脚本
- 技术文档

---

### Phase 2: 生产计划管理
**开发周期**：4-5周
**优先级**：⭐⭐⭐⭐⭐

#### 目标
构建完整的生产计划体系，实现从BOM到排产的全流程管理

#### 核心功能
1. **BOM管理（物料清单）**
   - BOM层级结构管理（父物料-子物料）
   - BOM版本管理
   - 用量计算（包含损耗率）
   - BOM查询与展开

2. **工艺路线管理**
   - 工艺路线定义（工序顺序）
   - 工序标准工时
   - 工序资源需求（设备、人力）
   - 工艺路线模板

3. **生产排产**
   - 产能负荷计算
   - 设备排程
   - 优先级排序
   - 动态调整（插单、延期处理）

4. **MRP运算（物料需求计划）**
   - 基于BOM和库存计算物料需求
   - 生成采购建议
   - 生成生产计划
   - 缺料分析

#### 数据库设计（12张新表）
```sql
-- BOM相关
erp_product_bom (BOM主表)
erp_product_bom_item (BOM明细)
erp_product_bom_version (BOM版本)

-- 工艺路线相关
erp_process_route (工艺路线)
erp_process_route_item (工艺路线明细)
erp_process_definition (工序定义)

-- 排产相关
erp_production_schedule (排产计划)
erp_capacity_planning (产能规划)

-- MRP相关
erp_mrp_params (MRP参数)
erp_mrp_result (MRP运算结果)
erp_mrp_shortage (缺料分析)
```

#### 技术亮点
- BOM树形结构查询优化
- 复杂排产算法（考虑设备、人员、物料约束）
- MRP批量运算性能优化

---

### Phase 3: 生产执行与质量管理
**开发周期**：5-6周
**优先级**：⭐⭐⭐⭐

#### 目标
实现生产过程实时监控与质量管理

#### 核心功能
1. **工序管理**
   - 工单下发
   - 工序进度追踪
   - 工序交接
   - 异常处理

2. **质检管理**
   - 质检标准定义
   - 质检方案（抽检/全检）
   - 质检记录录入
   - 不合格品处理
   - 质量追溯

3. **设备管理**
   - 设备台账
   - 设备状态监控
   - 维护计划
   - 故障管理
   - OEE计算

4. **生产监控**
   - 实时生产看板
   - 异常告警
   - 产量统计
   - 效率分析

#### 数据库设计（15张新表）
```sql
-- 工序管理
erp_work_order (工单)
erp_work_order_item (工单明细)
erp_work_order_progress (工序进度)

-- 质量管理
erp_quality_standard (质检标准)
erp_quality_plan (质检方案)
erp_quality_inspection (质检记录)
erp_quality_defect (不合格品)

-- 设备管理
erp_equipment (设备台账)
erp_equipment_status (设备状态)
erp_equipment_maintenance (维护计划)
erp_equipment_failure (故障记录)

-- 生产监控
erp_production_monitor (生产监控)
erp_production_alert (生产异常)
erp_shift (班组管理)
erp_shift_detail (班组明细)
```

#### 技术亮点
- 实时数据采集（WebSocket）
- 质检数据统计分析
- 设备OEE实时计算

---

### Phase 4: 成本核算与数据分析
**开发周期**：4-5周
**优先级**：⭐⭐⭐⭐

#### 目标
构建完整的生产成本核算体系与数据分析平台

#### 核心功能
1. **成本核算**
   - 材料成本核算（BOM用量×单价）
   - 人工成本核算（工时×人工单价）
   - 制造费用分摊（水电、折旧、管理费）
   - 成本差异分析（实际vs标准）

2. **成本报表**
   - 产品成本明细表
   - 订单成本汇总表
   - 成本趋势分析
   - 成本对比分析

3. **生产数据分析**
   - 产能分析（实际产能vs理论产能）
   - 效率分析（OEE、停机率）
   - 质量分析（合格率、不良率）
   - 交期分析（准时交付率）

4. **生产看板**
   - 实时生产看板（大屏展示）
   - 移动端看板
   - 自定义报表
   - 数据导出

#### 数据库设计（8张新表）
```sql
-- 成本核算
erp_cost_standard (标准成本)
erp_cost_actual (实际成本)
erp_cost_variance (成本差异)
erp_work_hours (工时统计)

-- 数据分析
erp_production_kpi (生产KPI)
erp_production_report (生产报表)
erp_production_dashboard_config (看板配置)

-- 基础数据
erp_cost_rate (费用率)
```

#### 技术亮点
- 复杂成本核算算法
- 大数据量报表性能优化
- 数据可视化（图表展示）

---

## 🏛️ 完整系统架构设计

### 整体架构图
```text
┌─────────────────────────────────────────────────────────────────┐
│                    ERP 生产管理系统                                 │
├─────────────────────────────────────────────────────────────────┤
│  前端层 (Vue3 + TypeScript)                                        │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐        │
│  │生产订单  │生产计划  │生产执行  │质量管理  │成本分析  │        │
│  │管理界面  │管理界面  │管理界面  │管理界面  │管理界面  │        │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘        │
├─────────────────────────────────────────────────────────────────┤
│  服务层 (Spring Boot + MyBatis-Plus)                               │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │  生产订单服务 (ProductionOrderService)                      │  │
│  ├────────────────────────────────────────────────────────────┤  │
│  │  生产计划服务 (ProductionPlanningService)                   │  │
│  ├────────────────────────────────────────────────────────────┤  │
│  │  生产执行服务 (ProductionExecutionService)                  │  │
│  ├────────────────────────────────────────────────────────────┤  │
│  │  质量管理服务 (QualityManagementService)                    │  │
│  ├────────────────────────────────────────────────────────────┤  │
│  │  成本核算服务 (CostAccountingService)                       │  │
│  └────────────────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────────┤
│  数据访问层 (MyBatis)                                              │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐        │
│  │生产模块  │计划模块  │执行模块  │质量模块  │成本模块  │        │
│  │Mapper    │Mapper    │Mapper    │Mapper    │Mapper    │        │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘        │
├─────────────────────────────────────────────────────────────────┤
│  数据库层 (MySQL 8.0)                                              │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │  现有模块：产品、库存、采购、销售、财务 (28张表)               │  │
│  ├────────────────────────────────────────────────────────────┤  │
│  │  生产模块：Phase1 (3张表)                                   │  │
│  ├────────────────────────────────────────────────────────────┤  │
│  │  计划模块：Phase2 (12张表)                                  │  │
│  ├────────────────────────────────────────────────────────────┤  │
│  │  执行模块：Phase3 (15张表)                                  │  │
│  ├────────────────────────────────────────────────────────────┤  │
│  │  成本模块：Phase4 (8张表)                                   │  │
│  └────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

### 模块依赖关系
```text
生产执行 ←─ 依赖 ──┐
  ↑                │
  │                │
  ↓                │
生产计划 ←─ 依赖 ──┤
  ↑                │
  │                │
  ↓                │
生产订单 ←─ 依赖 ──┘
  ↑
  │
现有模块（产品、库存、采购、销售、财务）
```

---

## 🔗 与现有ERP模块的集成方案

### 1. 销售模块集成
```text
业务场景：销售订单 → 生产订单

集成方式：
- 销售订单增加"是否需要生产"字段
- 可从销售订单直接创建生产订单
- 生产完成后自动通知销售模块
- 销售出库可关联生产订单

数据表集成：
erp_sale_order 增加 production_order_id 字段
erp_sale_order_items 增加 production_order_item_id 字段
```

### 2. 采购模块集成
```text
业务场景：生产计划 → 采购需求 → 采购订单 → 入库 → 生产领用

集成方式：
- MRP运算生成采购建议
- 采购订单关联生产订单
- 采购入库记录生产单明细
- 支持生产紧急采购流程

数据表集成：
erp_purchase_order 增加 production_order_id 字段
erp_purchase_order_items 增加 production_order_item_id 字段
```

### 3. 库存模块集成
```text
业务场景：生产领料 → 加工 → 成品入库

集成方式：
- 出库记录关联生产单明细
- 入库记录关联生产单明细
- 支持多仓库类型（原材料/半成品/成品）
- 实时库存预警

数据表集成：
erp_stock_in 增加 production_order_id, production_order_item_id
erp_stock_out 增加 production_order_id, production_order_item_id
erp_stock 增加 warehouse_type 字段
```

### 4. 财务模块集成
```text
业务场景：生产成本 → 财务核算

集成方式：
- 收款单关联生产订单
- 生产成本自动结转
- 支持分批结算
- 成本差异分析

数据表集成：
erp_finance_receipt 增加 production_order_id 字段
erp_cost_actual 提供财务接口
```

### 5. 产品模块扩展
```text
业务场景：BOM、工艺路线

集成方式：
- 产品增加BOM信息
- 扩展产品类型（支持生产类型）
- 产品属性扩展（支持工艺属性）

数据表扩展：
erp_product 增加 production_type, bom_id, route_id 字段
```

---

## 📊 核心业务场景演示

### 场景1：订单驱动的生产流程
```text
Step 1: 销售下单
客户下单 → 销售订单创建 → 检查库存 → 发现需要生产

Step 2: 创建生产订单
从销售订单创建生产订单 → 自动展开BOM → MRP运算 → 生成物料需求

Step 3: 物料准备
采购原材料 → 仓库入库 → 质检合格 → 物料准备完成

Step 4: 生产执行
生产领料 → 工序加工 → 半成品入库 → 继续加工 → 成品入库

Step 5: 成品交付
生产完成 → 销售出库 → 客户收货 → 财务结算

Step 6: 完成归档
收款确认 → 生产订单完成 → 数据归档
```

### 场景2：库存驱动的生产流程
```text
Step 1: 库存预警
系统检测 → 库存低于安全库存 → 自动触发生产建议

Step 2: 生产计划
根据库存需求 → 创建生产订单 → 计算物料缺口 → 采购计划

Step 3: 生产执行
物料到位 → 开始生产 → 工序追踪 → 质量检测 → 成品入库

Step 4: 补库完成
库存恢复到安全线以上 → 生产订单结束
```

---

## 🔒 技术实现关键点

### 1. 数据一致性保证
```java
// 使用分布式事务（Seata）保证跨模块数据一致性
@GlobalTransactional(rollbackFor = Exception.class)
public void createProductionOrderFromSaleOrder(Long saleOrderId) {
    // 1. 创建生产订单
    ProductionOrderDO productionOrder = createProductionOrder(saleOrderId);

    // 2. 创建生产单明细（BOM展开）
    List<ProductionOrderItemDO> items = expandBOM(saleOrderId);
    createProductionOrderItems(productionOrder.getId(), items);

    // 3. 更新销售订单（标记已生成生产订单）
    updateSaleOrderProductionFlag(saleOrderId);

    // 4. 预留物料库存
    reserveMaterialStock(items);
}
```

### 2. 租户隔离
```xml
<!-- MyBatis XML中所有查询包含租户ID -->
<select id="selectProductionOrder" resultType="ProductionOrderDO">
    SELECT * FROM erp_production_order
    WHERE tenant_id = ${@cn.iocoder.yudao.framework.tenant.core.context.TenantContextHolder@getTenantId()}
      AND deleted = 0
</select>
```

### 3. 并发控制
```java
// 使用乐观锁防止并发更新
@Version
private Integer version;

@Transactional(rollbackFor = Exception.class)
public void updateProductionOrderStatus(Long id, Integer status) {
    ProductionOrderDO order = productionOrderMapper.selectById(id);
    if (order.getVersion().equals(expectedVersion)) {
        order.setStatus(status);
        order.setVersion(order.getVersion() + 1);
        productionOrderMapper.updateById(order);
    } else {
        throw new BusinessException("生产单已被其他用户修改，请刷新后重试");
    }
}
```

### 4. 性能优化
```java
// 分页查询优化
@Select("SELECT * FROM erp_production_order WHERE tenant_id = #{tenantId} " +
        "AND (#{no} IS NULL OR no LIKE CONCAT('%', #{no}, '%')) " +
        "AND (#{status} IS NULL OR status = #{status}) " +
        "ORDER BY create_time DESC LIMIT #{offset}, #{limit}")
PageResult<ProductionOrderDO> selectPage(ProductionOrderPageReqVO reqVO);

// 缓存优化
@Cacheable(value = "production-order", key = "#id")
public ProductionOrderRespVO getProductionOrder(Long id) {
    // ...
}
```

---

## 📈 关键KPI指标体系

### 生产效率指标
1. **设备综合效率 (OEE)**
   - OEE = 可用率 × 性能 × 质量
   - 目标值：≥ 85%

2. **生产周期时间 (Lead Time)**
   - 从接单到交付的平均时间
   - 目标值：持续缩短

3. **准时交付率 (On-Time Delivery)**
   - 按承诺交期完成的订单占比
   - 目标值：≥ 95%

4. **生产达成率**
   - 实际产量/计划产量
   - 目标值：≥ 98%

### 质量指标
1. **产品合格率 (Pass Rate)**
   - 合格品数量/总生产数量
   - 目标值：≥ 99%

2. **返工率 (Rework Rate)**
   - 返工数量/总生产数量
   - 目标值：≤ 2%

3. **报废率 (Scrap Rate)**
   - 报废数量/总生产数量
   - 目标值：≤ 1%

### 成本指标
1. **单位产品成本**
   - 总成本/产出数量
   - 目标值：持续优化

2. **材料损耗率**
   - 损耗数量/投入数量
   - 目标值：≤ 标准损耗率

3. **人工成本占比**
   - 人工成本/总成本
   - 目标值：控制合理范围

### 设备指标
1. **设备利用率**
   - 实际运行时间/可用时间
   - 目标值：≥ 80%

2. **设备故障率**
   - 故障次数/总运行次数
   - 目标值：≤ 2%

3. **平均修复时间 (MTTR)**
   - 总维修时间/维修次数
   - 目标值：≤ 2小时

---

## 💼 开发组织与计划

### 开发团队配置
```text
团队结构：
├─ 项目经理 × 1（整体协调、进度管控）
├─ 架构师 × 1（技术方案、架构设计）
├─ 后端开发 × 3（业务逻辑、接口开发）
├─ 前端开发 × 2（页面开发、交互实现）
├─ 测试工程师 × 2（功能测试、性能测试）
└─ DBA × 1（数据库设计、优化）
```

### 时间计划表
```text
Phase 1: 生产订单管理（3-4周）
├─ 第1周：数据库设计、后端基础框架
├─ 第2周：后端API开发、前端页面开发
├─ 第3周：功能开发、模块集成
└─ 第4周：测试、文档、优化

Phase 2: 生产计划管理（4-5周）
├─ BOM管理模块（2周）
├─ 工艺路线管理（1.5周）
└─ 排产计划模块（1.5周）

Phase 3: 生产执行与质量管理（5-6周）
├─ 工序管理（2周）
├─ 质检管理（2周）
├─ 设备管理（1.5周）
└─ 生产监控（0.5周）

Phase 4: 成本核算与数据分析（4-5周）
├─ 成本核算（2.5周）
├─ 数据分析（1.5周）
└─ 看板系统（1周）

总计：约 16-20 周（4-5 个月）
```

### 里程碑节点
```text
里程碑1：Phase 1 完成 → 生产订单管理上线
里程碑2：Phase 2 完成 → 生产计划功能完善
里程碑3：Phase 3 完成 → 全面生产管理
里程碑4：Phase 4 完成 → 完整生产管理系统
```

---

## 🛡️ 风险控制与应对策略

### 高风险项及应对
1. **BOM数据质量问题**
   - 风险：BOM数据不准确导致物料需求计算错误
   - 应对：建立BOM数据审核流程，版本管理，数据校验机制

2. **复杂排产算法性能**
   - 风险：排产计算耗时过长影响用户体验
   - 应对：算法优化，异步计算，结果缓存，分批计算

3. **跨模块数据一致性**
   - 风险：多模块间数据不同步
   - 应对：分布式事务，事件驱动，数据校验机制，补偿机制

4. **大数据量性能问题**
   - 风险：生产数据增长导致查询性能下降
   - 应对：索引优化，分库分表，缓存，报表异步生成

### 质量保证措施
1. **代码质量**
   - 代码评审机制
   - 单元测试覆盖率 ≥ 80%
   - 静态代码检查

2. **测试策略**
   - 单元测试
   - 集成测试
   - 性能测试
   - 压力测试

3. **上线策略**
   - 灰度发布
   - 回滚方案
   - 监控告警
   - 应急响应

---

## 🎯 实施建议

### 1. 分阶段实施策略
- **优先级排序**：先核心功能，后辅助功能
- **快速迭代**：2-3周一个迭代周期
- **持续集成**：每日构建，持续集成
- **用户反馈**：及时收集并响应用户反馈

### 2. 数据迁移策略
- **存量数据清洗**：提前6周开始数据清洗
- **分批迁移**：新模块上线前分批迁移数据
- **数据验证**：迁移后进行数据完整性校验
- **回滚准备**：保留回滚方案

### 3. 培训与推广
- **用户培训**：每个模块上线前进行用户培训
- **操作手册**：编写详细的操作手册
- **视频教程**：制作视频教程便于学习
- **持续支持**：提供持续的技术支持

### 4. 持续优化
- **性能监控**：实时监控系统性能
- **用户反馈**：建立用户反馈渠道
- **定期回顾**：每月进行项目回顾
- **持续改进**：根据反馈持续优化

---

## 📞 联系方式

如有疑问或需要协调，请联系项目组。

**文档版本**: 3.0（基于现有ERP系统重构版）
**创建日期**: 2025-11-13
**最后更新**: 2025-11-13
**负责人**: 开发团队
**审核状态**: 待审核

---

## 📝 附录

### A. 数据库设计规范
1. 所有新表必须包含：id, tenant_id, creator, create_time, updater, update_time, deleted
2. 所有业务表必须有索引优化
3. 金额字段统一使用 decimal(20,2)
4. 数量字段统一使用 decimal(20,4)

### B. API设计规范
1. RESTful风格
2. 统一响应格式
3. 统一的错误码
4. 统一的分页格式

### C. 前端开发规范
1. Vue 3 + TypeScript
2. Element Plus UI组件库
3. ECharts图表组件
4. 统一的代码规范

### D. 测试规范
1. 单元测试覆盖率 ≥ 80%
2. 集成测试覆盖核心流程
3. 性能测试覆盖关键接口
4. 安全测试定期进行
