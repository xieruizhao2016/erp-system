# 工序模块检查报告

## 📋 检查时间
2025-11-27

## 🔍 模块概述

系统中存在"工序"模块的后端代码，但存在以下问题：
1. **数据库表未创建** - `erp_process` 表不存在
2. **前端页面缺失** - 没有工序管理的前端页面
3. **菜单配置缺失** - 系统菜单中没有工序模块的入口
4. **错误码定义缺失** - 错误码常量中缺少工序相关的错误码定义

## ✅ 已存在的部分

### 1. 后端代码（完整）

#### Controller层
- **文件**: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/controller/admin/process/ProcessController.java`
- **API路径**: `/erp/process`
- **功能**: 
  - ✅ 创建工序 (`POST /create`)
  - ✅ 更新工序 (`PUT /update`)
  - ✅ 删除工序 (`DELETE /delete`)
  - ✅ 批量删除 (`DELETE /delete-list`)
  - ✅ 查询单个 (`GET /get`)
  - ✅ 分页查询 (`GET /page`)
  - ✅ 简单列表 (`GET /list`)
  - ✅ 导出Excel (`GET /export-excel`)

#### Service层
- **文件**: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/service/process/ProcessServiceImpl.java`
- **功能**:
  - ✅ 工序编号唯一性校验
  - ✅ CRUD操作
  - ✅ 根据工序编号查询
  - ✅ 获取启用状态的工序列表

#### Mapper层
- **文件**: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/mysql/process/ProcessMapper.java`
- **功能**:
  - ✅ 分页查询（支持多条件筛选）
  - ✅ 根据工序编号查询

#### 数据对象
- **文件**: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/dal/dataobject/process/ProcessDO.java`
- **字段**:
  - `id` - 编号
  - `processNo` - 工序编号
  - `processName` - 工序名称
  - `processType` - 工序类型（1-加工，2-装配，3-检验，4-包装，5-其他）
  - `category` - 工序分类
  - `standardTime` - 标准工时（分钟）
  - `setupTime` - 准备时间（分钟）
  - `workerCount` - 标准人员数量
  - `equipmentType` - 设备类型
  - `workCenterId` - 工作中心ID
  - `laborRate` - 人工费率（元/小时）
  - `overheadRate` - 制造费率（元/小时）
  - `qualityCheckRequired` - 是否需要质检
  - `isBottleneck` - 是否瓶颈工序
  - `description` - 工序描述
  - `remark` - 备注
  - `status` - 状态（1-启用，2-停用）

#### SQL建表脚本
- **文件**: `sql/mysql/erp-process-table.sql`
- **状态**: ✅ 脚本存在，但未执行

## ❌ 缺失的部分

### 1. 数据库表
- **表名**: `erp_process`
- **状态**: ❌ 数据库中不存在
- **影响**: 后端API无法正常工作

### 2. 前端页面
- **路径**: `original-yudao-ui/src/views/erp/process/`
- **状态**: ❌ 目录和文件都不存在
- **需要创建**:
  - `index.vue` - 列表页面
  - `ProcessForm.vue` - 表单页面

### 3. 前端API
- **路径**: `original-yudao-ui/src/api/erp/process/`
- **状态**: ❌ 目录和文件都不存在
- **需要创建**: `index.ts` - API接口定义

### 4. 菜单配置
- **状态**: ❌ 系统菜单中没有工序模块的菜单项
- **需要**: 在菜单SQL中添加工序管理菜单

### 5. 错误码定义
- **文件**: `yudao-module-erp/src/main/java/cn/iocoder/yudao/module/erp/enums/ErrorCodeConstants.java`
- **缺失的错误码**:
  - `PROCESS_NOT_EXISTS` - 工序不存在
  - `PROCESS_NO_DUPLICATE` - 工序编号重复
- **影响**: Service层代码引用了这些错误码，但未定义，会导致编译错误

## 🔗 关联模块

### 工艺路线明细（ProcessRouteItem）
- **表**: `erp_process_route_item`
- **字段**: `process_id` - 引用工序ID
- **问题**: 工艺路线明细表中有 `process_id` 字段，但引用的 `erp_process` 表不存在
- **影响**: 无法建立工序与工艺路线明细的关联关系

### 其他使用工序的模块
- **产品BOM明细** (`productbomitem`) - 有工序选择器
- **工单进度** (`workorderprogress`) - 有工序字段
- **工时记录** (`workhours`) - 有工序选择器

## 📊 数据表结构

根据SQL脚本，`erp_process` 表应包含以下字段：

```sql
CREATE TABLE `erp_process` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '编号',
  `tenant_id` bigint NOT NULL COMMENT '租户ID',
  `process_no` varchar(50) NOT NULL COMMENT '工序编号',
  `process_name` varchar(255) NOT NULL COMMENT '工序名称',
  `process_type` int NULL DEFAULT 1 COMMENT '工序类型：1-加工，2-装配，3-检验，4-包装，5-其他',
  `category` varchar(100) NULL COMMENT '工序分类',
  `standard_time` int NULL COMMENT '标准工时（分钟）',
  `setup_time` int NULL DEFAULT 0 COMMENT '准备时间（分钟）',
  `worker_count` int NULL DEFAULT 1 COMMENT '标准人员数量',
  `equipment_type` varchar(100) NULL COMMENT '设备类型',
  `work_center_id` bigint NULL COMMENT '工作中心ID',
  `labor_rate` decimal(10,2) NULL COMMENT '人工费率（元/小时）',
  `overhead_rate` decimal(10,2) NULL COMMENT '制造费率（元/小时）',
  `quality_check_required` bit(1) NULL DEFAULT b'0' COMMENT '是否需要质检',
  `is_bottleneck` bit(1) NULL DEFAULT b'0' COMMENT '是否瓶颈工序',
  `description` text NULL COMMENT '工序描述',
  `remark` varchar(500) NULL DEFAULT '' COMMENT '备注',
  `status` int NULL DEFAULT 1 COMMENT '状态：1-启用，2-停用',
  `creator` varchar(64) NULL DEFAULT '' COMMENT '创建者',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updater` varchar(64) NULL DEFAULT '' COMMENT '更新者',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_tenant_process_no` (`tenant_id`, `process_no`) USING BTREE,
  INDEX `idx_process_name` (`process_name`) USING BTREE,
  INDEX `idx_process_type` (`process_type`) USING BTREE,
  INDEX `idx_status` (`status`) USING BTREE,
  INDEX `idx_work_center` (`work_center_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ERP 工序主表';
```

## 🎯 修复建议

### 优先级1：修复后端错误码
1. 在 `ErrorCodeConstants.java` 中添加工序相关的错误码定义
2. 建议错误码段：`1-030-705-000`（工序模块）

### 优先级2：创建数据库表
1. 执行 `sql/mysql/erp-process-table.sql` 脚本
2. 验证表结构是否正确

### 优先级3：创建前端页面
1. 参考其他模块（如 `processroute`）创建工序管理页面
2. 创建API接口文件
3. 实现列表、新增、编辑、删除功能

### 优先级4：添加菜单配置
1. 在菜单SQL中添加工序管理菜单项
2. 配置权限点（query, create, update, delete, export）

### 优先级5：修复关联关系
1. 确保工艺路线明细中的 `process_id` 能正确关联到工序表
2. 更新其他模块中工序选择器的数据源

## 📝 总结

工序模块的后端代码已经完整实现，但存在以下关键问题：
1. ❌ 数据库表未创建
2. ❌ 前端页面缺失
3. ❌ 菜单配置缺失
4. ❌ 错误码定义缺失

建议按照优先级逐步修复，使工序模块能够正常使用。

