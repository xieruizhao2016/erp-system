# ERPç³»ç»Ÿ - ç«å±±å¼•æ“äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•
1. [å‡†å¤‡å·¥ä½œ](#å‡†å¤‡å·¥ä½œ)
2. [æœåŠ¡å™¨ç¯å¢ƒé…ç½®](#æœåŠ¡å™¨ç¯å¢ƒé…ç½®)
3. [é¡¹ç›®éƒ¨ç½²](#é¡¹ç›®éƒ¨ç½²)
4. [æ•°æ®åº“åˆå§‹åŒ–](#æ•°æ®åº“åˆå§‹åŒ–)
5. [æœåŠ¡å¯åŠ¨ä¸éªŒè¯](#æœåŠ¡å¯åŠ¨ä¸éªŒè¯)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
7. [å®‰å…¨å»ºè®®](#å®‰å…¨å»ºè®®)

---

## å‡†å¤‡å·¥ä½œ

### 1. æœåŠ¡å™¨è¦æ±‚

**æœ€ä½é…ç½®ï¼š**
- CPU: 2æ ¸
- å†…å­˜: 4GB
- ç¡¬ç›˜: 40GB SSD
- æ“ä½œç³»ç»Ÿ: CentOS 7+ / Ubuntu 18.04+ / Debian 10+

**æ¨èé…ç½®ï¼š**
- CPU: 4æ ¸
- å†…å­˜: 8GB
- ç¡¬ç›˜: 100GB SSD
- æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS

### 2. éœ€è¦å®‰è£…çš„è½¯ä»¶

- Docker 20.10+
- Docker Compose 2.0+
- Git
- Maven 3.6+ (ç”¨äºæ„å»ºåç«¯)
- Node.js 16+ å’Œ pnpm (ç”¨äºæ„å»ºå‰ç«¯)

### 3. ç½‘ç»œç«¯å£è¦æ±‚

ç¡®ä¿ä»¥ä¸‹ç«¯å£å·²å¼€æ”¾ï¼š
- **80**: å‰ç«¯è®¿é—®ç«¯å£
- **48080**: åç«¯APIç«¯å£
- **3306**: MySQLç«¯å£ï¼ˆå¦‚ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“ï¼Œå¯ä¸å¼€æ”¾ï¼‰
- **6379**: Redisç«¯å£ï¼ˆå¦‚ä½¿ç”¨å¤–éƒ¨Redisï¼Œå¯ä¸å¼€æ”¾ï¼‰

---

## æœåŠ¡å™¨ç¯å¢ƒé…ç½®

### æ­¥éª¤1: è¿æ¥æœåŠ¡å™¨

ä½¿ç”¨SSHè¿æ¥åˆ°ä½ çš„ç«å±±å¼•æ“äº‘æœåŠ¡å™¨ï¼š

```bash
ssh root@ä½ çš„æœåŠ¡å™¨IP
```

### æ­¥éª¤2: æ›´æ–°ç³»ç»Ÿ

```bash
# CentOS/RHEL
yum update -y

# Ubuntu/Debian
apt update && apt upgrade -y
```

### æ­¥éª¤3: å®‰è£…Docker

```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com | bash

# å¯åŠ¨DockeræœåŠ¡
systemctl start docker
systemctl enable docker

# éªŒè¯å®‰è£…
docker --version
```

### æ­¥éª¤4: å®‰è£…Docker Compose

```bash
# ä¸‹è½½Docker Compose
curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…
docker-compose --version
```

### æ­¥éª¤5: å®‰è£…Mavenï¼ˆç”¨äºæ„å»ºåç«¯ï¼‰

```bash
# ä¸‹è½½Maven
cd /opt
wget https://archive.apache.org/dist/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz
tar -xzf apache-maven-3.8.6-bin.tar.gz
mv apache-maven-3.8.6 maven

# é…ç½®ç¯å¢ƒå˜é‡
echo 'export MAVEN_HOME=/opt/maven' >> /etc/profile
echo 'export PATH=$MAVEN_HOME/bin:$PATH' >> /etc/profile
source /etc/profile

# éªŒè¯å®‰è£…
mvn --version
```

### æ­¥éª¤6: å®‰è£…Node.jså’Œpnpmï¼ˆç”¨äºæ„å»ºå‰ç«¯ï¼‰

```bash
# å®‰è£…Node.js 16
curl -fsSL https://rpm.nodesource.com/setup_16.x | bash -
yum install -y nodejs

# æˆ–è€…ä½¿ç”¨nvmå®‰è£…
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 16
nvm use 16

# å®‰è£…pnpm
npm install -g pnpm

# éªŒè¯å®‰è£…
node --version
pnpm --version
```

### æ­¥éª¤7: åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
mkdir -p /opt/erp-system
cd /opt/erp-system
```

---

## é¡¹ç›®éƒ¨ç½²

### æ–¹å¼ä¸€ï¼šä½¿ç”¨Docker Composeéƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶

å°†é¡¹ç›®æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š

**æ–¹å¼A: ä½¿ç”¨Gitï¼ˆæ¨èï¼‰**

```bash
# åœ¨æœåŠ¡å™¨ä¸Šå…‹éš†é¡¹ç›®
cd /opt/erp-system
git clone ä½ çš„é¡¹ç›®ä»“åº“åœ°å€ .

# æˆ–è€…å¦‚æœé¡¹ç›®åœ¨æœ¬åœ°ï¼Œä½¿ç”¨scpä¸Šä¼ 
# åœ¨æœ¬åœ°æ‰§è¡Œï¼š
# scp -r /Users/xierui/Documents/Project/Other/erp-system root@æœåŠ¡å™¨IP:/opt/erp-system
```

**æ–¹å¼B: ä½¿ç”¨å‹ç¼©åŒ…**

```bash
# åœ¨æœ¬åœ°æ‰“åŒ…é¡¹ç›®ï¼ˆæ’é™¤node_modulesã€targetç­‰ï¼‰
# ä¸Šä¼ åˆ°æœåŠ¡å™¨åè§£å‹
cd /opt/erp-system
unzip erp-system.zip
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
cd /opt/erp-system/script/docker
cp .env.example .env  # å¦‚æœå­˜åœ¨ç¤ºä¾‹æ–‡ä»¶
# æˆ–è€…ç›´æ¥åˆ›å»º.envæ–‡ä»¶
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å†…å®¹ï¼š

```bash
# æ•°æ®åº“é…ç½®
MYSQL_DATABASE=ruoyi-vue-pro
MYSQL_ROOT_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç ï¼ˆè¯·ä¿®æ”¹ä¸ºå¼ºå¯†ç ï¼‰

# æ•°æ®æºé…ç½®
MASTER_DATASOURCE_URL=jdbc:mysql://mysql:3306/ruoyi-vue-pro?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&nullCatalogMeansCurrent=true
MASTER_DATASOURCE_USERNAME=root
MASTER_DATASOURCE_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 
SLAVE_DATASOURCE_URL=jdbc:mysql://mysql:3306/ruoyi-vue-pro?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&nullCatalogMeansCurrent=true
SLAVE_DATASOURCE_USERNAME=root
SLAVE_DATASOURCE_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 

# Redisé…ç½®
REDIS_HOST=redis

# Javaé…ç½®
JAVA_OPTS=-Xms1024m -Xmx2048m -Djava.security.egd=file:/dev/./urandom

# å‰ç«¯é…ç½®
NODE_ENV=production
PUBLIC_PATH=/
VUE_APP_TITLE=ERPç®¡ç†ç³»ç»Ÿ
VUE_APP_BASE_API=/prod-api
```

#### 3. æ„å»ºå’Œå¯åŠ¨æœåŠ¡

```bash
cd /opt/erp-system/script/docker

# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²ï¼ˆä¸ä½¿ç”¨Dockerï¼‰

#### 1. æ„å»ºåç«¯

```bash
cd /opt/erp-system

# æ„å»ºé¡¹ç›®
mvn clean package -DskipTests

# æ„å»ºå®Œæˆåï¼Œjaræ–‡ä»¶åœ¨ï¼š
# yudao-server/target/yudao-server.jar
```

#### 2. æ„å»ºå‰ç«¯

```bash
cd /opt/erp-system/original-yudao-ui

# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build:prod

# æ„å»ºå®Œæˆåï¼Œé™æ€æ–‡ä»¶åœ¨ dist ç›®å½•
```

#### 3. é…ç½®Nginx

```bash
# å®‰è£…Nginx
yum install -y nginx  # CentOS
# æˆ–
apt install -y nginx  # Ubuntu

# åˆ›å»ºNginxé…ç½®
cat > /etc/nginx/conf.d/erp-system.conf << 'EOF'
server {
    listen 80;
    server_name ä½ çš„åŸŸåæˆ–IP;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /opt/erp-system/original-yudao-ui/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # åç«¯APIä»£ç†
    location /prod-api {
        proxy_pass http://127.0.0.1:48080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
EOF

# å¯åŠ¨Nginx
systemctl start nginx
systemctl enable nginx
```

#### 4. å¯åŠ¨åç«¯æœåŠ¡

```bash
# åˆ›å»ºå¯åŠ¨è„šæœ¬
cat > /opt/erp-system/start-server.sh << 'EOF'
#!/bin/bash
cd /opt/erp-system/yudao-server/target
java -Xms1024m -Xmx2048m -jar yudao-server.jar \
  --spring.profiles.active=prod \
  --spring.datasource.dynamic.datasource.master.url=jdbc:mysql://127.0.0.1:3306/ruoyi-vue-pro?useSSL=false&serverTimezone=Asia/Shanghai \
  --spring.datasource.dynamic.datasource.master.username=root \
  --spring.datasource.dynamic.datasource.master.password=ä½ çš„æ•°æ®åº“å¯†ç  \
  --spring.redis.host=127.0.0.1 \
  --spring.redis.port=6379
EOF

chmod +x /opt/erp-system/start-server.sh

# ä½¿ç”¨systemdç®¡ç†æœåŠ¡
cat > /etc/systemd/system/erp-server.service << 'EOF'
[Unit]
Description=ERP System Backend Service
After=network.target mysql.service redis.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/erp-system/yudao-server/target
ExecStart=/usr/bin/java -Xms1024m -Xmx2048m -jar yudao-server.jar --spring.profiles.active=prod
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
systemctl daemon-reload
systemctl start erp-server
systemctl enable erp-server
```

---

## æ•°æ®åº“åˆå§‹åŒ–

### 1. å¦‚æœä½¿ç”¨Docker Compose

æ•°æ®åº“ä¼šè‡ªåŠ¨åˆå§‹åŒ–ï¼ŒSQLè„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚

### 2. æ‰‹åŠ¨åˆå§‹åŒ–æ•°æ®åº“

```bash
# è¿æ¥MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE `ruoyi-vue-pro` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# é€€å‡ºMySQL
exit

# å¯¼å…¥SQLè„šæœ¬
cd /opt/erp-system
mysql -u root -p ruoyi-vue-pro < sql/mysql/ruoyi-vue-pro.sql

# å¦‚æœæœ‰å¤šä¸ªSQLæ–‡ä»¶ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œ
# mysql -u root -p ruoyi-vue-pro < sql/mysql/01_xxx.sql
# mysql -u root -p ruoyi-vue-pro < sql/mysql/02_xxx.sql
```

---

## æœåŠ¡å¯åŠ¨ä¸éªŒè¯

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# Dockeræ–¹å¼
docker-compose ps

# æ‰‹åŠ¨éƒ¨ç½²æ–¹å¼
systemctl status erp-server
systemctl status nginx
systemctl status mysql
systemctl status redis
```

### 2. æŸ¥çœ‹æ—¥å¿—

```bash
# Dockeræ–¹å¼
docker-compose logs -f server  # åç«¯æ—¥å¿—
docker-compose logs -f admin   # å‰ç«¯æ—¥å¿—
docker-compose logs -f mysql  # æ•°æ®åº“æ—¥å¿—

# æ‰‹åŠ¨éƒ¨ç½²æ–¹å¼
journalctl -u erp-server -f   # åç«¯æ—¥å¿—
tail -f /var/log/nginx/access.log  # Nginxè®¿é—®æ—¥å¿—
```

### 3. éªŒè¯æœåŠ¡

**è®¿é—®å‰ç«¯ï¼š**
```
http://ä½ çš„æœåŠ¡å™¨IP
```

**è®¿é—®åç«¯APIï¼š**
```
http://ä½ çš„æœåŠ¡å™¨IP:48080
```

**è®¿é—®Swaggeræ–‡æ¡£ï¼š**
```
http://ä½ çš„æœåŠ¡å™¨IP:48080/swagger-ui/index.html
```

**é»˜è®¤ç™»å½•è´¦å·ï¼š**
- ç”¨æˆ·åï¼šadmin
- å¯†ç ï¼šadmin123

âš ï¸ **é‡è¦ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼**

---

## å¸¸è§é—®é¢˜

### 1. ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tlnp | grep 48080
# æˆ–
lsof -i:48080

# ä¿®æ”¹ç«¯å£ï¼ˆåœ¨docker-compose.ymlæˆ–application.yamlä¸­ï¼‰
```

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

- æ£€æŸ¥MySQLæ˜¯å¦å¯åŠ¨
- æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾3306ç«¯å£
- æ£€æŸ¥MySQLæ˜¯å¦å…è®¸è¿œç¨‹è¿æ¥

### 3. Redisè¿æ¥å¤±è´¥

- æ£€æŸ¥Redisæ˜¯å¦å¯åŠ¨
- æ£€æŸ¥Rediså¯†ç æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾6379ç«¯å£

### 4. å‰ç«¯æ— æ³•è®¿é—®åç«¯API

- æ£€æŸ¥Nginxé…ç½®ä¸­çš„proxy_passæ˜¯å¦æ­£ç¡®
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
- æ£€æŸ¥CORSé…ç½®

### 5. å†…å­˜ä¸è¶³

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# è°ƒæ•´JVMå‚æ•°ï¼ˆå‡å°‘å†…å­˜å ç”¨ï¼‰
# åœ¨docker-compose.ymlæˆ–å¯åŠ¨è„šæœ¬ä¸­ä¿®æ”¹JAVA_OPTS
JAVA_OPTS=-Xms512m -Xmx1024m
```

### 6. æ„å»ºå¤±è´¥

**Mavenæ„å»ºå¤±è´¥ï¼š**
```bash
# æ¸…ç†å¹¶é‡æ–°æ„å»º
mvn clean install -DskipTests

# å¦‚æœç½‘ç»œé—®é¢˜ï¼Œä½¿ç”¨å›½å†…é•œåƒ
# ç¼–è¾‘ ~/.m2/settings.xml
```

**å‰ç«¯æ„å»ºå¤±è´¥ï¼š**
```bash
# æ¸…ç†ç¼“å­˜
cd original-yudao-ui
rm -rf node_modules
pnpm install
pnpm build:prod
```

---

## å®‰å…¨å»ºè®®

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

- ä¿®æ”¹æ•°æ®åº“rootå¯†ç 
- ä¿®æ”¹ç³»ç»Ÿç®¡ç†å‘˜å¯†ç 
- ä¿®æ”¹Rediså¯†ç ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

### 2. é…ç½®é˜²ç«å¢™

```bash
# åªå¼€æ”¾å¿…è¦ç«¯å£
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=48080/tcp
firewall-cmd --reload

# æˆ–ä½¿ç”¨iptables
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 48080 -j ACCEPT
```

### 3. ä½¿ç”¨HTTPS

é…ç½®SSLè¯ä¹¦ï¼Œä½¿ç”¨HTTPSè®¿é—®ï¼š

```bash
# å®‰è£…Certbotï¼ˆLet's Encryptï¼‰
yum install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦
certbot --nginx -d ä½ çš„åŸŸå

# è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

### 4. å®šæœŸå¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /opt/erp-system/backup.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/opt/backups"
DATE=$(date +%Y%m%d_%H%M%S)

# å¤‡ä»½æ•°æ®åº“
mysqldump -u root -pä½ çš„å¯†ç  ruoyi-vue-pro > $BACKUP_DIR/db_$DATE.sql

# å¤‡ä»½ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
tar -czf $BACKUP_DIR/files_$DATE.tar.gz /opt/erp-system/uploads

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete
EOF

chmod +x /opt/erp-system/backup.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡
crontab -e
# æ·»åŠ ï¼š0 2 * * * /opt/erp-system/backup.sh
```

### 5. ç›‘æ§å’Œæ—¥å¿—

- é…ç½®æ—¥å¿—è½®è½¬
- è®¾ç½®ç³»ç»Ÿç›‘æ§ï¼ˆå¦‚Prometheus + Grafanaï¼‰
- å®šæœŸæ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°

### 6. æ›´æ–°å’Œç»´æŠ¤

```bash
# å®šæœŸæ›´æ–°ç³»ç»Ÿ
yum update -y  # CentOS
apt update && apt upgrade -y  # Ubuntu

# æ›´æ–°Dockeré•œåƒ
docker-compose pull
docker-compose up -d
```

---

## åç»­ä¼˜åŒ–

1. **æ€§èƒ½ä¼˜åŒ–**
   - é…ç½®Redisç¼“å­˜
   - ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•
   - é…ç½®CDNåŠ é€Ÿé™æ€èµ„æº

2. **é«˜å¯ç”¨éƒ¨ç½²**
   - ä½¿ç”¨è´Ÿè½½å‡è¡¡
   - æ•°æ®åº“ä¸»ä»å¤åˆ¶
   - Redisé›†ç¾¤

3. **ç›‘æ§å‘Šè­¦**
   - é…ç½®ç³»ç»Ÿç›‘æ§
   - è®¾ç½®å‘Šè­¦è§„åˆ™
   - æ—¥å¿—åˆ†æ

---

## æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ—¥å¿—æ–‡ä»¶
2. æœåŠ¡çŠ¶æ€
3. ç½‘ç»œè¿æ¥
4. é…ç½®æ–‡ä»¶

æ›´å¤šå¸®åŠ©è¯·å‚è€ƒé¡¹ç›®æ–‡æ¡£æˆ–æäº¤Issueã€‚

---

**éƒ¨ç½²å®Œæˆåï¼Œè¯·åŠ¡å¿…ï¼š**
1. âœ… ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
2. âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
3. âœ… å¯ç”¨HTTPS
4. âœ… è®¾ç½®å®šæœŸå¤‡ä»½
5. âœ… é…ç½®ç›‘æ§å‘Šè­¦

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰

