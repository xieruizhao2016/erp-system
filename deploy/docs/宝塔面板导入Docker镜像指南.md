# å®å¡”é¢æ¿å¯¼å…¥Dockeré•œåƒæŒ‡å—

## ğŸ“‹ éœ€è¦å¯¼å…¥çš„é•œåƒ

### åŸºç¡€é•œåƒï¼ˆå¿…éœ€ï¼‰
1. **mysql:8** - MySQLæ•°æ®åº“
2. **redis:6-alpine** - Redisç¼“å­˜
3. **eclipse-temurin:8-jre** - Javaè¿è¡Œç¯å¢ƒï¼ˆåç«¯éœ€è¦ï¼‰
4. **nginx:alpine** - Nginx WebæœåŠ¡å™¨ï¼ˆå‰ç«¯éœ€è¦ï¼‰

### åº”ç”¨é•œåƒï¼ˆæ„å»ºåç”Ÿæˆï¼‰
- **yudao-server:latest** - åç«¯æœåŠ¡ï¼ˆéœ€è¦æ„å»ºï¼‰
- **yudao-admin:latest** - å‰ç«¯æœåŠ¡ï¼ˆéœ€è¦æ„å»ºï¼‰

> ğŸ’¡ **æç¤ºï¼š** åº”ç”¨é•œåƒå»ºè®®åœ¨æœ¬åœ°æ„å»ºåä¸Šä¼ ï¼Œé€Ÿåº¦æ›´å¿«ã€‚è¯¦è§ [æœ¬åœ°æ„å»ºéƒ¨ç½²æŒ‡å—](./æœ¬åœ°æ„å»ºéƒ¨ç½²æŒ‡å—.md)

## ğŸ”§ æ–¹æ³•1ï¼šé€šè¿‡å®å¡”é¢æ¿å¯¼å…¥ï¼ˆæ¨èï¼‰

### æ­¥éª¤1ï¼šå‡†å¤‡é•œåƒæ–‡ä»¶

**é€‰é¡¹Aï¼šä»å…¶ä»–æœåŠ¡å™¨å¯¼å‡ºé•œåƒ**
```bash
# åœ¨æœ‰ç½‘ç»œçš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
docker pull mysql:8
docker pull redis:6-alpine
docker pull eclipse-temurin:8-jre
docker pull nginx:alpine

# å¯¼å‡ºé•œåƒ
docker save mysql:8 -o mysql-8.tar
docker save redis:6-alpine -o redis-6-alpine.tar
docker save eclipse-temurin:8-jre -o temurin-8-jre.tar
docker save nginx:alpine -o nginx-alpine.tar
```

**é€‰é¡¹Bï¼šä»æœ¬åœ°å¯¼å‡ºé•œåƒ**
å¦‚æœæœ‰æœ¬åœ°Dockerç¯å¢ƒï¼Œå¯ä»¥å¯¼å‡ºé•œåƒï¼š
```bash
docker save mysql:8 -o mysql-8.tar
docker save redis:6-alpine -o redis-6-alpine.tar
docker save eclipse-temurin:8-jre -o temurin-8-jre.tar
docker save nginx:alpine -o nginx-alpine.tar
```

### æ­¥éª¤2ï¼šä¸Šä¼ é•œåƒæ–‡ä»¶åˆ°æœåŠ¡å™¨

**ä½¿ç”¨SCPä¸Šä¼ ï¼š**
```bash
# ä»æœ¬åœ°ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp mysql-8.tar tengxunyun:/tmp/
scp redis-6-alpine.tar tengxunyun:/tmp/
scp temurin-8-jre.tar tengxunyun:/tmp/
scp nginx-alpine.tar tengxunyun:/tmp/
```

**æˆ–ä½¿ç”¨å®å¡”é¢æ¿æ–‡ä»¶ç®¡ç†ï¼š**
1. ç™»å½•å®å¡”é¢æ¿ï¼šhttps://101.33.244.240:13794/5343ca33
2. è¿›å…¥ **æ–‡ä»¶** â†’ **ä¸Šä¼ **
3. é€‰æ‹©é•œåƒæ–‡ä»¶ä¸Šä¼ åˆ° `/tmp/` ç›®å½•

### æ­¥éª¤3ï¼šåœ¨å®å¡”é¢æ¿å¯¼å…¥é•œåƒ

1. **ç™»å½•å®å¡”é¢æ¿**
   - åœ°å€ï¼šhttps://101.33.244.240:13794/5343ca33
   - ç”¨æˆ·åï¼š`skmlvi0t`
   - å¯†ç ï¼š`98c765f9`

2. **è¿›å…¥Dockerç®¡ç†**
   - ç‚¹å‡»å·¦ä¾§èœå• **Docker**
   - é€‰æ‹© **é•œåƒç®¡ç†**

3. **å¯¼å…¥é•œåƒ**
   - ç‚¹å‡» **å¯¼å…¥é•œåƒ** æŒ‰é’®
   - åœ¨ **è·¯å¾„** è¾“å…¥æ¡†ä¸­å¡«å†™é•œåƒæ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚ï¼š
     - `/tmp/mysql-8.tar`
     - `/tmp/redis-6-alpine.tar`
     - `/tmp/temurin-8-jre.tar`
     - `/tmp/nginx-alpine.tar`
   - ç‚¹å‡» **å¯¼å…¥** æŒ‰é’®
   - ç­‰å¾…å¯¼å…¥å®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰

4. **éªŒè¯å¯¼å…¥**
   - å¯¼å…¥å®Œæˆåï¼Œåœ¨é•œåƒåˆ—è¡¨ä¸­åº”è¯¥èƒ½çœ‹åˆ°å¯¼å…¥çš„é•œåƒ
   - æˆ–ä½¿ç”¨SSHå‘½ä»¤éªŒè¯ï¼š
     ```bash
     ssh tengxunyun
     docker images
     ```

## ğŸ”§ æ–¹æ³•2ï¼šä½¿ç”¨SSHå‘½ä»¤è¡Œå¯¼å…¥ï¼ˆæ›´å¿«ï¼‰

å¦‚æœé•œåƒæ–‡ä»¶å·²ç»ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨SSHå‘½ä»¤ç›´æ¥å¯¼å…¥ï¼š

```bash
# è¿æ¥åˆ°æœåŠ¡å™¨
ssh tengxunyun

# å¯¼å…¥é•œåƒ
cd /tmp
docker load < mysql-8.tar
docker load < redis-6-alpine.tar
docker load < temurin-8-jre.tar
docker load < nginx-alpine.tar

# éªŒè¯å¯¼å…¥
docker images
```

## ğŸ”§ æ–¹æ³•3ï¼šä½¿ç”¨å®å¡”é¢æ¿çš„é•œåƒæ‹‰å–åŠŸèƒ½

å¦‚æœç½‘ç»œé—®é¢˜å·²è§£å†³ï¼Œå¯ä»¥å°è¯•ï¼š

1. è¿›å…¥å®å¡”é¢æ¿ â†’ **Docker** â†’ **é•œåƒç®¡ç†**
2. ç‚¹å‡» **é•œåƒæ‹‰å–**
3. è¾“å…¥é•œåƒåç§°ï¼š
   - `mysql:8`
   - `redis:6-alpine`
   - `eclipse-temurin:8-jre`
   - `nginx:alpine`
4. ç‚¹å‡» **æ‹‰å–**

âš ï¸ **æ³¨æ„ï¼š** å¦‚æœç½‘ç»œé—®é¢˜æœªè§£å†³ï¼Œæ­¤æ–¹æ³•å¯èƒ½ä»ç„¶å¤±è´¥ã€‚

## âœ… å¯¼å…¥å®Œæˆåçš„éªŒè¯

```bash
# SSHè¿æ¥åˆ°æœåŠ¡å™¨
ssh tengxunyun

# æ£€æŸ¥é•œåƒ
docker images | grep -E 'mysql|redis|temurin|nginx'
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
mysql                   8              ...    ...    ...
redis                   6-alpine       ...    ...    ...
eclipse-temurin         8-jre          ...    ...    ...
nginx                   alpine         ...    ...    ...
```

## ğŸ“ å¯¼å…¥åº”ç”¨é•œåƒ

### æ–¹æ³•1ï¼šæœ¬åœ°æ„å»ºåä¸Šä¼ ï¼ˆæ¨èï¼‰

å¦‚æœå·²åœ¨æœ¬åœ°æ„å»ºå¥½åº”ç”¨é•œåƒï¼Œå¯ä»¥å¯¼å‡ºå¹¶ä¸Šä¼ ï¼š

```bash
# åœ¨æœ¬åœ°æ‰§è¡Œ
cd /path/to/erp-system

# 1. æ„å»ºé•œåƒï¼ˆå¦‚æœè¿˜æ²¡æ„å»ºï¼‰
./deploy/scripts/build-images-local.sh

# 2. å¯¼å‡ºé•œåƒ
./deploy/scripts/export-app-images.sh

# 3. ä¸Šä¼ å¹¶å¯¼å…¥åˆ°æœåŠ¡å™¨
./deploy/scripts/upload-app-images.sh
```

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒï¼š[æœ¬åœ°æ„å»ºéƒ¨ç½²æŒ‡å—](./æœ¬åœ°æ„å»ºéƒ¨ç½²æŒ‡å—.md)

### æ–¹æ³•2ï¼šæ‰‹åŠ¨å¯¼å…¥åº”ç”¨é•œåƒ

å¦‚æœå·²æœ‰åº”ç”¨é•œåƒæ–‡ä»¶ï¼ˆ.tar æˆ– .tar.gzï¼‰ï¼š

**ä½¿ç”¨å®å¡”é¢æ¿å¯¼å…¥ï¼š**
1. ä¸Šä¼ é•œåƒæ–‡ä»¶åˆ° `/tmp/` ç›®å½•
2. è¿›å…¥ **Docker** â†’ **é•œåƒç®¡ç†** â†’ **å¯¼å…¥é•œåƒ**
3. è¾“å…¥è·¯å¾„ï¼š`/tmp/app-images-*.tar.gz`ï¼ˆå¦‚æœæ˜¯å‹ç¼©æ–‡ä»¶ï¼Œéœ€è¦å…ˆè§£å‹ï¼‰
4. ç‚¹å‡» **å¯¼å…¥**

**ä½¿ç”¨SSHå‘½ä»¤å¯¼å…¥ï¼š**
```bash
# å¦‚æœæ˜¯å‹ç¼©æ–‡ä»¶ï¼Œå…ˆè§£å‹
gunzip -c /tmp/app-images-*.tar.gz | docker load

# å¦‚æœæ˜¯æ™®é€štaræ–‡ä»¶
docker load < /tmp/app-images-*.tar

# éªŒè¯å¯¼å…¥
docker images | grep -E "yudao-server|yudao-admin"
```

### æ–¹æ³•3ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ„å»ºï¼ˆè¾ƒæ…¢ï¼‰

å¦‚æœéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šæ„å»ºåº”ç”¨é•œåƒï¼š

```bash
cd /opt/erp-system/script/docker

# æ„å»ºåº”ç”¨é•œåƒ
docker-compose -f docker-compose.prod.yml --env-file .env build server admin

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml --env-file .env up -d

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps
```

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: å¯¼å…¥é•œåƒæ—¶æç¤º"æ–‡ä»¶ä¸å­˜åœ¨"
**è§£å†³ï¼š** æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æ–‡ä»¶å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨

### Q2: å¯¼å…¥é•œåƒæ—¶æç¤º"æƒé™ä¸è¶³"
**è§£å†³ï¼š** ç¡®ä¿é•œåƒæ–‡ä»¶æœ‰è¯»å–æƒé™ï¼š
```bash
chmod 644 /tmp/*.tar
```

### Q3: å¯¼å…¥é•œåƒæ—¶æç¤º"ç©ºé—´ä¸è¶³"
**è§£å†³ï¼š** æ£€æŸ¥ç£ç›˜ç©ºé—´ï¼š
```bash
df -h
```
å¦‚æœç©ºé—´ä¸è¶³ï¼Œæ¸…ç†ä¸éœ€è¦çš„æ–‡ä»¶æˆ–æ‰©å±•ç£ç›˜

### Q4: å¦‚ä½•æ‰¹é‡å¯¼å…¥å¤šä¸ªé•œåƒï¼Ÿ
**è§£å†³ï¼š** ä½¿ç”¨SSHå‘½ä»¤æ‰¹é‡å¯¼å…¥ï¼š
```bash
for img in mysql-8.tar redis-6-alpine.tar temurin-8-jre.tar nginx-alpine.tar; do
    docker load < /tmp/$img
done
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æœ¬åœ°æ„å»ºéƒ¨ç½²æŒ‡å—](./æœ¬åœ°æ„å»ºéƒ¨ç½²æŒ‡å—.md) â­ æ¨èï¼šæœ¬åœ°æ„å»ºåº”ç”¨é•œåƒ
- [å¿«é€Ÿéƒ¨ç½²æŒ‡å—](../å¿«é€Ÿéƒ¨ç½².md)
- [è…¾è®¯äº‘æœåŠ¡å™¨éƒ¨ç½²çŠ¶æ€](./è…¾è®¯äº‘æœåŠ¡å™¨éƒ¨ç½²çŠ¶æ€.md)
- [è…¾è®¯äº‘æœåŠ¡å™¨è¿æ¥æŒ‡å—](./è…¾è®¯äº‘æœåŠ¡å™¨è¿æ¥æŒ‡å—.md)
- [å®å¡”é¢æ¿ç™»å½•ä¿¡æ¯](./å®å¡”é¢æ¿ç™»å½•ä¿¡æ¯.md)

---

**æç¤ºï¼š** å¦‚æœæ— æ³•è·å–é•œåƒæ–‡ä»¶ï¼Œå¯ä»¥è€ƒè™‘ï¼š
1. ä½¿ç”¨VPN/ä»£ç†è§£å†³ç½‘ç»œé—®é¢˜
2. ä»å…¶ä»–æœ‰ç½‘ç»œçš„æœåŠ¡å™¨å¯¼å‡ºé•œåƒ
3. è”ç³»æœåŠ¡å™¨æä¾›å•†æ£€æŸ¥ç½‘ç»œé…ç½®

