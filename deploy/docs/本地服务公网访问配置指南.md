# 本地服务公网访问配置指南

## 📋 当前状态

✅ **服务监听状态**：
- 前端服务：已监听 `0.0.0.0:5173`（所有网络接口）
- 后端服务：已监听 `*:48080`（所有网络接口）

✅ **局域网访问**：
- 前端：`http://192.168.1.183:5173`
- 后端：`http://192.168.1.183:48080`

## 🌐 公网访问方案

### 方案1：路由器端口转发（推荐，适合固定IP）

**适用场景**：有固定公网IP或动态公网IP

**步骤**：

1. **获取公网IP**
   ```bash
   curl ifconfig.me
   # 或访问：https://www.ip138.com/
   ```

2. **配置路由器端口转发**
   - 登录路由器管理界面（通常是 `192.168.1.1`）
   - 找到"端口转发"或"虚拟服务器"功能
   - 添加规则：
     - 前端：外部端口 `5173` → 内部 `192.168.1.183:5173`
     - 后端：外部端口 `48080` → 内部 `192.168.1.183:48080`

3. **配置防火墙**
   ```bash
   # macOS 防火墙设置（系统偏好设置 → 安全性与隐私 → 防火墙）
   # 或使用命令行：
   sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/local/opt/openjdk@8/bin/java
   sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/local/bin/node
   ```

4. **访问地址**
   - 前端：`http://你的公网IP:5173`
   - 后端：`http://你的公网IP:48080`

**⚠️ 注意事项**：
- 动态IP需要使用DDNS服务
- 确保路由器支持端口转发
- 运营商可能封禁80/443等常用端口

---

### 方案2：内网穿透工具（推荐，简单快速）

#### 2.1 使用 ngrok（最简单）

**步骤**：

1. **注册并安装 ngrok**
   ```bash
   # 访问 https://ngrok.com/ 注册账号
   # 下载并安装
   brew install ngrok/ngrok/ngrok
   # 或直接下载：https://ngrok.com/download
   ```

2. **配置认证令牌**
   ```bash
   ngrok config add-authtoken 你的token
   ```

3. **启动隧道**
   ```bash
   # 前端服务
   ngrok http 5173
   
   # 后端服务（新开终端）
   ngrok http 48080
   ```

4. **获取公网地址**
   - ngrok 会提供类似 `https://xxxx.ngrok.io` 的地址
   - 免费版每次重启地址会变化

**优点**：
- ✅ 简单易用，5分钟搞定
- ✅ 自动HTTPS
- ✅ 无需配置路由器

**缺点**：
- ❌ 免费版地址会变化
- ❌ 有流量限制

---

#### 2.2 使用 frp（自建，稳定）

**步骤**：

1. **准备一台有公网IP的服务器**

2. **在服务器上部署 frp 服务端**
   ```bash
   # 下载 frp
   wget https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_amd64.tar.gz
   tar -xzf frp_0.52.3_linux_amd64.tar.gz
   
   # 配置 frps.ini
   [common]
   bind_port = 7000
   ```

3. **在本地配置 frp 客户端**
   ```bash
   # 下载 frp 客户端（macOS版本）
   # 配置 frpc.ini
   [common]
   server_addr = 你的服务器IP
   server_port = 7000
   
   [web_frontend]
   type = tcp
   local_ip = 127.0.0.1
   local_port = 5173
   remote_port = 5173
   
   [web_backend]
   type = tcp
   local_ip = 127.0.0.1
   local_port = 48080
   remote_port = 48080
   ```

**优点**：
- ✅ 稳定可控
- ✅ 地址固定
- ✅ 无流量限制

---

### 方案3：云服务器部署（生产环境推荐）

如果需要在生产环境使用，建议直接在云服务器上部署：

1. **使用项目提供的部署脚本**
   ```bash
   cd deploy
   # 参考部署文档
   ```

2. **或使用 Docker Compose**
   ```bash
   cd script/docker
   docker-compose up -d
   ```

---

## 🔒 安全建议

### ⚠️ 重要安全措施

1. **修改默认密码**
   - 数据库密码（当前：`123456`）
   - Redis 密码（如果启用）
   - 系统管理员密码

2. **启用 HTTPS**
   - 使用 nginx 反向代理 + Let's Encrypt 证书
   - 或使用内网穿透工具的 HTTPS 功能

3. **配置防火墙规则**
   ```bash
   # 只允许特定IP访问（如果可能）
   # 限制访问频率
   ```

4. **定期更新**
   - 系统补丁
   - 依赖包版本
   - 安全漏洞修复

5. **访问控制**
   - 使用强密码
   - 启用验证码
   - 配置IP白名单（如果可能）

---

## 🧪 测试公网访问

### 1. 测试内网访问（先确认服务正常）

```bash
# 在同一局域网的其他设备上访问
# 前端
curl http://192.168.1.183:5173

# 后端
curl http://192.168.1.183:48080/admin-api/system/auth/get-permission-info
```

### 2. 测试公网访问

```bash
# 使用手机4G网络或让朋友帮忙测试
# 访问：http://你的公网IP:5173
```

---

## 📝 快速检查清单

- [ ] 服务已启动并监听 `0.0.0.0`
- [ ] 防火墙已配置允许端口
- [ ] 路由器端口转发已配置（如使用方案1）
- [ ] 公网IP已获取
- [ ] 安全措施已实施
- [ ] 已测试内网访问
- [ ] 已测试公网访问

---

## 🆘 常见问题

### Q1: 无法从外网访问？

**检查项**：
1. 确认服务监听在 `0.0.0.0` 而不是 `127.0.0.1`
2. 检查防火墙是否允许端口
3. 检查路由器端口转发是否正确
4. 确认运营商是否封禁端口

### Q2: 端口被占用？

```bash
# 检查端口占用
lsof -i :5173
lsof -i :48080

# 修改端口（前端）
# 编辑 original-yudao-ui/.env.local
VITE_PORT=8080

# 修改端口（后端）
# 编辑 yudao-server/src/main/resources/application-local.yaml
server:
  port: 8080
```

### Q3: 动态IP怎么办？

使用 DDNS 服务：
- 花生壳（Oray）
- 阿里云DDNS
- 腾讯云DNSPod

---

## 📚 相关文档

- [本地构建部署指南](./本地构建部署指南.md)
- [快速启动指南](../../docs/快速启动指南.md)
- [服务器部署文档](./腾讯云服务器部署完成.md)




