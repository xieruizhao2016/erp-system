# 火山引擎云服务器配置指南

## 📋 目录
1. [购买云服务器](#购买云服务器)
2. [基础配置](#基础配置)
3. [安全组配置](#安全组配置)
4. [SSH连接配置](#ssh连接配置)
5. [系统初始化](#系统初始化)
6. [验证配置](#验证配置)

---

## 🛒 购买云服务器

### 步骤1: 登录火山引擎控制台

1. 访问火山引擎官网：https://www.volcengine.com/
2. 登录你的账号（如果没有账号，需要先注册）
3. 进入控制台：https://console.volcengine.com/

### 步骤2: 选择云服务器产品

1. 在控制台首页，找到 **"云服务器 ECS"** 或 **"弹性计算"** 产品
2. 点击进入云服务器管理页面
3. 点击 **"创建实例"** 或 **"购买实例"** 按钮

### 步骤3: 选择配置

#### 基础配置

**地域和可用区：**
- 选择离你最近的地域（如：华北2-北京）
- 可用区选择默认即可

**实例规格：**
- **最低配置（测试/小规模使用）：**
  - CPU: 2核
  - 内存: 4GB
  - 实例类型: 通用型 g1
  
- **推荐配置（生产环境）：**
  - CPU: 4核
  - 内存: 8GB
  - 实例类型: 通用型 g1 或 计算型 c1

**镜像选择：**
- **推荐：Ubuntu 20.04 LTS** 或 **Ubuntu 22.04 LTS**
- 备选：CentOS 7.9 或 CentOS 8.x
- 选择公共镜像，确保系统稳定

**系统盘：**
- 类型：SSD云盘
- 容量：**至少40GB**（推荐100GB）
- 性能等级：标准型或高性能型

**数据盘（可选）：**
- 如果需要存储大量数据，可以添加数据盘
- 建议：100GB SSD云盘

### 步骤4: 网络配置

**网络：**
- 选择默认VPC或创建新的VPC
- 子网选择默认子网

**公网IP：**
- ✅ **必须勾选"分配公网IPv4地址"**
- 带宽计费方式：
  - **按流量计费**（推荐，适合流量不固定的场景）
  - 按固定带宽计费（适合流量稳定的场景）
- 带宽大小：**至少5Mbps**（推荐10Mbps）

**安全组：**
- 选择默认安全组或创建新的安全组
- ⚠️ **重要：稍后需要配置安全组规则**

### 步骤5: 登录凭证

**登录方式：**
- **推荐：SSH密钥对**
  - 如果已有密钥对，选择现有密钥对
  - 如果没有，点击"创建新密钥对"
  - 下载私钥文件（.pem格式），妥善保管

- **备选：密码**
  - 设置root密码（至少8位，包含大小写字母、数字、特殊字符）
  - 记录密码，妥善保管

### 步骤6: 高级配置（可选）

**实例名称：**
- 设置一个有意义的名称，如：`erp-system-prod`

**标签：**
- 可以添加标签便于管理

**购买时长：**
- 按需计费（推荐，灵活）
- 包年包月（有优惠，适合长期使用）

### 步骤7: 确认并创建

1. 检查所有配置
2. 确认费用
3. 勾选服务协议
4. 点击 **"立即购买"** 或 **"创建实例"**

### 步骤8: 等待创建完成

- 通常1-3分钟即可创建完成
- 在实例列表中查看状态，显示"运行中"即表示创建成功

---

## 🔧 基础配置

### 获取服务器信息

创建完成后，在实例列表中可以看到：

1. **公网IP地址**：用于SSH连接和访问服务
   - 例如：`123.456.789.012`
   - ⚠️ **记录此IP地址，后续部署需要使用**

2. **内网IP地址**：用于内网通信

3. **实例ID**：用于管理实例

### 查看实例详情

点击实例名称，进入详情页，可以查看：
- 配置信息
- 网络信息
- 磁盘信息
- 监控信息

---

## 🔒 安全组配置

安全组相当于防火墙，需要配置规则允许访问。

### 步骤1: 进入安全组配置

1. 在实例详情页，找到 **"安全组"** 标签
2. 点击安全组名称进入安全组管理页面
3. 或直接在控制台找到 **"安全组"** 菜单

### 步骤2: 添加入站规则

点击 **"添加规则"** 或 **"入站规则"**，添加以下规则：

#### 规则1: SSH访问（22端口）

```
规则名称: SSH
协议: TCP
端口范围: 22
源地址: 0.0.0.0/0  (或限制为你的IP地址，更安全)
动作: 允许
优先级: 1
```

⚠️ **安全建议：** 如果可能，将源地址限制为你的固定IP，而不是 `0.0.0.0/0`

#### 规则2: HTTP访问（80端口）

```
规则名称: HTTP
协议: TCP
端口范围: 80
源地址: 0.0.0.0/0
动作: 允许
优先级: 1
```

#### 规则3: 后端API访问（48080端口）

```
规则名称: Backend-API
协议: TCP
端口范围: 48080
源地址: 0.0.0.0/0  (生产环境建议限制IP)
动作: 允许
优先级: 1
```

#### 规则4: MySQL（3306端口，可选）

如果使用外部MySQL，需要开放此端口：
```
规则名称: MySQL
协议: TCP
端口范围: 3306
源地址: 0.0.0.0/0  (生产环境必须限制IP)
动作: 允许
优先级: 1
```

⚠️ **生产环境强烈建议限制MySQL端口只允许特定IP访问**

#### 规则5: Redis（6379端口，可选）

如果使用外部Redis，需要开放此端口：
```
规则名称: Redis
协议: TCP
端口范围: 6379
源地址: 0.0.0.0/0  (生产环境必须限制IP)
动作: 允许
优先级: 1
```

⚠️ **生产环境强烈建议限制Redis端口只允许特定IP访问**

### 步骤3: 保存规则

添加完所有规则后，点击 **"确定"** 或 **"保存"**

---

## 🔐 SSH连接配置

### 方式1: 使用SSH密钥对连接（推荐）

#### Windows系统

**使用PuTTY：**

1. 下载并安装PuTTY：https://www.putty.org/
2. 下载PuTTYgen：https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html

3. **转换密钥格式：**
   - 打开PuTTYgen
   - 点击 "Load"，选择下载的 `.pem` 文件
   - 选择 "All Files (*.*)"
   - 点击 "Save private key"，保存为 `.ppk` 格式

4. **连接服务器：**
   - 打开PuTTY
   - Host Name: `root@你的公网IP`
   - Port: `22`
   - Connection type: `SSH`
   - 在左侧菜单选择：Connection > SSH > Auth > Credentials
   - 点击 "Browse"，选择转换后的 `.ppk` 文件
   - 点击 "Open" 连接

**使用Windows Terminal（Windows 10/11）：**

```powershell
# 设置密钥权限
icacls "C:\path\to\your-key.pem" /inheritance:r
icacls "C:\path\to\your-key.pem" /grant:r "%username%:R"

# 连接服务器
ssh -i "C:\path\to\your-key.pem" root@你的公网IP
```

**使用Git Bash：**

```bash
# 设置密钥权限
chmod 400 /c/path/to/your-key.pem

# 连接服务器
ssh -i /c/path/to/your-key.pem root@你的公网IP
```

#### macOS/Linux系统

```bash
# 1. 设置密钥权限（重要！）
chmod 400 ~/path/to/your-key.pem

# 2. 连接服务器
ssh -i ~/path/to/your-key.pem root@你的公网IP

# 3. 如果是首次连接，会提示确认，输入 yes
```

**配置SSH别名（可选，方便后续连接）：**

编辑 `~/.ssh/config` 文件：

```bash
Host erp-server
    HostName 你的公网IP
    User root
    IdentityFile ~/path/to/your-key.pem
    ServerAliveInterval 60
    ServerAliveCountMax 3
```

然后就可以直接使用：
```bash
ssh erp-server
```

### 方式2: 使用密码连接

```bash
ssh root@你的公网IP
# 输入设置的root密码
```

---

## 🚀 系统初始化

### 步骤1: 更新系统

连接服务器后，首先更新系统：

**Ubuntu/Debian：**
```bash
# 更新软件包列表
apt update

# 升级系统
apt upgrade -y

# 安装常用工具
apt install -y curl wget vim git net-tools
```

**CentOS/RHEL：**
```bash
# 更新软件包
yum update -y

# 安装常用工具
yum install -y curl wget vim git net-tools
```

### 步骤2: 配置时区

```bash
# 设置时区为上海（UTC+8）
timedatectl set-timezone Asia/Shanghai

# 验证时区
timedatectl
```

### 步骤3: 配置主机名（可选）

```bash
# 设置主机名
hostnamectl set-hostname erp-server

# 验证
hostname
```

### 步骤4: 创建非root用户（可选，推荐）

```bash
# 创建新用户
adduser deploy

# 添加到sudo组
usermod -aG sudo deploy  # Ubuntu/Debian
usermod -aG wheel deploy  # CentOS

# 切换到新用户
su - deploy
```

### 步骤5: 配置SSH安全（可选，推荐）

编辑SSH配置文件：
```bash
vim /etc/ssh/sshd_config
```

建议修改的配置：
```
# 禁用root密码登录（如果使用密钥）
PermitRootLogin prohibit-password

# 禁用密码登录（如果只使用密钥）
PasswordAuthentication no

# 更改SSH端口（可选，提高安全性）
Port 2222
```

重启SSH服务：
```bash
systemctl restart sshd
```

---

## ✅ 验证配置

### 1. 验证网络连接

```bash
# 检查公网IP
curl ifconfig.me

# 检查网络连通性
ping -c 4 8.8.8.8

# 检查DNS解析
nslookup www.baidu.com
```

### 2. 验证端口开放

在本地机器上测试：

```bash
# 测试SSH端口
telnet 你的公网IP 22
# 或
nc -zv 你的公网IP 22

# 测试80端口（部署后）
nc -zv 你的公网IP 80

# 测试48080端口（部署后）
nc -zv 你的公网IP 48080
```

### 3. 验证系统信息

```bash
# 查看系统信息
uname -a

# 查看CPU信息
lscpu

# 查看内存信息
free -h

# 查看磁盘信息
df -h

# 查看系统负载
uptime
```

### 4. 验证防火墙（如果系统有防火墙）

**Ubuntu (ufw):**
```bash
# 查看状态
ufw status

# 如果防火墙开启，需要开放端口
ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 48080/tcp
```

**CentOS (firewalld):**
```bash
# 查看状态
firewall-cmd --state

# 如果防火墙开启，需要开放端口
firewall-cmd --permanent --add-port=22/tcp
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=48080/tcp
firewall-cmd --reload
```

---

## 📝 配置检查清单

完成服务器配置后，请确认：

- [ ] 服务器已创建并运行
- [ ] 公网IP地址已记录
- [ ] SSH可以正常连接
- [ ] 安全组规则已配置（22、80、48080端口）
- [ ] 系统已更新
- [ ] 时区已设置为 Asia/Shanghai
- [ ] 系统资源充足（CPU、内存、磁盘）

---

## 🔗 下一步

服务器配置完成后，可以开始部署ERP系统：

1. 参考 [快速部署指南](../快速部署.md)
2. 运行环境准备脚本：`./deploy/scripts/quick-deploy.sh`
3. 配置环境变量
4. 运行部署脚本：`./deploy/scripts/deploy-volcano.sh`

---

## 🆘 常见问题

### Q1: 无法SSH连接服务器

**可能原因：**
- 安全组未开放22端口
- 服务器未启动
- IP地址错误
- 密钥权限不正确

**解决方法：**
1. 检查安全组规则
2. 检查服务器状态
3. 确认IP地址正确
4. 检查密钥文件权限（chmod 400）

### Q2: 连接后立即断开

**可能原因：**
- 网络不稳定
- 服务器资源不足

**解决方法：**
1. 检查网络连接
2. 检查服务器资源使用情况
3. 配置SSH保活：在 `~/.ssh/config` 中添加：
   ```
   ServerAliveInterval 60
   ServerAliveCountMax 3
   ```

### Q3: 忘记root密码

**解决方法：**
1. 在火山引擎控制台，找到实例
2. 点击"更多" > "重置密码"
3. 设置新密码
4. 重启实例

### Q4: 如何查看服务器监控信息

在火山引擎控制台：
1. 进入实例详情页
2. 查看"监控"标签
3. 可以查看CPU、内存、网络、磁盘使用情况

---

## 📞 获取帮助

- 火山引擎官方文档：https://www.volcengine.com/docs/
- 火山引擎技术支持：在控制台提交工单
- 项目部署问题：查看 [部署指南](./火山引擎部署指南.md)

---

**配置完成后，就可以开始部署ERP系统了！** 🎉

