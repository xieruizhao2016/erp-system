# èœå•æ˜¾ç¤ºé—®é¢˜å®Œæ•´æ’æŸ¥æŒ‡å—

## ğŸ“‹ é—®é¢˜æè¿°

å‰ç«¯èœå•æ²¡æœ‰æ˜¾ç¤ºæœ€æ–°çš„åŠŸèƒ½ï¼ˆå¦‚è´¢åŠ¡ç®¡ç†æ¨¡å—ï¼‰ï¼Œè™½ç„¶åç«¯APIæ­£å¸¸è¿”å›äº†èœå•æ•°æ®ã€‚

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ç»„ä»¶åç§°ä¿®å¤
- **ä»˜æ¬¾å•**: `ErpPurchaseOrder` â†’ `ErpFinancePayment` âœ…
- **æ”¶æ¬¾å•**: `ErpPurchaseOrder` â†’ `ErpFinanceReceipt` âœ…
- **ç»“ç®—è´¦æˆ·**: `ErpAccount` âœ… (æ— éœ€ä¿®æ”¹)

### 2. è·¯ç”±ç”Ÿæˆé”™è¯¯å¤„ç†
- æ·»åŠ äº†ç»„ä»¶æŸ¥æ‰¾å¤±è´¥çš„é”™è¯¯å¤„ç†
- æ·»åŠ äº†æ§åˆ¶å°è°ƒè¯•æ—¥å¿—
- è¿‡æ»¤æ‰ null å€¼ï¼Œé¿å…è·¯ç”±æ³¨å†Œå¤±è´¥

### 3. å‰ç«¯æ–‡ä»¶æ›´æ–°
- å·²é‡æ–°æ„å»ºå¹¶éƒ¨ç½²åˆ°æœåŠ¡å™¨
- åŒ…å«è°ƒè¯•æ—¥å¿—å’Œé”™è¯¯å¤„ç†

## ğŸ” æ’æŸ¥æ­¥éª¤

### æ­¥éª¤1: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆé‡è¦ï¼ï¼‰

**æ–¹æ³•A: ä½¿ç”¨æµè§ˆå™¨æ¸…é™¤ç¼“å­˜åŠŸèƒ½**
1. æŒ‰ `Ctrl+Shift+Delete` (Windows) æˆ– `Cmd+Shift+Delete` (Mac)
2. é€‰æ‹©"ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶"
3. æ—¶é—´èŒƒå›´é€‰æ‹©"å…¨éƒ¨æ—¶é—´"
4. ç‚¹å‡»"æ¸…é™¤æ•°æ®"
5. åˆ·æ–°é¡µé¢

**æ–¹æ³•B: ä½¿ç”¨å¼€å‘è€…å·¥å…·**
1. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° `Application` æ ‡ç­¾ï¼ˆChromeï¼‰æˆ– `å­˜å‚¨` æ ‡ç­¾ï¼ˆFirefoxï¼‰
3. å·¦ä¾§æ‰¾åˆ° `Local Storage`
4. æ‰¾åˆ°ç½‘ç«™åŸŸåï¼Œå³é”®é€‰æ‹©"æ¸…é™¤"
5. åŒæ ·æ¸…é™¤ `Session Storage`
6. åˆ·æ–°é¡µé¢

**æ–¹æ³•C: ä½¿ç”¨æ— ç—•æ¨¡å¼**
1. æŒ‰ `Ctrl+Shift+N` (Chrome) æˆ– `Ctrl+Shift+P` (Firefox)
2. è®¿é—®: http://101.33.244.240
3. ç™»å½•æµ‹è¯•

### æ­¥éª¤2: æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

1. **æ‰“å¼€å¼€å‘è€…å·¥å…·**
   - æŒ‰ `F12`
   - åˆ‡æ¢åˆ° `Console` æ ‡ç­¾

2. **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**
   - æŸ¥æ‰¾ `[è·¯ç”±ç”Ÿæˆ]` ç›¸å…³çš„é”™è¯¯
   - æŸ¥æ‰¾ç»„ä»¶æ‰¾ä¸åˆ°çš„è­¦å‘Š
   - æŸ¥çœ‹æ˜¯å¦æœ‰ JavaScript é”™è¯¯

3. **æ£€æŸ¥è·¯ç”±ç”Ÿæˆ**
   åœ¨ Console ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
   ```javascript
   // æ£€æŸ¥è·¯ç”±æ˜¯å¦æ³¨å†Œ
   console.log(router.getRoutes().filter(r => r.path.includes('finance')))
   
   // æ£€æŸ¥èœå•æ•°æ®
   console.log(JSON.parse(localStorage.getItem('ROLE_ROUTERS') || '[]'))
   ```

### æ­¥éª¤3: æ£€æŸ¥ç½‘ç»œè¯·æ±‚

1. **æ‰“å¼€ Network æ ‡ç­¾**
   - æŒ‰ `F12` â†’ `Network` æ ‡ç­¾
   - åˆ·æ–°é¡µé¢

2. **æ£€æŸ¥èœå•APIè¯·æ±‚**
   - æ‰¾åˆ° `get-permission-info` è¯·æ±‚
   - æŸ¥çœ‹ `Status` æ˜¯å¦ä¸º `200`
   - ç‚¹å‡»è¯·æ±‚ï¼ŒæŸ¥çœ‹ `Response` æ ‡ç­¾
   - ç¡®è®¤èœå•æ•°æ®ä¸­æ˜¯å¦åŒ…å«"è´¢åŠ¡ç®¡ç†"åŠå…¶å­èœå•

3. **æ£€æŸ¥èœå•æ•°æ®ç»“æ„**
   ç¡®è®¤è¿”å›çš„æ•°æ®æ ¼å¼ï¼š
   ```json
   {
     "id": 2645,
     "name": "è´¢åŠ¡ç®¡ç†",
     "path": "finance",
     "component": "",
     "componentName": "",
     "visible": true,
     "children": [
       {
         "id": 2687,
         "name": "ä»˜æ¬¾å•",
         "path": "payment",
         "component": "erp/finance/payment/index",
         "componentName": "ErpFinancePayment",
         "visible": true
       }
     ]
   }
   ```

### æ­¥éª¤4: æ£€æŸ¥è·¯ç”±æ³¨å†Œ

åœ¨æµè§ˆå™¨ Console ä¸­æ‰§è¡Œï¼š

```javascript
// 1. è·å–æ‰€æœ‰è·¯ç”±
const routes = router.getRoutes()
console.log('æ‰€æœ‰è·¯ç”±:', routes)

// 2. æŸ¥æ‰¾ finance ç›¸å…³è·¯ç”±
const financeRoutes = routes.filter(r => 
  r.path.includes('finance') || 
  r.name?.includes('Finance') ||
  r.name?.includes('finance')
)
console.log('Finance è·¯ç”±:', financeRoutes)

// 3. æ£€æŸ¥è·¯ç”±çš„ component
financeRoutes.forEach(route => {
  console.log(`è·¯ç”± ${route.name}:`, {
    path: route.path,
    component: route.component,
    meta: route.meta
  })
})

// 4. æ£€æŸ¥èœå•æ•°æ®
const menuData = JSON.parse(localStorage.getItem('ROLE_ROUTERS') || '[]')
console.log('èœå•æ•°æ®:', menuData)

// 5. æŸ¥æ‰¾è´¢åŠ¡ç®¡ç†èœå•
const financeMenu = menuData.find(m => m.name === 'è´¢åŠ¡ç®¡ç†' || m.path === 'finance')
console.log('è´¢åŠ¡ç®¡ç†èœå•:', financeMenu)
```

### æ­¥éª¤5: æ£€æŸ¥ç»„ä»¶æ–‡ä»¶

ç¡®è®¤å‰ç«¯ç»„ä»¶æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ£€æŸ¥
ssh -i tengxunyun.pem ubuntu@101.33.244.240 \
  "docker exec yudao-admin-prod find /usr/share/nginx/html/assets -name '*finance*' | head -5"
```

## ğŸ› å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: æ§åˆ¶å°æ˜¾ç¤º "[è·¯ç”±ç”Ÿæˆ] æœªæ‰¾åˆ°ç»„ä»¶æ–‡ä»¶"

**åŸå› **: ç»„ä»¶è·¯å¾„ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åç«¯è¿”å›çš„ `component` è·¯å¾„
2. ç¡®è®¤å‰ç«¯ç»„ä»¶æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ `modulesRoutesKeys` ä¸­æ˜¯å¦åŒ…å«è¯¥è·¯å¾„

**è°ƒè¯•ä»£ç **:
```javascript
// åœ¨ routerHelper.ts ä¸­æ·»åŠ 
console.log('æŸ¥æ‰¾ç»„ä»¶:', route.component)
console.log('å¯ç”¨è·¯å¾„:', modulesRoutesKeys.filter(k => k.includes('finance')))
```

### é—®é¢˜2: è·¯ç”±æ³¨å†Œäº†ä½†èœå•ä¸æ˜¾ç¤º

**åŸå› **: èœå•è¢« `hidden` å±æ€§éšè—

**æ£€æŸ¥**:
```javascript
const routes = router.getRoutes()
routes.forEach(r => {
  if (r.path.includes('finance')) {
    console.log(r.name, 'hidden:', r.meta?.hidden)
  }
})
```

**è§£å†³æ–¹æ¡ˆ**: ç¡®è®¤åç«¯è¿”å›çš„èœå•æ•°æ®ä¸­ `visible: true`

### é—®é¢˜3: èœå•æ•°æ®å­˜åœ¨ä½†è·¯ç”±æœªæ³¨å†Œ

**åŸå› **: è·¯ç”±ç”Ÿæˆè¿‡ç¨‹ä¸­å‡ºé”™

**æ£€æŸ¥**:
1. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰ JavaScript é”™è¯¯
2. æ£€æŸ¥ `generateRoute` å‡½æ•°æ˜¯å¦æ­£å¸¸æ‰§è¡Œ
3. ç¡®è®¤èœå•æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®

### é—®é¢˜4: æµè§ˆå™¨ç¼“å­˜é—®é¢˜

**ç—‡çŠ¶**: æ¸…é™¤ç¼“å­˜åæ­£å¸¸ï¼Œä½†åˆ·æ–°ååˆå¤±æ•ˆ

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥å‰ç«¯æ–‡ä»¶çš„ç¼“å­˜å¤´è®¾ç½®
2. ç¡®è®¤ Nginx é…ç½®ä¸­çš„ç¼“å­˜ç­–ç•¥
3. ä½¿ç”¨ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³å¼ºåˆ¶åˆ·æ–°

## ğŸ”§ æ‰‹åŠ¨è°ƒè¯•æ–¹æ³•

### æ–¹æ³•1: ç›´æ¥æ£€æŸ¥è·¯ç”±

åœ¨æµè§ˆå™¨ Console ä¸­ï¼š

```javascript
// è·å–è·¯ç”±å®ä¾‹
const router = window.__VUE_ROUTER__ || 
  document.querySelector('router-view').__vueParentComponent.ctx.$router

// æ£€æŸ¥è·¯ç”±
console.log(router.getRoutes())
```

### æ–¹æ³•2: æ£€æŸ¥èœå•æ•°æ®

```javascript
// æ£€æŸ¥ç¼“å­˜ä¸­çš„èœå•æ•°æ®
const cache = window.localStorage
Object.keys(cache).forEach(key => {
  if (key.includes('ROUTER') || key.includes('MENU')) {
    console.log(key, cache.getItem(key))
  }
})
```

### æ–¹æ³•3: å¼ºåˆ¶é‡æ–°è·å–èœå•

```javascript
// æ¸…é™¤èœå•ç¼“å­˜
localStorage.removeItem('ROLE_ROUTERS')
localStorage.removeItem('USER')

// åˆ·æ–°é¡µé¢ï¼ˆä¼šé‡æ–°ç™»å½•å¹¶è·å–èœå•ï¼‰
location.reload()
```

## ğŸ“ æ£€æŸ¥æ¸…å•

- [ ] å·²æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- [ ] å·²é‡æ–°ç™»å½•ç³»ç»Ÿ
- [ ] æ§åˆ¶å°æ—  JavaScript é”™è¯¯
- [ ] `get-permission-info` API è¿”å› 200
- [ ] èœå•æ•°æ®ä¸­åŒ…å«"è´¢åŠ¡ç®¡ç†"
- [ ] è·¯ç”±å·²æ­£ç¡®æ³¨å†Œï¼ˆ`router.getRoutes()` ä¸­æœ‰ finance è·¯ç”±ï¼‰
- [ ] è·¯ç”±çš„ component ä¸ä¸º undefined
- [ ] èœå•çš„ visible ä¸º true
- [ ] å‰ç«¯æ–‡ä»¶å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

## ğŸ¯ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

### 1. æ”¶é›†è°ƒè¯•ä¿¡æ¯

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´é”™è¯¯æ—¥å¿—
- `get-permission-info` API çš„å®Œæ•´å“åº”æ•°æ®
- `router.getRoutes()` çš„è¾“å‡ºï¼ˆç‰¹åˆ«æ˜¯ finance ç›¸å…³è·¯ç”±ï¼‰
- æµè§ˆå™¨ç‰ˆæœ¬å’Œæ“ä½œç³»ç»Ÿ

### 2. æ£€æŸ¥åç«¯èœå•é…ç½®

1. ç™»å½•åå°ç®¡ç†ç³»ç»Ÿ
2. è¿›å…¥: `ç³»ç»Ÿç®¡ç†` â†’ `èœå•ç®¡ç†`
3. æ£€æŸ¥"è´¢åŠ¡ç®¡ç†"èœå•ï¼š
   - çŠ¶æ€æ˜¯å¦ä¸º"å¯ç”¨"
   - å¯è§æ€§æ˜¯å¦ä¸º"æ˜¾ç¤º"
   - ç»„ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
   - ç»„ä»¶åç§°æ˜¯å¦æ­£ç¡®

### 3. æ£€æŸ¥ç”¨æˆ·æƒé™

1. è¿›å…¥: `ç³»ç»Ÿç®¡ç†` â†’ `è§’è‰²ç®¡ç†`
2. æ‰¾åˆ°å½“å‰ç”¨æˆ·æ‰€å±çš„è§’è‰²
3. æ£€æŸ¥è§’è‰²æ˜¯å¦æœ‰"è´¢åŠ¡ç®¡ç†"èœå•çš„æƒé™

## ğŸ“š ç›¸å…³æ–‡ä»¶

- è·¯ç”±ç”Ÿæˆé€»è¾‘: `original-yudao-ui/src/utils/routerHelper.ts`
- æƒé™ç®¡ç†: `original-yudao-ui/src/store/modules/permission.ts`
- ç”¨æˆ·ä¿¡æ¯: `original-yudao-ui/src/store/modules/user.ts`
- èœå•ç»„ä»¶: `original-yudao-ui/src/layout/components/Menu/src/Menu.vue`

---

**æœ€åæ›´æ–°ï¼š** 2025-12-21  
**é€‚ç”¨æœåŠ¡å™¨ï¼š** è…¾è®¯äº‘ (101.33.244.240)

