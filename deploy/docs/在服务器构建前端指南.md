# åœ¨äº‘æœåŠ¡å™¨ä¸Šæ„å»ºå‰ç«¯é•œåƒæŒ‡å—

## ğŸ¯ æ–¹æ³•1: ä½¿ç”¨æ„å»ºè„šæœ¬ï¼ˆæ¨èï¼‰

### æ­¥éª¤1: ä¸Šä¼ è„šæœ¬åˆ°æœåŠ¡å™¨

å¦‚æœSSHè¿æ¥æ­£å¸¸ï¼Œæ‰§è¡Œï¼š
```bash
scp -i ~/Documents/huoshan-ssh.pem deploy/scripts/build-frontend-on-server.sh root@115.190.240.137:/opt/erp-system/
```

### æ­¥éª¤2: åœ¨å®å¡”é¢æ¿ç»ˆç«¯æ‰§è¡Œ

1. ç™»å½•å®å¡”é¢æ¿
2. æ‰“å¼€ **ç»ˆç«¯**
3. æ‰§è¡Œï¼š
```bash
cd /opt/erp-system
chmod +x build-frontend-on-server.sh
./build-frontend-on-server.sh
```

## ğŸ¯ æ–¹æ³•2: ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚æœè„šæœ¬ä¸Šä¼ å¤±è´¥ï¼‰

åœ¨å®å¡”é¢æ¿ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/erp-system/script/docker

# 2. æ£€æŸ¥Dockerfileé…ç½®ï¼ˆç¡®è®¤npmé•œåƒæºå·²é…ç½®ï¼‰
grep -A 2 "registry.npmmirror.com" /opt/erp-system/original-yudao-ui/Dockerfile

# 3. æ£€æŸ¥åŸºç¡€é•œåƒ
docker images | grep -E "node.*18|nginx.*alpine"

# 4. æ„å»ºå‰ç«¯é•œåƒï¼ˆä½¿ç”¨npmé•œåƒæºï¼Œåº”è¯¥æ›´å¿«ï¼‰
docker compose -f docker-compose.prod.yml --env-file .env build admin

# 5. æ£€æŸ¥æ„å»ºç»“æœ
docker images | grep yudao-admin

# 6. å¦‚æœæ„å»ºæˆåŠŸï¼Œå¯åŠ¨å‰ç«¯æœåŠ¡
docker compose -f docker-compose.prod.yml --env-file .env up -d admin

# 7. æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker compose -f docker-compose.prod.yml ps

# 8. æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.prod.yml logs -f admin
```

## ğŸ“‹ æ„å»ºè¿‡ç¨‹è¯´æ˜

### æ„å»ºæ­¥éª¤
1. **å®‰è£…pnpm** - ä½¿ç”¨npmé•œåƒæº
2. **å®‰è£…ä¾èµ–** - ä»npmé•œåƒæºä¸‹è½½ï¼ˆregistry.npmmirror.comï¼‰
3. **æ„å»ºVueé¡¹ç›®** - ç¼–è¯‘å‰ç«¯ä»£ç 
4. **æ‰“åŒ…åˆ°nginx** - å°†æ„å»ºäº§ç‰©å¤åˆ¶åˆ°nginxé•œåƒ

### é¢„è®¡æ—¶é—´
- **ä½¿ç”¨npmé•œåƒæº**: 5-15åˆ†é’Ÿ
- **ä¸ä½¿ç”¨é•œåƒæº**: 15-30åˆ†é’Ÿï¼ˆå¯èƒ½å¤±è´¥ï¼‰

### æ„å»ºæ—¥å¿—
æ„å»ºè¿‡ç¨‹ä¸­çš„æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š
- ä¾èµ–å®‰è£…è¿›åº¦
- æ„å»ºè¿›åº¦
- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰

## âš ï¸ å¸¸è§é—®é¢˜

### 1. æ„å»ºå¤±è´¥ï¼šç½‘ç»œè¶…æ—¶

**åŸå› **: æ— æ³•è®¿é—®npm registry

**è§£å†³**:
- ç¡®è®¤Dockerfileä¸­å·²é…ç½®npmé•œåƒæº
- æ£€æŸ¥æœåŠ¡å™¨ç½‘ç»œè¿æ¥
- ç­‰å¾…ç½‘ç»œæ¢å¤åé‡è¯•

### 2. æ„å»ºå¤±è´¥ï¼šNodeç‰ˆæœ¬ä¸åŒ¹é…

**åŸå› **: pnpméœ€è¦Node.js v18.12+

**è§£å†³**: ç¡®è®¤Dockerfileä½¿ç”¨ `node:18-alpine`

### 3. æ„å»ºå¤±è´¥ï¼šç¼ºå°‘æ–‡ä»¶

**åŸå› **: é¡¹ç›®æ–‡ä»¶ä¸å®Œæ•´

**è§£å†³**: æ£€æŸ¥ `/opt/erp-system/original-yudao-ui/` ç›®å½•æ˜¯å¦å®Œæ•´

## âœ… æ„å»ºæˆåŠŸåçš„éªŒè¯

### æ£€æŸ¥é•œåƒ
```bash
docker images | grep yudao-admin
```

åº”è¯¥çœ‹åˆ°ï¼š
```
yudao-admin   latest   <image-id>   <size>   <time>
```

### æ£€æŸ¥æœåŠ¡
```bash
docker compose -f docker-compose.prod.yml ps
```

åº”è¯¥çœ‹åˆ°æ‰€æœ‰æœåŠ¡éƒ½åœ¨è¿è¡Œï¼š
- yudao-mysql-prod (healthy)
- yudao-redis-prod (healthy)
- yudao-server-prod (healthy)
- yudao-admin-prod (healthy)

### è®¿é—®æµ‹è¯•
- **å‰ç«¯**: http://115.190.240.137
- **åç«¯API**: http://115.190.240.137:48080/actuator/health

## ğŸ”§ æ‰‹åŠ¨æ„å»ºå‘½ä»¤ï¼ˆè¯¦ç»†ç‰ˆï¼‰

å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„è¾“å‡ºï¼š

```bash
cd /opt/erp-system/script/docker

# æ„å»ºå¹¶æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
docker compose -f docker-compose.prod.yml --env-file .env build --progress=plain admin 2>&1 | tee /tmp/build.log

# æŸ¥çœ‹æ„å»ºæ—¥å¿—
tail -50 /tmp/build.log
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ„å»ºè¿‡ç¨‹è¾ƒé•¿**: è¯·è€å¿ƒç­‰å¾…ï¼Œä¸è¦ä¸­æ–­
2. **ç½‘ç»œé—®é¢˜**: å¦‚æœæ„å»ºå¤±è´¥ï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥
3. **ç£ç›˜ç©ºé—´**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘2GBï¼‰
4. **å†…å­˜**: æ„å»ºè¿‡ç¨‹éœ€è¦è¶³å¤Ÿå†…å­˜ï¼ˆå»ºè®®è‡³å°‘2GBï¼‰

---

**æç¤º**: å¦‚æœSSHè¿æ¥æœ‰é—®é¢˜ï¼Œä¼˜å…ˆä½¿ç”¨å®å¡”é¢æ¿çš„ç»ˆç«¯åŠŸèƒ½ã€‚

