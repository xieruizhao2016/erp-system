# 产品BOM自动填充功能 - 快速测试指南

## 🎯 测试目标
验证在"生产管理 > 产品BOM > 新增"时，选择产品后是否正确自动填充各字段。

## 📋 测试前准备

### 1. 确保服务运行
```bash
# 检查服务状态
lsof -i :48080  # 后端服务
lsof -i :80     # 前端服务

# 如果未运行，执行重启脚本
./scripts/restart-all-services.sh
```

### 2. 访问系统
- 前端地址：http://localhost:80
- 后端API：http://localhost:48080

### 3. 登录系统
使用管理员账号登录系统

## 🧪 测试步骤

### 测试用例 1：正常自动填充

**步骤：**
1. 进入菜单：`生产管理` → `产品BOM`
2. 点击页面右上角 `新增` 按钮
3. 在弹出的表单中，点击 `产品` 下拉框
4. 选择任意一个产品（例如：iPhone 15）
5. 观察其他字段是否自动填充

**预期结果：**
| 字段名称 | 预期值 | 是否可修改 |
|---------|--------|-----------|
| BOM编号 | BOM-{产品编号}-{今天日期}-01 | ✅ 可修改 |
| BOM名称 | {产品名称}-BOM | ✅ 可修改 |
| 版本号 | 1.0 | ✅ 可修改 |
| 状态 | 生效 | ✅ 可修改 |
| BOM类型 | 生产BOM | ✅ 可修改 |
| 生效日期 | 今天日期 | ✅ 可修改 |

**示例：**
- 假设选择的产品编号为 `P0001`，产品名称为 `iPhone 15`
- 今天日期为 `2025年11月21日`
- 则：
  - BOM编号：`BOM-P0001-20251121-01`
  - BOM名称：`iPhone 15-BOM`
  - 版本号：`1.0`
  - 状态：`生效`
  - BOM类型：`生产BOM`
  - 生效日期：`2025-11-21`

---

### 测试用例 2：修改自动填充的值

**步骤：**
1. 按照测试用例1完成自动填充
2. 手动修改 `BOM名称` 为 `自定义BOM名称`
3. 手动修改 `版本号` 为 `2.0`
4. 手动修改 `BOM类型` 为 `设计BOM`
5. 填写其他必填字段（如有）
6. 点击 `确定` 按钮提交

**预期结果：**
- ✅ 提交成功
- ✅ 保存的数据使用修改后的值，而不是默认值
- ✅ 在列表页能看到新增的BOM记录，且各字段值正确

---

### 测试用例 3：编辑模式不触发自动填充

**步骤：**
1. 在BOM列表页，找到任意一条BOM记录
2. 点击该记录的 `编辑` 按钮
3. 在弹出的编辑表单中，记录当前各字段的值
4. 更改 `产品` 为另一个产品
5. 观察其他字段是否改变

**预期结果：**
- ✅ 其他字段保持不变
- ✅ 不会自动填充新产品的默认值
- ✅ 编辑模式下不触发自动填充逻辑

---

### 测试用例 4：切换产品多次

**步骤：**
1. 在新增表单中，选择产品A
2. 观察自动填充的值
3. 不做任何修改，直接切换到产品B
4. 观察字段值是否更新为产品B的默认值

**预期结果：**
- ✅ BOM名称、BOM编号等字段更新为产品B的默认值
- ✅ 如果用户手动修改过某个字段，该字段不会被覆盖

---

### 测试用例 5：清空产品后再选择

**步骤：**
1. 在新增表单中，选择一个产品
2. 观察自动填充
3. 点击产品选择框的清空按钮（×）
4. 再次选择同一个或不同的产品
5. 观察是否重新自动填充

**预期结果：**
- ✅ 清空产品后，自动填充的字段保持不变
- ✅ 重新选择产品后，再次触发自动填充

---

## 📊 测试检查表

请在完成每个测试后打勾：

- [ ] 测试用例1：正常自动填充 - 通过
- [ ] 测试用例2：修改自动填充的值 - 通过
- [ ] 测试用例3：编辑模式不触发 - 通过
- [ ] 测试用例4：切换产品多次 - 通过
- [ ] 测试用例5：清空产品后再选择 - 通过

## 🐛 常见问题排查

### 问题1：选择产品后没有自动填充

**可能原因：**
1. 浏览器缓存问题
2. 前端代码未重新编译

**解决方法：**
```bash
# 清除浏览器缓存并强制刷新 (Ctrl+F5 或 Cmd+Shift+R)

# 或重启前端服务
cd original-yudao-ui
npm run dev
```

### 问题2：BOM编号格式不对

**检查点：**
- 产品是否有 `code` 字段（产品编号）
- 日期格式化函数是否正常工作

**调试方法：**
```javascript
// 在浏览器控制台查看生成的编号
console.log(formData.value.bomNo)
```

### 问题3：状态或类型未正确设置

**检查点：**
- 字典数据是否已导入数据库
- 字典值是否正确（状态：2=生效，类型：1=生产BOM）

**验证SQL：**
```sql
-- 检查字典数据
SELECT * FROM system_dict_data WHERE dict_type = 'erp_product_bom_status';
SELECT * FROM system_dict_data WHERE dict_type = 'erp_bom_type';
```

## 📸 测试截图位置

建议在以下关键步骤截图保存：
1. 选择产品前（空表单）
2. 选择产品后（自动填充完成）
3. 修改默认值后
4. 提交成功后（列表页显示新记录）

## 🎉 测试完成标准

所有测试用例通过后，即可认为功能正常工作。

---

**测试日期：** _______________  
**测试人员：** _______________  
**测试结果：** ⬜ 通过  ⬜ 未通过  
**备注：** _______________________________________________

