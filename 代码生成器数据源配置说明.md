# 代码生成器数据源配置说明

## 📋 问题说明

在代码生成器导入表时，数据源下拉框只能看到 **master** 数据源，这是**正常现象**。

## 🔍 原因分析

### Master 数据源（默认）
- **ID**: 0
- **名称**: master（或 primary，取决于配置）
- **说明**: 这是系统默认的主数据源，指向应用配置文件中配置的数据库
- **特点**: 
  - 系统自动提供，无需手动创建
  - 通常指向项目的生产数据库（`ruoyi-vue-pro`）
  - 这是最常用的数据源

### 其他数据源
- 需要手动在"数据源配置"管理页面创建
- 用于连接其他数据库（如测试库、其他业务库等）

---

## ✅ 解决方案

### 方案1：使用 Master 数据源（推荐）

**适用场景**：
- 从项目主数据库导入表结构
- 大多数情况下使用此方案

**操作步骤**：
1. 在代码生成器导入表时，直接选择 **master** 数据源
2. 搜索并选择要导入的表
3. 点击导入即可

**优点**：
- 无需额外配置
- 直接使用项目主数据库
- 简单快捷

---

### 方案2：创建新的数据源配置

**适用场景**：
- 需要从其他数据库导入表结构
- 需要连接测试数据库
- 需要连接其他业务数据库

**操作步骤**：

#### 步骤1：进入数据源配置管理
1. 登录系统
2. 进入：**基础设施** → **数据源配置**
3. 查看当前数据源列表

#### 步骤2：创建新数据源
1. 点击 **"新增"** 按钮
2. 填写数据源信息：

   **数据源名称**：
   ```
   测试数据库
   ```
   或
   ```
   生产数据库
   ```

   **数据源连接**（根据数据库类型选择）：
   
   **MySQL**：
   ```
   jdbc:mysql://localhost:3306/database_name?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&nullCatalogMeansCurrent=true
   ```
   
   **PostgreSQL**：
   ```
   jdbc:postgresql://localhost:5432/database_name
   ```
   
   **Oracle**：
   ```
   jdbc:oracle:thin:@localhost:1521:ORCL
   ```
   
   **SQL Server**：
   ```
   jdbc:sqlserver://localhost:1433;databaseName=database_name
   ```

   **用户名**：
   ```
   root
   ```
   或你的数据库用户名

   **密码**：
   ```
   123456
   ```
   或你的数据库密码

3. 点击 **"确定"** 保存

#### 步骤3：验证连接
- 系统会自动验证数据源连接是否正常
- 如果连接失败，会提示错误信息
- 请检查：
  - 数据库服务是否运行
  - 连接地址是否正确
  - 用户名密码是否正确
  - 数据库是否存在

#### 步骤4：在代码生成器中使用
1. 进入：**基础设施** → **代码生成**
2. 点击 **"导入"** 按钮
3. 在数据源下拉框中，现在可以看到新创建的数据源
4. 选择新数据源，搜索并导入表

---

## 📝 数据源配置示例

### 示例1：连接本地MySQL测试库
```
数据源名称: 测试数据库
数据源连接: jdbc:mysql://localhost:3306/test_db?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&nullCatalogMeansCurrent=true
用户名: root
密码: 123456
```

### 示例2：连接远程MySQL数据库
```
数据源名称: 远程生产库
数据源连接: jdbc:mysql://192.168.1.100:3306/production_db?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&nullCatalogMeansCurrent=true
用户名: admin
密码: your_password
```

### 示例3：连接PostgreSQL数据库
```
数据源名称: PostgreSQL数据库
数据源连接: jdbc:postgresql://localhost:5432/postgres
用户名: postgres
密码: postgres
```

---

## ⚠️ 注意事项

### 1. Master 数据源不可编辑
- Master 数据源（ID=0）是系统默认的，不能编辑或删除
- 它的配置来自应用配置文件（`application.yaml`）

### 2. 数据源连接格式
- 不同数据库的连接字符串格式不同
- 请根据实际数据库类型填写正确的连接字符串
- MySQL 8.0+ 需要添加 `allowPublicKeyRetrieval=true` 参数

### 3. 权限要求
- 创建数据源配置需要 `infra:data-source-config:create` 权限
- 请确保当前用户有相应权限

### 4. 连接验证
- 系统会在保存时自动验证连接
- 如果连接失败，无法保存配置
- 请确保数据库服务正在运行

### 5. 安全性
- 数据源密码会加密存储
- 请妥善保管数据库密码
- 不要在不安全的环境中配置生产数据库

---

## 🔧 常见问题

### Q1: 为什么只能看到 master 数据源？
**A**: 这是正常的。Master 是系统默认数据源。如果需要其他数据源，需要先在"数据源配置"中创建。

### Q2: 如何修改 master 数据源的配置？
**A**: Master 数据源不能在前端修改。需要修改应用配置文件 `application.yaml` 中的数据库配置。

### Q3: 创建数据源后，代码生成器还是看不到？
**A**: 
1. 检查数据源是否创建成功
2. 刷新代码生成器页面
3. 检查是否有权限访问数据源配置

### Q4: 数据源连接失败怎么办？
**A**: 
1. 检查数据库服务是否运行
2. 检查连接地址、端口是否正确
3. 检查用户名密码是否正确
4. 检查防火墙是否允许连接
5. 检查数据库是否允许远程连接（如果是远程数据库）

### Q5: 可以删除 master 数据源吗？
**A**: 不可以。Master 数据源是系统必需的，不能删除。

---

## 📞 总结

- **Master 数据源**：系统默认，指向主数据库，可直接使用
- **其他数据源**：需要手动创建，用于连接其他数据库
- **推荐做法**：大多数情况下使用 master 数据源即可

如果只是从项目主数据库导入表结构，直接使用 **master** 数据源即可，无需额外配置！

