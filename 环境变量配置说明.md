# 环境变量配置说明

## 概述

项目已将所有敏感信息从配置文件中提取到 `.env` 文件中进行统一管理，所有 `.env` 文件已纳入 git 管理。

## 配置文件结构

### 后端配置

- **`yudao-server/.env`** - 后端环境变量配置文件（包含实际配置值）
- **`yudao-server/.env.example`** - 后端环境变量配置示例文件（供参考）

### 前端配置

- **`original-yudao-ui/.env`** - 前端环境变量配置文件
- **`original-yudao-ui/.env.local`** - 本地环境配置
- **`original-yudao-ui/.env.dev`** - 开发环境配置
- **`original-yudao-ui/.env.prod`** - 生产环境配置
- **`original-yudao-ui/.env.stage`** - 预发布环境配置
- **`original-yudao-ui/.env.test`** - 测试环境配置

## 已迁移的敏感信息

### 数据库配置
- 数据库连接 URL
- 数据库用户名
- 数据库密码

### Redis 配置
- Redis 主机地址
- Redis 端口
- Redis 数据库索引
- Redis 密码

### 加密密钥
- MyBatis Plus 加密密钥
- API 请求/响应加密密钥

### AI 服务配置
- 文心一言 API Key 和 Secret Key
- 智谱 AI API Key
- OpenAI API Key 和 Base URL
- Azure OpenAI Endpoint
- Anthropic Claude API Key
- Ollama 配置
- Stability AI API Key
- 通义千问 API Key
- Minimax API Key
- 月之暗面（KIMI）API Key
- DeepSeek API Key 和 Model
- 谷歌 Gemini 配置
- 字节豆包配置
- 腾讯混元配置
- 硅基流动配置
- 讯飞星火配置
- 百川智能配置
- Midjourney 配置
- Suno 配置
- Web Search API Key

### 微信相关配置
- 微信公众号 App ID 和 Secret
- 微信小程序 App ID 和 Secret

### 第三方登录配置
- 钉钉 Client ID 和 Secret
- 企业微信 Client ID、Secret 和 Agent ID

### 其他服务配置
- QQ 地图密钥
- 快递鸟 API Key 和 Business ID
- 快递100 Key 和 Customer

## 使用方法

### 后端启动

启动脚本 `start-backend.sh` 已自动加载 `yudao-server/.env` 文件中的环境变量。

```bash
./start-backend.sh
# 或后台启动
./start-backend.sh -d
```

### 手动加载环境变量

如果需要手动加载环境变量：

```bash
# 加载后端环境变量
source yudao-server/.env

# 然后启动应用
java -jar yudao-server/target/yudao-server.jar
```

### 修改配置

1. 编辑 `yudao-server/.env` 文件
2. 修改相应的环境变量值
3. 重启应用使配置生效

### 新增环境变量

1. 在 `yudao-server/.env` 中添加新的环境变量
2. 在 `yudao-server/.env.example` 中添加对应的示例（使用占位符）
3. 在相应的 `application*.yaml` 文件中使用 `${ENV_VAR:default_value}` 格式引用

## 配置文件说明

### application.yaml

主配置文件，使用环境变量引用敏感配置：

```yaml
spring:
  datasource:
    dynamic:
      datasource:
        master:
          url: ${DATASOURCE_MASTER_URL:default_value}
          username: ${DATASOURCE_MASTER_USERNAME:root}
          password: ${DATASOURCE_MASTER_PASSWORD:123456}
```

格式说明：`${环境变量名:默认值}`

- 如果环境变量存在，使用环境变量的值
- 如果环境变量不存在，使用默认值

### .gitignore 规则

所有 `.env` 文件已纳入 git 管理：

```gitignore
# 所有 .env 文件都需要提交到仓库（敏感信息单独管理）
!.env
!.env.*
!**/.env
!**/.env.*
```

## 注意事项

1. **敏感信息管理**：虽然 `.env` 文件已纳入 git 管理，但请确保：
   - 不要将包含真实生产环境密钥的 `.env` 文件提交到公共仓库
   - 对于生产环境，建议使用环境变量或密钥管理服务（如 Vault、AWS Secrets Manager 等）

2. **环境隔离**：不同环境应使用不同的 `.env` 文件或环境变量值

3. **默认值**：配置文件中保留了默认值，即使不设置环境变量也能正常运行（使用默认配置）

4. **启动脚本**：`start-backend.sh` 会自动加载 `.env` 文件，无需手动设置环境变量

## 迁移完成

✅ 所有敏感信息已从 `application*.yaml` 提取到 `.env` 文件  
✅ 所有 `.env` 文件已纳入 git 管理  
✅ 启动脚本已更新，自动加载 `.env` 文件  
✅ 创建了 `.env.example` 示例文件供参考  

